<!DOCTYPE html>
<html lang="en">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="keywords" content="dashboard" />
    <meta name="robots" content="index, follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:image" content="social-image.html" />
    <meta name="format-detection" content="telephone=no" />
    <title>
      Benue State Integrated Residents/Citizens Identity/Indigeneship
      Registration and Card Issuance Management System
    </title>
    <!-- Favicon icon -->
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/images/benue-state-logo.png"
    />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css"
      rel="stylesheet"
    />
    <link href="css/style.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="../../unpkg.com/sweetalert%402.1.2/dist/sweetalert.min.js"></script>
    <link href="vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet" />
    <script src="../../ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style>
      .error-message {
        color: red;
        font-size: 0.875rem;
        display: none;
      }
      .form-control.error {
        border-color: red;
      }
      .form-section {
        display: none;
      }
      .form-section.active {
        display: block;
      }
      .camera-upload-box video,
      .camera-upload-box canvas,
      .camera-upload-box img {
        border-radius: 8px;
        margin-bottom: 10px;
      }

      /* New styles for multi-step form */
      .step-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s;
      }
      .step-btn.active {
        background-color: #0d6efd;
        color: white;
      }
      .step-btn.completed {
        background-color: #198754;
        color: white;
      }
      .step-btn.disabled {
        background-color: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
      }
      .progress {
        height: 8px;
      }
      .neighbor-card,
      .family-card,
      .employment-card {
        margin-bottom: 1rem;
        padding: 1rem;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
      }
      .passport-upload {
        border: 2px dashed #dee2e6;
        border-radius: 0.375rem;
        padding: 1.5rem;
        text-align: center;
      }
      .step-navigation {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 2rem;
      }
      .progress-container {
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body class="bg-light">
    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
      <div class="sk-three-bounce">
        <div class="sk-child sk-bounce1"></div>
        <div class="sk-child sk-bounce2"></div>
        <div class="sk-child sk-bounce3"></div>
      </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
      <!--**********************************
            Nav header start
        ***********************************-->

      <div class="nav-header">
        <!-- Logo Section -->
        <a href="index.html" class="brand-logo">
          <img
            src="/assets/images/benue-state-logo.png"
            alt="benueo"
            class="logo-img"
          />
          <div class="brand-text">BIRCIIRCIMS</div>
        </a>

        <!-- Hamburger Menu for Navigation Control -->
        <div class="nav-control">
          <div class="hamburger">
            <span class="line"></span><span class="line"></span
            ><span class="line"></span>
          </div>
        </div>
      </div>
      <!--**********************************
            Nav header end
        ***********************************-->

      <!--**********************************
            Header start
        ***********************************-->
      <div class="header">
        <div class="header-content">
          <nav class="navbar navbar-expand">
            <div class="collapse navbar-collapse justify-content-between">
              <div class="header-left">
                <div class="dashboard_bar">Profile</div>
              </div>
            </div>
          </nav>
        </div>
      </div>
      <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

      <!--**********************************
            Sidebar start
        ***********************************-->
      <div class="deznav">
        <div class="deznav-scroll">
          <ul class="metismenu" id="menu">
            <!-- Super Admin Menu -->
            <li class="super-admin-menu">
              <a class="ai-icon" href="index.html" aria-expanded="false">
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>
            <!-- user Menu -->
            <li class="user-menu">
              <a
                class="ai-icon"
                href="user-dasboard.html"
                aria-expanded="false"
              >
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="approvals.html" aria-expanded="false">
                <i class="fa fa-exchange" aria-hidden="true"></i>
                <span class="nav-text">Approvals</span>
              </a>
            </li>
            <li class="user-menu">
              <a class="ai-icon" href="request.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Certificate Status</span>
              </a>
            </li>
            <li class="user-menu">
              <a class="ai-icon" href="idcard.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Card Status</span>
              </a>
            </li>

            <li class="super-admin-menu">
              <a class="ai-icon" href="all-request.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Certificate Request</span>
              </a>
            </li>

            <li class="super-admin-menu">
              <a class="ai-icon" href="all-card.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Card Request</span>
              </a>
            </li>
            <!-- Super Admin Menu -->
            <li class="super-admin-menu">
              <a class="ai-icon" href="citizens.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>

                <span class="nav-text">Users</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="kindred.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>

                <span class="nav-text">Kindreds</span>
              </a>
            </li>
            <li class="support-admin-menu">
              <a class="ai-icon" href="user-kindred.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">Kindreds</span>
              </a>
            </li>
            <li class="support-admin-menu">
              <a
                class="ai-icon"
                href="support-admin-lga.html"
                aria-expanded="false"
              >
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">Support Admin LGA</span>
              </a>
            </li>
            <!-- User-menu -->
            <li class="user-menu">
              <a class="ai-icon" href="certificate.html" aria-expanded="false">
                <i class="fa fa-user-plus" aria-hidden="true"></i>
                <span class="nav-text">Request Certificate</span>
              </a>
            </li>
            <li class="user-menu">
              <a class="ai-icon" href="card.html" aria-expanded="false">
                <i class="fa fa-user-plus" aria-hidden="true"></i>
                <span class="nav-text">Request Card</span>
              </a>
            </li>

            <li class="user-menu">
              <a class="ai-icon" href="profile.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">User Account</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="transaction.html" aria-expanded="false">
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">transactions</span>
              </a>
            </li>
            <li>
              <a
                class="ai-icon"
                href="../../../auth/login.html"
                aria-expanded="false"
              >
                <i class="fa fa-sign-out" aria-hidden="true"></i>
                <span class="nav-text" onclick="logout(this)">Logout</span>
              </a>
            </li>
          </ul>
          <div class="copyright">
            <p>Powered By BDIC <br />© 2025 All Rights Reserved</p>
            <p class="op5"></p>
          </div>
        </div>
      </div>

      <!--**********************************
            Sidebar end
        ***********************************-->

      <!--**********************************
            Content body start
        ***********************************-->
      <div class="content-body">
        <div class="container-fluid">
          <form
            class="profile-form"
            id="unifiedForm"
            enctype="multipart/form-data"
          >
            <!-- Progress Bar and Step Navigation -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="progress-container mb-4">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-sm fw-medium" id="step-counter"
                      >Step 1 of 10</span
                    >
                    <span class="text-sm text-muted" id="progress-percent"
                      >10% Complete</span
                    >
                  </div>
                  <div class="progress">
                    <div
                      class="progress-bar"
                      id="progress-bar"
                      role="progressbar"
                      style="width: 10%"
                    ></div>
                  </div>
                </div>

                <div class="step-navigation" id="step-buttons">
                  <button class="btn btn-sm step-btn active" data-step="0">
                    <span>1</span>
                    <span class="d-none d-sm-inline">Profile Details</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="1">
                    <span>2</span>
                    <span class="d-none d-sm-inline">Residential Address</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="2">
                    <span>3</span>
                    <span class="d-none d-sm-inline">Identification</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="3">
                    <span>4</span>
                    <span class="d-none d-sm-inline">Next of Kin</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="4">
                    <span>5</span>
                    <span class="d-none d-sm-inline">Neighbor Contacts</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="5">
                    <span>6</span>
                    <span class="d-none d-sm-inline">Family Contacts</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="6">
                    <span>7</span>
                    <span class="d-none d-sm-inline">Business Details</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="7">
                    <span>8</span>
                    <span class="d-none d-sm-inline">Employment History</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="8">
                    <span>9</span>
                    <span class="d-none d-sm-inline">Education Details</span>
                  </button>
                  <button class="btn btn-sm step-btn" data-step="9">
                    <span>10</span>
                    <span class="d-none d-sm-inline">Health Info</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Profile Details -->
            <div class="row form-section active" id="profile-details-section">
              <!-- ... (existing profile details content remains the same) ... -->
              <div class="mb-4">
                <h2 class="h4 fw-semibold mb-2">Profile Details</h2>
                <hr />
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="firstname" class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstname"
                    name="firstname"
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label for="lastname" class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="lastname"
                    name="lastname"
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label for="middlename" class="form-label">Middle Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="middlename"
                    name="middlename"
                  />
                </div>
                <div class="col-md-6">
                  <label for="gender" class="form-label">Gender</label>
                  <select class="form-select" id="gender" name="gender">
                    <option value="" selected disabled>Select gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="maritalStatus" class="form-label"
                    >Marital Status</label
                  >
                  <select
                    class="form-select"
                    id="maritalStatus"
                    name="maritalStatus"
                  >
                    <option value="" selected disabled>
                      Select marital status
                    </option>
                    <option value="single">Single</option>
                    <option value="married">Married</option>
                    <option value="divorced">Divorced</option>
                    <option value="widowed">Widowed</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="DOB" class="form-label">Date of Birth</label>
                  <input
                    type="date"
                    class="form-control"
                    id="DOB"
                    name="DOB"
                    min="1900-01-01"
                  />
                </div>
                <div class="col-md-6">
                  <label for="stateOfOrigin" class="form-label"
                    >State of Origin</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="stateOfOrigin"
                    name="stateOfOrigin"
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label for="nationality" class="form-label"
                    >Nationality</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="nationality"
                    name="nationality"
                  />
                </div>
                <div class="col-md-6">
                  <label for="community" class="form-label">Community</label>
                  <input
                    type="text"
                    class="form-control"
                    id="community"
                    name="community"
                  />
                </div>
                <div class="col-md-6">
                  <label for="religion" class="form-label">Religion</label>
                  <select class="form-select" id="religion" name="religion">
                    <option value="" selected disabled>Select religion</option>
                    <option value="christian">Christian</option>
                    <option value="muslim">Muslim</option>
                    <option value="others">Others</option>
                  </select>
                </div>
              </div>
              <!-- Passport Photo Section -->
              <div class="mt-4">
                <label class="form-label">Recent Passport Photograph</label>
                <div class="passport-upload">
                  <div class="d-flex flex-column align-items-center gap-3">
                    <div
                      class="bg-light rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 96px; height: 96px"
                    >
                      <i class="bi bi-camera fs-3 text-muted"></i>
                    </div>
                    <div class="text-center">
                      <p class="text-muted small">
                        Upload your passport photograph
                      </p>
                      <div class="d-flex gap-2 justify-content-center">
                        <button
                          type="button"
                          class="btn btn-outline-secondary btn-sm"
                        >
                          <i class="bi bi-camera me-2"></i>Take Photo
                        </button>
                        <button
                          type="button"
                          class="btn btn-outline-secondary btn-sm"
                        >
                          <i class="bi bi-upload me-2"></i>Upload File
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Residential Address -->
            <div class="row form-section" id="Residential-Address-section">
              <!-- ... (existing residential address content remains the same) ... -->
              <div class="mb-4">
                <h2 class="h4 fw-semibold mb-2">Identification</h2>
                <hr />
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="identification" class="form-label"
                    >Identification Type</label
                  >
                  <select
                    class="form-select"
                    id="identification"
                    name="identification"
                  >
                    <option value="" selected disabled>
                      Select identification type
                    </option>
                    <option value="national_id">National ID</option>
                    <option value="driver_licence">Driver Licence</option>
                    <option value="international_passport">
                      International Passport
                    </option>
                    <option value="voters_card">Voter's Card</option>
                    <option value="others">Others</option>
                  </select>
                </div>
                <div
                  class="col-md-6"
                  id="other-identification-container"
                  style="display: none"
                >
                  <label for="other_identification" class="form-label"
                    >Specify Other Identification</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="other_identification"
                    name="other_identification"
                    placeholder="Please specify"
                  />
                </div>
                <div class="col-md-6">
                  <label for="id_number" class="form-label">ID Number</label>
                  <input
                    type="text"
                    class="form-control"
                    id="id_number"
                    name="id_number"
                  />
                </div>
                <div class="col-md-6">
                  <label for="issue_date" class="form-label">Issue Date</label>
                  <input
                    type="date"
                    class="form-control"
                    id="issue_date"
                    name="issue_date"
                  />
                </div>
                <div class="col-md-6">
                  <label for="expiry_date" class="form-label"
                    >Expiry Date</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="expiry_date"
                    name="expiry_date"
                  />
                </div>
              </div>
            </div>

            <!-- Identification -->
            <div class="row form-section" id="Identity-information-section">
              <!-- ... (existing identification content remains the same) ... -->
            </div>

            <!-- NOK Information -->
            <div class="row form-section" id="family-information-section">
              <!-- ... (existing NOK information content remains the same) ... -->
            </div>

            <!-- Contact Details -->
            <div class="row form-section" id="contact-details-section">
              <!-- ... (existing contact details content remains the same) ... -->
            </div>

            <!-- Family Members' Contact Details -->
            <div class="row form-section" id="family-details-section">
              <!-- ... (existing family details content remains the same) ... -->
            </div>

            <!-- Business Details -->
            <div class="row form-section" id="business-details-section">
              <!-- ... (existing business details content remains the same) ... -->
            </div>

            <!-- Employment/Occupation Details -->
            <div class="row form-section" id="employment-details-section">
              <!-- ... (existing employment details content remains the same) ... -->
            </div>

            <!-- Education Details -->
            <div class="row form-section" id="education-details-section">
              <!-- ... (existing education details content remains the same) ... -->
            </div>

            <!-- Health Information -->
            <div class="row form-section" id="health-info-section">
              <!-- ... (existing health info content remains the same) ... -->
            </div>

            <!-- Navigation Buttons -->
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="prev-btn"
                    disabled
                  >
                    <i class="fa fa-chevron-left me-2"></i>Previous
                  </button>
                  <div class="d-flex gap-3">
                    <button
                      type="submit"
                      class="btn btn-success d-none"
                      id="submit-btn"
                    >
                      Submit Form <i class="fa fa-check ms-2"></i>
                    </button>
                    <button type="button" class="btn btn-primary" id="next-btn">
                      Next <i class="fa fa-chevron-right ms-2"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <script>
          $(document).ready(function () {
            // Form data object
            let formData = {};
            let completedSteps = [];
            let currentStep = 0;
            const totalSteps = 10; // Updated to include all 10 steps

            // Initialize the form
            updateProgress();
            updateStepButtons();

            // Step navigation buttons
            $("#step-buttons button").click(function () {
              const stepIndex = parseInt($(this).data("step"));
              if (stepIndex <= Math.max(...completedSteps, currentStep)) {
                goToStep(stepIndex);
              }
            });

            // Previous button
            $("#prev-btn").click(function () {
              prevStep();
            });

            // Next button
            $("#next-btn").click(function () {
              nextStep();
            });

            // Submit button
            $("#submit-btn").click(function (e) {
              e.preventDefault();
              handleSubmit();
            });

            // Identification type change
            $("#identification").change(function () {
              if ($(this).val() === "others") {
                $("#other-identification-container").show();
              } else {
                $("#other-identification-container").hide();
                $("#other_identification").val("");
              }
            });

            // Current employment checkbox
            $(document).on("change", ".employment-current", function () {
              const card = $(this).closest(".employment-card");
              const endYearInput = card.find(".employment-end");
              if ($(this).is(":checked")) {
                endYearInput.val("").prop("disabled", true);
              } else {
                endYearInput.prop("disabled", false);
              }
            });

            // Add neighbor
            let neighborCount = 1;
            $("#add-neighbor").click(function () {
              if (neighborCount < 5) {
                neighborCount++;
                const newNeighbor = `
                  <div class="neighbor-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h4 class="h5 mb-0">Neighbor ${neighborCount}</h4>
                      <button type="button" class="btn btn-sm btn-outline-danger remove-neighbor">
                        <i class="fa fa-trash"></i>
                      </button>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control neighbor-name" name="neighbors[${
                          neighborCount - 1
                        }][name]">
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">Residential Address</label>
                        <input type="text" class="form-control neighbor-address" name="neighbors[${
                          neighborCount - 1
                        }][address]">
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control neighbor-phone" name="neighbors[${
                          neighborCount - 1
                        }][phone]">
                      </div>
                    </div>
                  </div>
                `;
                $("#neighbors-container").append(newNeighbor);

                if (neighborCount >= 5) {
                  $("#add-neighbor").prop("disabled", true);
                  $("#max-neighbors-message").removeClass("d-none");
                }
              }
            });

            // Remove neighbor
            $(document).on("click", ".remove-neighbor", function () {
              $(this).closest(".neighbor-card").remove();
              neighborCount--;
              $("#add-neighbor").prop("disabled", false);
              $("#max-neighbors-message").addClass("d-none");
              // Renumber remaining neighbors
              $(".neighbor-card").each(function (index) {
                $(this)
                  .find("h4")
                  .text(`Neighbor ${index + 1}`);
              });
            });

            // Add family member
            let familyCount = 1;
            $("#add-family").click(function () {
              if (familyCount < 5) {
                familyCount++;
                const newFamily = `
                  <div class="family-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h4 class="h5 mb-0">Family Member ${familyCount}</h4>
                      <button type="button" class="btn btn-sm btn-outline-danger remove-family">
                        <i class="fa fa-trash"></i>
                      </button>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control family-name" name="family[${
                          familyCount - 1
                        }][name]">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Relationship</label>
                        <input type="text" class="form-control family-relationship" name="family[${
                          familyCount - 1
                        }][relationship]">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Residential Address</label>
                        <input type="text" class="form-control family-address" name="family[${
                          familyCount - 1
                        }][address]">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control family-phone" name="family[${
                          familyCount - 1
                        }][phone]">
                      </div>
                    </div>
                  </div>
                `;
                $("#family-container").append(newFamily);

                if (familyCount >= 5) {
                  $("#add-family").prop("disabled", true);
                  $("#max-family-message").removeClass("d-none");
                }
              }
            });

            // Remove family member
            $(document).on("click", ".remove-family", function () {
              $(this).closest(".family-card").remove();
              familyCount--;
              $("#add-family").prop("disabled", false);
              $("#max-family-message").addClass("d-none");
              // Renumber remaining family members
              $(".family-card").each(function (index) {
                $(this)
                  .find("h4")
                  .text(`Family Member ${index + 1}`);
              });
            });

            // Add employment
            let employmentCount = 1;
            $("#add-employment").click(function () {
              employmentCount++;
              const newEmployment = `
                <div class="employment-card">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="h5 mb-0">Employment ${employmentCount}</h4>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-employment">
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Company Name</label>
                      <input type="text" class="form-control employment-company" name="employment[${
                        employmentCount - 1
                      }][companyName]">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Company Address</label>
                      <input type="text" class="form-control employment-address" name="employment[${
                        employmentCount - 1
                      }][address]">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Designation</label>
                      <input type="text" class="form-control employment-designation" name="employment[${
                        employmentCount - 1
                      }][designation]">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Start Year</label>
                      <input type="number" class="form-control employment-start" name="employment[${
                        employmentCount - 1
                      }][startYear]">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">End Year</label>
                      <input type="number" class="form-control employment-end" name="employment[${
                        employmentCount - 1
                      }][endYear]">
                    </div>
                    <div class="col-md-6">
                      <div class="form-check mt-4">
                        <input class="form-check-input employment-current" type="checkbox" id="current-${
                          employmentCount - 1
                        }" name="employment[${
                employmentCount - 1
              }][isCurrentEmployment]">
                        <label class="form-check-label" for="current-${
                          employmentCount - 1
                        }">
                          This is my current employment
                        </label>
                      </div>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Description of Company</label>
                      <textarea class="form-control employment-description" name="employment[${
                        employmentCount - 1
                      }][description]" rows="3"></textarea>
                    </div>
                  </div>
                </div>
              `;
              $("#employment-container").append(newEmployment);
            });

            // Remove employment
            $(document).on("click", ".remove-employment", function () {
              $(this).closest(".employment-card").remove();
              employmentCount--;
              // Renumber remaining employments
              $(".employment-card").each(function (index) {
                $(this)
                  .find("h4")
                  .text(`Employment ${index + 1}`);
              });
            });

            // Camera functionality
            let cameraStream = null;

            // Start Camera
            $("#start-camera").click(function () {
              navigator.mediaDevices
                .getUserMedia({ video: true })
                .then(function (stream) {
                  cameraStream = stream;
                  $("#camera-stream").get(0).srcObject = stream;
                  $("#camera-stream").show();
                  $("#capture-photo, #close-camera").show();
                  $("#start-camera").hide();
                  $("#photo-preview").hide();
                })
                .catch(function (err) {
                  alert("Unable to access camera: " + err);
                });
            });

            // Capture Photo
            $("#capture-photo").click(function () {
              const video = $("#camera-stream").get(0);
              const canvas = $("#snapshot").get(0);
              const context = canvas.getContext("2d");

              context.drawImage(video, 0, 0, canvas.width, canvas.height);

              const dataUrl = canvas.toDataURL("image/png");
              $("#photo-preview").attr("src", dataUrl).show();
              $("#passportPhotoData").val(dataUrl);

              // Stop the camera after capture
              if (cameraStream) {
                cameraStream.getTracks().forEach((track) => track.stop());
                cameraStream = null;
              }

              $("#camera-stream, #capture-photo, #close-camera").hide();
              $("#start-camera").show();
            });

            // Close Camera Manually
            $("#close-camera").click(function () {
              if (cameraStream) {
                cameraStream.getTracks().forEach((track) => track.stop());
                cameraStream = null;
              }
              $("#camera-stream").hide();
              $("#capture-photo, #close-camera").hide();
              $("#start-camera").show();
            });

            // Upload Photo (from File)
            $("#upload-photo-btn").click(function () {
              $("#passportPhoto").click();
            });

            $("#passportPhoto").change(function (e) {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                  $("#photo-preview").attr("src", event.target.result).show();
                  $("#passportPhotoData").val(event.target.result);

                  // Stop camera if open for UX
                  if (cameraStream) {
                    cameraStream.getTracks().forEach((track) => track.stop());
                    cameraStream = null;
                    $("#camera-stream, #capture-photo, #close-camera").hide();
                    $("#start-camera").show();
                  }
                };
                reader.readAsDataURL(file);
              }
            });

            // Form functions
            function updateFormData() {
              // Update formData with all form values
              $("input, select, textarea").each(function () {
                const name = $(this).attr("name");
                if (name) {
                  if ($(this).attr("type") === "checkbox") {
                    formData[name] = $(this).is(":checked");
                  } else {
                    formData[name] = $(this).val();
                  }
                }
              });

              // Handle arrays (neighbors, family, employment)
              const neighbors = [];
              $(".neighbor-card").each(function (index) {
                neighbors.push({
                  name: $(this).find(".neighbor-name").val(),
                  address: $(this).find(".neighbor-address").val(),
                  phone: $(this).find(".neighbor-phone").val(),
                });
              });
              formData.neighbors = neighbors;

              const family = [];
              $(".family-card").each(function (index) {
                family.push({
                  name: $(this).find(".family-name").val(),
                  relationship: $(this).find(".family-relationship").val(),
                  address: $(this).find(".family-address").val(),
                  phone: $(this).find(".family-phone").val(),
                });
              });
              formData.family = family;

              const employment = [];
              $(".employment-card").each(function (index) {
                employment.push({
                  companyName: $(this).find(".employment-company").val(),
                  address: $(this).find(".employment-address").val(),
                  designation: $(this).find(".employment-designation").val(),
                  startYear: $(this).find(".employment-start").val(),
                  endYear: $(this).find(".employment-end").val(),
                  isCurrentEmployment: $(this)
                    .find(".employment-current")
                    .is(":checked"),
                  description: $(this).find(".employment-description").val(),
                });
              });
              formData.employment = employment;
            }

            function nextStep() {
              if (currentStep < totalSteps - 1) {
                updateFormData();
                if (!completedSteps.includes(currentStep)) {
                  completedSteps.push(currentStep);
                }
                currentStep++;
                updateProgress();
                updateStepButtons();
                showCurrentStep();
              }
            }

            function prevStep() {
              if (currentStep > 0) {
                currentStep--;
                updateProgress();
                updateStepButtons();
                showCurrentStep();
              }
            }

            function goToStep(stepIndex) {
              if (stepIndex <= Math.max(...completedSteps, currentStep)) {
                currentStep = stepIndex;
                updateProgress();
                updateStepButtons();
                showCurrentStep();
              }
            }

            function showCurrentStep() {
              $(".form-section").removeClass("active");
              $(`#step-${currentStep}`).addClass("active");

              // Show/hide navigation buttons
              if (currentStep === totalSteps - 1) {
                $("#next-btn").addClass("d-none");
                $("#submit-btn").removeClass("d-none");
              } else {
                $("#next-btn").removeClass("d-none");
                $("#submit-btn").addClass("d-none");
              }

              $("#prev-btn").prop("disabled", currentStep === 0);
            }

            function updateProgress() {
              const progress = ((currentStep + 1) / totalSteps) * 100;
              $("#progress-bar")
                .css("width", progress + "%")
                .attr("aria-valuenow", progress);
              $("#step-counter").text(
                `Step ${currentStep + 1} of ${totalSteps}`
              );
              $("#progress-percent").text(`${Math.round(progress)}% Complete`);
            }

            function updateStepButtons() {
              const maxCompletedStep = Math.max(...completedSteps, currentStep);
              $("#step-buttons button").each(function (index) {
                $(this).removeClass("active completed disabled");
                if (index === currentStep) {
                  $(this).addClass("active");
                } else if (completedSteps.includes(index)) {
                  $(this).addClass("completed");
                } else if (index > maxCompletedStep) {
                  $(this).addClass("disabled");
                }
              });
            }

            function handleSubmit() {
              updateFormData();
              console.log("Form submitted:", formData);
              // Here you would typically send the data to the server
              alert("Form submitted successfully!");
            }
          });
        </script>

        <script>
          function logout() {
            localStorage.removeItem("token");
          }
        </script>
      </div>
      <!--**********************************
            Content body end
        ***********************************-->

      <!--**********************************
            Footer start
        ***********************************-->
      <div class="footer">
        <div class="copyright">
          <p>Copyright ©BDIC Ltd 2025. All Rights Reserved.</p>
        </div>
      </div>
      <!--**********************************
            Footer end
        ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="vendor/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="js/plugins-init/sweetalert.init.js"></script>
    <script src="vendor/global/global.min.js"></script>
    <script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/moment.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

    <script src="js/dashboard/dashboard-1.js"></script>

    <script src="js/custom.min.js"></script>
    <script src="js/deznav-init.js"></script>
    <script src="js/demo.js"></script>
    <script type="text/javascript" src="../../../js/index.js"></script>
  </body>
</html>
