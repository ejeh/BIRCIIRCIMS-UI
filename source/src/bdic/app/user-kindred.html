<!DOCTYPE html>
<html lang="en">
  <meta
    http-equiv="content-type"
    content="text/html;charset=UTF-8"
  /><!-- /Added by HTTrack -->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="keywords" content="dashboard" />
    <meta name="author" content="Coinit" />
    <meta name="robots" content="index, follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:image" content="social-image.html" />
    <meta name="format-detection" content="telephone=no" />
    <title>
      Benue State Integrated Residents/Citizens Identity/Indigeneship
      Registration and Card Issuance Management System
    </title>
    <!-- Favicon icon -->
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/images/benue-state-logo.png"
    />

    <link
      href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css"
      rel="stylesheet"
    />
    <link href="css/style.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="../../unpkg.com/sweetalert%402.1.2/dist/sweetalert.min.js"></script>
    <link href="vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet" />
    <script src="../../ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//code.jivosite.com/widget/y3nwyLiIJL" async></script>

    <style>
      tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      tr.no-match {
        display: none;
      }

      @media only screen and (max-width: 1400px) {
        .dropdown-menu .dropdown-item {
          padding: 0.1rem 1rem;
          font-size: 0.8rem;
        }
      }

      .dropdown-menu .dropdown-item {
        padding: 0.1rem 1rem;
        font-size: 0.8rem;
      }
      .dropdown-menu {
        min-width: 7rem;
      }
      #addUserForm {
        transition: display 0.3s ease;
      }
      .password-toggle {
        position: absolute;
        right: 12px;
        top: 72%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #666;
      }
    </style>
  </head>

  <body>
    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
      <div class="sk-three-bounce">
        <div class="sk-child sk-bounce1"></div>
        <div class="sk-child sk-bounce2"></div>
        <div class="sk-child sk-bounce3"></div>
      </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
      <!--**********************************
            Nav header start
        ***********************************-->
      <div class="nav-header">
        <!-- Logo Section -->
        <a href="index.html" class="brand-logo">
          <img
            src="/assets/images/benue-state-logo.png"
            alt="Government Logo"
            class="logo-img"
          />
          <div class="brand-text">BIRCIIRCIMS</div>
        </a>

        <!-- Hamburger Menu for Navigation Control -->
        <div class="nav-control">
          <div class="hamburger">
            <span class="line"></span><span class="line"></span
            ><span class="line"></span>
          </div>
        </div>
      </div>
      <!--**********************************
            Nav header end
        ***********************************-->

      <!--**********************************
            Header start
        ***********************************-->
      <div class="header">
        <div class="header-content">
          <nav class="navbar navbar-expand">
            <div class="collapse navbar-collapse justify-content-between">
              <div class="header-left">
                <div class="dashboard_bar">All Kindred</div>
              </div>
              <div>
                <button
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#addUserModal"
                >
                  Add kindred
                </button>
              </div>
              <ul class="navbar-nav header-right">
                <li class="nav-item dropdown notification_dropdown">
                  <div class="input-group search-area">
                    <input
                      id="searchInput"
                      type="text"
                      class="form-control"
                      placeholder="Search here..."
                      onkeyup="searchTable()"
                    />
                    <span class="input-group-text"
                      ><a href="javascript:void(0)"
                        ><i class="flaticon-381-search-2"></i></a
                    ></span>
                  </div>
                </li>
              </ul>
            </div>
          </nav>
        </div>
      </div>

      <!-- Add New Kindred Modal -->
      <div
        class="modal fade"
        id="addUserModal"
        tabindex="-1"
        aria-labelledby="addUserModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addUserModalLabel">
                Register New Kindred
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="signUpForm" novalidate>
                <div class="row">
                  <!-- First Name -->
                  <div class="col-md-4 mb-3">
                    <label for="firstname" class="form-label">First Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="firstname"
                      name="firstname"
                      required
                      autocomplete="given-name"
                      aria-describedby="firstnameHelp"
                    />
                    <small id="firstnameHelp" class="form-text text-muted">
                      Enter your first name
                    </small>
                  </div>

                  <!-- Last Name -->
                  <div class="col-md-4 mb-3">
                    <label for="lastname" class="form-label">Last Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="lastname"
                      name="lastname"
                      required
                      autocomplete="family-name"
                      aria-describedby="lastnameHelp"
                    />
                    <small id="lastnameHelp" class="form-text text-muted">
                      Enter your last name
                    </small>
                  </div>

                  <!-- Email -->
                  <div class="col-md-4 mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                      required
                      autocomplete="email"
                      aria-describedby="emailHelp"
                    />
                    <small id="emailHelp" class="form-text text-muted">
                      Enter a valid email address
                    </small>
                  </div>
                </div>

                <div class="row">
                  <!-- Phone -->
                  <div class="col-md-4 mb-3">
                    <label for="phone" class="form-label">Phone</label>
                    <input
                      type="tel"
                      class="form-control"
                      id="phone"
                      name="phone"
                      maxlength="11"
                      pattern="^0[7-9][0-1]\d{8}$"
                      required
                      autocomplete="tel-national"
                      aria-describedby="phoneHelp"
                    />
                    <small id="phoneHelp" class="form-text text-muted">
                      Enter a valid Nigerian phone number
                    </small>
                  </div>

                  <!-- Password -->
                  <div class="col-md-4 mb-3">
                    <div class="position-relative">
                      <label for="password" class="form-label">Password</label>
                      <input
                        type="password"
                        class="form-control"
                        id="password"
                        name="password"
                        autocomplete="new-password"
                        required
                        aria-describedby="passwordHelp"
                      />
                      <span
                        class="password-toggle"
                        id="togglePassword"
                        role="button"
                        tabindex="0"
                      >
                        <i class="fa-solid fa-eye-slash"></i>
                      </span>
                    </div>
                    <small id="passwordHelp" class="form-text text-muted">
                      At least 8 characters with uppercase, lowercase, number,
                      and symbol
                    </small>
                  </div>

                  <!-- Confirm Password -->
                  <div class="col-md-4 mb-3">
                    <label for="re_password" class="form-label"
                      >Confirm Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="re_password"
                      name="re_password"
                      required
                      autocomplete="new-password"
                      aria-describedby="rePasswordHelp"
                    />
                    <small id="rePasswordHelp" class="form-text text-muted">
                      Re-type your password
                    </small>
                  </div>
                </div>

                <div class="row">
                  <!-- State of Origin -->
                  <div class="col-md-4 mb-3">
                    <label for="stateOfOrigin" class="form-label"
                      >State of Origin</label
                    >
                    <select
                      id="stateOfOrigin"
                      name="stateOfOrigin"
                      class="form-control"
                      required
                      aria-describedby="stateHelp"
                      onchange="updateLocalGovernmentsOfOrigin()"
                    >
                      <option value="">Select State</option>
                      <option value="abia">Abia</option>
                      <option value="adamawa">Adamawa</option>
                      <option value="akwa_ibom">Akwa Ibom</option>
                      <option value="anambra">Anambra</option>
                      <option value="bauchi">Bauchi</option>
                      <option value="bayelsa">Bayelsa</option>
                      <option value="benue">Benue</option>
                      <option value="borno">Borno</option>
                      <option value="cross_river">Cross River</option>
                      <option value="delta">Delta</option>
                      <option value="ebonyi">Ebonyi</option>
                      <option value="edo">Edo</option>
                      <option value="ekiti">Ekiti</option>
                      <option value="enugu">Enugu</option>
                      <option value="gombe">Gombe</option>
                      <option value="imo">Imo</option>
                      <option value="jigawa">Jigawa</option>
                      <option value="kaduna">Kaduna</option>
                      <option value="kano">Kano</option>
                      <option value="katsina">Katsina</option>
                      <option value="kebbi">Kebbi</option>
                      <option value="kogi">Kogi</option>
                      <option value="kwara">Kwara</option>
                      <option value="lagos">Lagos</option>
                      <option value="nasarawa">Nasarawa</option>
                      <option value="niger">Niger</option>
                      <option value="ogun">Ogun</option>
                      <option value="ondo">Ondo</option>
                      <option value="osun">Osun</option>
                      <option value="oyo">Oyo</option>
                      <option value="plateau">Plateau</option>
                      <option value="rivers">Rivers</option>
                      <option value="sokoto">Sokoto</option>
                      <option value="taraba">Taraba</option>
                      <option value="yobe">Yobe</option>
                      <option value="zamfara">Zamfara</option>
                      <option value="abuja">Abuja (FCT)</option>
                    </select>
                  </div>
                  <div class="col-sm-4 m-b30">
                    <label class="form-label">Select LGA Of Origin</label>
                    <!-- class="form-select" -->
                    <select
                      id="lgaOfOrigin"
                      class="nice-select form-control wide mh-auto"
                    >
                      <option value="">Select Local Government</option>
                    </select>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="kimdred" class="form-label">Kindred</label>
                    <input
                      type="text"
                      class="form-control"
                      id="kindred"
                      name="kindred"
                      required
                      autocomplete="kindred"
                      aria-describedby="kindredHelp"
                    />
                    <small class="form-text text-muted">
                      Enter your kindred name
                    </small>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input
                      type="text"
                      class="form-control"
                      id="address"
                      name="address"
                      required
                      autocomplete="address"
                      aria-describedby="rePasswordHelp"
                    />
                    <small class="form-text text-muted">
                      Enter your address
                    </small>
                  </div>

                  <!-- NIN -->
                  <div class="col-md-6 mb-3">
                    <label for="NIN" class="form-label">NIN</label>
                    <input
                      type="text"
                      class="form-control"
                      id="NIN"
                      name="NIN"
                      maxlength="11"
                      minlength="11"
                      required
                      inputmode="numeric"
                      pattern="\d{11}"
                      aria-describedby="ninHelp"
                      autocomplete="off"
                    />
                    <small id="ninHelp" class="form-text text-muted">
                      Enter your 11-digit NIN
                    </small>
                    <div id="ninStatus" class="mt-1 text-sm text-info"></div>
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button type="submit" id="submitbtn" class="btn btn-primary">
                    Sign Up
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

      <!--**********************************
            Sidebar start
        ***********************************-->
      <div class="deznav">
        <div class="deznav-scroll">
          <ul class="metismenu" id="menu">
            <!-- Super Admin Menu -->
            <li class="super-admin-menu">
              <a class="ai-icon" href="index.html" aria-expanded="false">
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>

            <!-- user Menu -->
            <li class="user-menu">
              <a
                class="ai-icon"
                href="user-dasboard.html"
                aria-expanded="false"
              >
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="approvals.html" aria-expanded="false">
                <i class="fa fa-exchange" aria-hidden="true"></i>
                <span class="nav-text">Approvals</span>
              </a>
            </li>

            <li class="user-menu">
              <a class="ai-icon" href="request.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Certificate Status</span>
              </a>
            </li>
            <li class="user-menu">
              <a class="ai-icon" href="idcard.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Card Status</span>
              </a>
            </li>

            <!-- Super Admin Menu -->
            <li class="super-admin-menu">
              <a class="ai-icon" href="all-request.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Certificate Request</span>
              </a>
            </li>

            <li class="super-admin-menu">
              <a class="ai-icon" href="all-card.html" aria-expanded="false">
                <i class="fa fa-money" aria-hidden="true"></i>
                <span class="nav-text">View Card Request</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="citizens.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>

                <span class="nav-text">Users</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="kindred.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">Kindreds</span>
              </a>
            </li>

            <li class="support-admin-menu">
              <a class="ai-icon" href="user-kindred.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">Kindreds</span>
              </a>
            </li>
            <li class="support-admin-menu">
              <a
                class="ai-icon"
                href="support-admin-lga.html"
                aria-expanded="false"
              >
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">Support Admin LGA</span>
              </a>
            </li>
            <!-- User-menu -->
            <li class="user-menu">
              <a class="ai-icon" href="certificate.html" aria-expanded="false">
                <i class="fa fa-user-plus" aria-hidden="true"></i>
                <span class="nav-text">Request Certificate</span>
              </a>
            </li>

            <li class="user-menu">
              <a class="ai-icon" href="profile.html" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="nav-text">User Account</span>
              </a>
            </li>
            <li class="super-admin-menu">
              <a class="ai-icon" href="transaction.html" aria-expanded="false">
                <i class="flaticon-381-networking"></i>
                <span class="nav-text">transactions</span>
              </a>
            </li>
            <li>
              <a class="ai-icon" href="../../../auth/login.html" aria-expanded="false">
                <i class="fa fa-sign-out" aria-hidden="true"></i>
                <span class="nav-text" onclick="logout(this)">Logout</span>
              </a>
            </li>
          </ul>
          <div class="copyright">
            <p>Powered By BDIC <br />© 2025 All Rights Reserved</p>
            <p class="op5"></p>
          </div>
        </div>
      </div>
      <!--**********************************
            Sidebar end
        ***********************************-->

      <!--**********************************
            Content body start
        ***********************************-->
      <div class="content-body">
        <div class="container-fluid">
          <div class="row">
            <div class="col-xl-12">
              <div class="filter cm-content-box box-primary mt-5">
                <div class="cm-content-body form excerpt">
                  <div class="card-body">
                    <div
                      class="table-responsive"
                      data-pattern="priority-columns"
                    >
                      <table
                        id="dataTable"
                        class="table table-small-font mb-10 table-bordered table-striped table-hover"
                      >
                        <thead class="table-dark">
                          <tr>
                            <th>#</th>
                            <th>Fullname</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Kindred</th>
                            <th>LGA</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody id="user-kindred-table"></tbody>
                      </table>
                      <div class="d-flex justify-content-between">
                        <button id="btn-prev" class="btn" disabled>
                          Previous
                        </button>
                        <button id="btn-next" class="btn">Next</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <script
          src="../../code.tidio.co_443/bpnp4xkz2axqrebqxcezgdca9yot1iyn.js"
          async
        ></script>

        <script>
          function logout() {
            localStorage.removeItem("token");
          }
        </script>
      </div>
      <!--**********************************
            Content body end
        ***********************************-->

      <!--**********************************
            Footer start
        ***********************************-->
      <div class="footer">
        <div class="copyright">
          <p>Copyright ©BDIC Ltd 2025. All rights reserved.</p>
        </div>
      </div>
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->
    <script
      src="../../code.tidio.co_443/bpnp4xkz2axqrebqxcezgdca9yot1iyn.js"
      async
    ></script>

    <script>
      $(document).ready(function () {
        // Toggle password visibility
        $("#togglePassword").click(function () {
          const passwordInput = $("#password");
          const type =
            passwordInput.attr("type") === "password" ? "text" : "password";
          passwordInput.attr("type", type);
          $(this).find("i").toggleClass("fa-eye fa-eye-slash");
        });

        // Helper function to display error messages
        const showError = (input, message) => {
          const formGroup = input.closest(".mb-3");
          const errorElement = formGroup.querySelector(".error-message");

          if (!errorElement) {
            const errorDiv = document.createElement("div");
            errorDiv.className = "error-message text-danger mt-1";
            errorDiv.innerText = message;
            formGroup.appendChild(errorDiv);
          } else {
            errorElement.innerText = message;
          }

          input.classList.add("is-invalid");
        };

        // Helper function to clear error messages
        const clearError = (input) => {
          const formGroup = input.closest(".mb-3");
          const errorElement = formGroup.querySelector(".error-message");

          if (errorElement) {
            errorElement.remove();
          }

          input.classList.remove("is-invalid");
        };

        // Validation functions for each field
        const validateFirstName = (input) => {
          const value = input.value.trim();
          if (!value) {
            showError(input, "First name is required.");
            return false;
          } else if (!/^[a-zA-Z]+$/.test(value)) {
            showError(input, "First name should contain only letters.");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validateLastName = (input) => {
          const value = input.value.trim();
          if (!value) {
            showError(input, "Last name is required.");
            return false;
          } else if (!/^[a-zA-Z]+$/.test(value)) {
            showError(input, "Last name should contain only letters.");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validateEmail = (input) => {
          const value = input.value.trim();
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!value) {
            showError(input, "Email is required.");
            return false;
          } else if (!emailRegex.test(value)) {
            showError(input, "Please enter a valid email address.");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validatePhone = (input) => {
          const value = input.value.trim();
          const phoneRegex = /^0[7-9][0-1]\d{8}$/;
          if (!value) {
            showError(input, "Phone number is required.");
            return false;
          } else if (!phoneRegex.test(value)) {
            showError(input, "Please enter a valid Nigerian phone number.");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validatePassword = (input) => {
          const value = input.value.trim();
          const passwordRegex =
            /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#])[A-Za-z\d@$!%*?&#]{8,}$/;
          if (!value) {
            showError(input, "Password is required.");
            return false;
          } else if (!passwordRegex.test(value)) {
            showError(input, "Error");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validateConfirmPassword = (input) => {
          const value = input.value.trim();
          const password = $("#password").val().trim();
          if (!value) {
            showError(input, "Please confirm your password.");
            return false;
          } else if (value !== password) {
            showError(input, "Passwords do not match.");
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        const validateNIN = (input) => {
          const value = input.value.trim();
          if (!value) {
            showError(input, "NIN is required.");
            return false;
          } else if (!/^\d{11}$/.test(value)) {
            showError(
              input,
              "NIN should contain only numbers and be exactly 11 digits long."
            );
            return false;
          } else {
            clearError(input);
            return true;
          }
        };

        // Attach event listeners for real-time validation
        $("#firstname").on("input blur", function () {
          validateFirstName(this);
        });

        $("#lastname").on("input blur", function () {
          validateLastName(this);
        });

        $("#email").on("input blur", function () {
          validateEmail(this);
        });

        $("#phone").on("input blur", function () {
          validatePhone(this);
        });

        $("#password").on("input blur", function () {
          validatePassword(this);
        });

        $("#re_password").on("input blur", function () {
          validateConfirmPassword(this);
        });

        $("#NIN").on("input blur", function () {
          validateNIN(this);
        });

        $("#NIN").on("blur", async function () {
          const nin = $(this).val().trim();
          if (/^\d{11}$/.test(nin)) {
            try {
              $("#ninStatus").html(
                '<span class="text-info">Verifying NIN...</span>'
              );

              const response = await $.ajax({
                url: `${BACKEND_URL}/auth/verify`, // Replace with your endpoint
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ nin }),
              });

              if (response.success && response.data) {
                const { fullName, dob, phone, stateOfOrigin, lga } =
                  response.data;

                const nameParts = fullName.trim().split(" ");
                const firstname = nameParts[0];
                const lastname = nameParts.slice(1).join(" ");

                $("#firstname").val(firstname).prop("readonly", true);
                $("#lastname").val(lastname).prop("readonly", true);
                $("#phone").val(phone).prop("readonly", true);

                // Populate state of origin
                if (stateOfOrigin) {
                  // Convert stateOfOrigin to match your select options
                  let formattedState = stateOfOrigin
                    .toLowerCase()
                    .replace(/\s+/g, "_");

                  // Set the value and trigger change to update LGA dropdown
                  $("#stateOfOrigin")
                    .val(formattedState)
                    .trigger("change")
                    .prop("readonly", true);

                  // If you're using Bootstrap selectpicker
                  if ($("#stateOfOrigin").hasClass("selectpicker")) {
                    $("#stateOfOrigin").selectpicker("refresh");
                  }
                  // Populate LGA after a small delay to ensure state change is processed
                  setTimeout(() => {
                    if (lga) {
                      $("#lgaOfOrigin")
                        .val(lga)
                        .trigger("change")
                        .prop("readonly", true);

                      if ($("#lgaOfOrigin").hasClass("selectpicker")) {
                        $("#lgaOfOrigin").selectpicker("refresh");
                      }
                    }
                  }, 200);
                }

                $("#ninStatus").html(
                  '<span class="text-success">NIN Verified ✅</span>'
                );
              } else {
                $("#ninStatus").html(
                  '<span class="text-danger">NIN not found.</span>'
                );
              }
            } catch (error) {
              $("#ninStatus").html(
                `<span class="text-danger">${
                  error.responseJSON?.message || "Verification failed."
                }</span>`
              );
            }
          }
        });

        // Form submission handler
        $("#signUpForm").on("submit", function (e) {
          e.preventDefault();

          let userData = localStorage.getItem("token");
          userData = JSON.parse(userData);
          const { token, user } = userData;

          const isFirstNameValid = validateFirstName($("#firstname")[0]);
          const isLastNameValid = validateLastName($("#lastname")[0]);
          const isEmailValid = validateEmail($("#email")[0]);
          const isPhoneValid = validatePhone($("#phone")[0]);
          const isPasswordValid = validatePassword($("#password")[0]);
          const isConfirmPasswordValid = validateConfirmPassword(
            $("#re_password")[0]
          );
          const isNINValid = validateNIN($("#NIN")[0]);

          if (
            isFirstNameValid &&
            isLastNameValid &&
            isEmailValid &&
            isPhoneValid &&
            isPasswordValid &&
            isConfirmPasswordValid &&
            isNINValid
          ) {
            const formData = {
              firstname: $("#firstname").val().trim(),
              lastname: $("#lastname").val().trim(),
              email: $("#email").val().trim(),
              phone: $("#phone").val().trim(),
              password: $("#password").val().trim(),
              NIN: $("#NIN").val().trim(),
              stateOfOrigin: $("#stateOfOrigin").val().trim(),
              address: $("#address").val().trim(),
              lga: $("#lgaOfOrigin").val().trim(),
              kindred: $("#kindred").val().trim(),
              userId: user?.id, // Ensure user is defined
            };

            submitForm(formData);
          }
        });

        // Submit form to backend
        const submitForm = async (formData) => {
          try {
            $("#submitbtn")
              .html('<i class="fa fa-spinner fa-spin"></i>')
              .prop("disabled", true);

            const response = await $.ajax({
              type: "POST",
              url: `${BACKEND_URL}/auth/signup-kindred`,
              contentType: "application/json",
              data: JSON.stringify(formData),
            });

            Swal.fire(
              "Welcome",
              "Please check your email to activate your account. Click OK to continue.",
              "success"
            ).then(() => {
              // Reset the form
              $("#signUpForm")[0].reset();

              // Clear any validation errors
              $(".error-message").remove();
              $(".is-invalid").removeClass("is-invalid");

              // Reset readonly fields if they were set by NIN verification
              $("#firstname").prop("readonly", false);
              $("#lastname").prop("readonly", false);
              $("#phone").prop("readonly", false);

              // Clear NIN verification status
              $("#ninStatus").html("");

            });
          } catch (error) {
            Swal.fire(
              "Oops...",
              error.responseJSON?.message || "An error occurred.",
              "error"
            );
          } finally {
            $("#submitbtn").html("Sign Up").attr("disabled", false);
          }
        };
      });
    </script>

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="vendor/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="js/plugins-init/sweetalert.init.js"></script>
    <script src="vendor/global/global.min.js"></script>
    <script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/moment.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

    <script src="js/dashboard/dashboard-1.js"></script>

    <script src="js/custom.min.js"></script>
    <script src="js/deznav-init.js"></script>
    <script src="js/demo.js"></script>
    <script type="text/javascript" src="../../../js/index.js"></script>
  </body>
</html>
