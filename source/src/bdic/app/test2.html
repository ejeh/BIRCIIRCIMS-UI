<!DOCTYPE html>
<html lang="en">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="keywords" content="dashboard" />
    <meta name="robots" content="index, follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:image" content="social-image.html" />
    <meta name="format-detection" content="telephone=no" />
    <title>
      Benue State Integrated Residents/Citizens Identity/Indigeneship
      Registration and Card Issuance Management System
    </title>
    <!-- Favicon icon -->
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/images/benue-state-logo.png"
    />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css"
      rel="stylesheet"
    />
    <link href="css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="/source/auth/styles.css" />
    <link rel="stylesheet" href="/source/src/bdic/app/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="../../unpkg.com/sweetalert%402.1.2/dist/sweetalert.min.js"></script>
    <link href="vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet" />
    <script src="../../ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style>
      .error-message {
        color: red;
        font-size: 0.875rem;
        display: none;
      }
      .form-control.error {
        border-color: red;
      }
      /* .form-section {
        display: none;
      } */
      .form-section.active {
        display: block;
      }
      .camera-upload-box video,
      .camera-upload-box canvas,
      .camera-upload-box img {
        border-radius: 8px;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
      <div class="sk-three-bounce">
        <div class="sk-child sk-bounce1"></div>
        <div class="sk-child sk-bounce2"></div>
        <div class="sk-child sk-bounce3"></div>
      </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="d-flex flex-column h-100">
        <!-- Sidebar Header -->
        <div class="p-4 border-bottom">
          <div class="d-flex align-items-center">
            <img
              src="/assets/images/benue-state-logo.png"
              alt="Benue State Logo"
              class="me-3"
              width="40"
            />
            <div>
              <h5 class="mb-0 fw-bold">BIRCIIRCIMS</h5>
              <small class="text-muted" style="font-size: 0.8rem"
                >Identity Management</small
              >
            </div>
          </div>
        </div>

        <!-- Sidebar Content -->
        <div class="flex-grow-1 py-3 px-4 overflow-auto" id="sidebar-links">
          <div class="mb-5 p-2 text-muted">
            <h6 class="text-uppercase text-muted small mb-3 mt-3">User</h6>
            <ul class="nav flex-column">
              <li class="nav-item user-menu">
                <a
                  href="user-dasboard.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i
                    class="bi bi-speedometer2 me-2 me-3 fs-5 text-secondary"
                  ></i>
                  <span> Dashboard</span>
                </a>
              </li>
              <li class="nav-item user-menu">
                <a href="card.html" class="nav-link d-flex align-items-center">
                  <i class="bi bi-credit-card text-secondary me-3 fs-5"></i>
                  <span>Request Card</span>
                </a>
              </li>
              <li class="nav-item user-menu">
                <a
                  href="certificate.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i class="bi bi-file-text text-primary me-3 fs-5"></i>
                  <span>Request Certificate</span>
                </a>
              </li>
              <li class="nav-item user-menu">
                <a
                  href="request.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i class="bi bi-file-text text-secodary me-3 fs-5"></i>
                  <span>View Certificate Status</span>
                </a>
              </li>
              <li class="nav-item user-menu">
                <a
                  href="idcard.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i class="bi bi-credit-card fs-5 text-secodary me-3"></i>
                  <span>View Card Status</span>
                </a>
              </li>

              <li class="nav-item user-menu">
                <a
                  href="profile.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i class="bi bi-person text-secodary fs-5 me-3"></i>
                  <span>User Account</span>
                </a>
              </li>
            </ul>
          </div>

          <div>
            <h6 class="text-uppercase text-muted small mb-3">Account</h6>
            <ul class="nav flex-column">
              <li class="nav-item mb-1">
                <a href="#" class="nav-link d-flex align-items-center">
                  <i class="fas fa-cog me-3"></i>
                  <span>Settings</span>
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="../../..//auth/login.html"
                  class="nav-link d-flex align-items-center"
                >
                  <i class="fas fa-sign-out-alt me-3"></i>
                  <span onclick="logout(this)">Logout</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="overlay" id="sidebar-overlay"></div>

        <!-- Sidebar Footer -->
        <div class="p-3 border-top text-center">
          <small class="text-muted">Powered by BDIC</small>
          <p class="small text-muted mb-0">Â© 2025 All Rights Reserved</p>
        </div>
      </div>
    </div>

    <!--**********************************
            Sidebar end
        ***********************************-->

    <!--**********************************
            Content body start
        ***********************************-->
    <div class="main-content">
      <!-- Header -->
      <header class="navbar navbar-expand-lg bg-white shadow-sm px-4 py-3">
        <div class="container-fluid">
          <button class="btn d-lg-none" id="sidebarToggle">
            <i class="fas fa-bars"></i>
          </button>

          <div class="d-none d-md-block align-items-center">
            <h5 class="mb-0 me-2">Profile</h5>
            <small class="text-muted"
              >Welcome back, <span id="header-user-label"> User </span>
            </small>
          </div>

          <div class="ms-auto d-flex align-items-center">
            <div class="d-none d-md-flex position-relative me-3">
              <i
                class="fas fa-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"
              ></i>
              <input
                type="search"
                class="form-control ps-5"
                id="searchInput"
                placeholder="Search here..."
                onkeyup="searchTable()"
                style="width: 250px"
              />
            </div>

            <div class="dropdown me-3">
              <button class="btn position-relative" data-bs-toggle="dropdown">
                <i class="fas fa-bell"></i>
                <span
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge"
                  >3</span
                >
              </button>
              <div
                class="dropdown-menu dropdown-menu-end p-0"
                style="width: 300px"
              >
                <div class="p-3 border-bottom">
                  <h6 class="mb-0">Notifications</h6>
                </div>
                <div class="overflow-auto" style="max-height: 300px">
                  <a href="#" class="dropdown-item p-3 border-bottom">
                    <div class="d-flex justify-content-between">
                      <span class="fw-medium">New Certificate Request</span>
                      <small class="text-muted">5 min ago</small>
                    </div>
                    <small class="text-muted d-block mt-1"
                      >John Doe submitted a new certificate application</small
                    >
                  </a>
                  <a href="#" class="dropdown-item p-3 border-bottom">
                    <div class="d-flex justify-content-between">
                      <span class="fw-medium">Card Ready for Pickup</span>
                      <small class="text-muted">1 hour ago</small>
                    </div>
                    <small class="text-muted d-block mt-1"
                      >ID Card for Jane Smith is ready for collection</small
                    >
                  </a>
                  <a href="#" class="dropdown-item p-3">
                    <div class="d-flex justify-content-between">
                      <span class="fw-medium">System Update</span>
                      <small class="text-muted">2 hours ago</small>
                    </div>
                    <small class="text-muted d-block mt-1"
                      >Database backup completed successfully</small
                    >
                  </a>
                </div>
              </div>
            </div>

            <div class="dropdown">
              <button class="btn p-0" data-bs-toggle="dropdown">
                <div class="avatar">AD</div>
              </button>
              <div class="dropdown-menu dropdown-menu-end">
                <div class="px-4 py-3">
                  <h6 class="mb-0">Administrator</h6>
                  <small class="text-muted">admin@benue.gov.ng</small>
                </div>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item"
                  ><i class="fas fa-user me-2"></i> Profile</a
                >
                <a href="#" class="dropdown-item"
                  ><i class="fas fa-cog me-2"></i> Settings</a
                >
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item text-danger"
                  ><i class="fas fa-sign-out-alt me-2"></i> Logout</a
                >
              </div>
            </div>
          </div>
        </div>
      </header>
      <div class="container-fluid py-4">
        <form
          class="profile-form"
          id="unifiedForm"
          enctype="multipart/form-data"
        >
          <!-- Profile Details -->
          <div class="row form-section" id="profile-details-section">
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Profile Details</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Form fields for Profile Details -->
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">First Name</label>
                      <input
                        type="text"
                        class="form-control"
                        name="firstname"
                        id="first_name"
                        value="firstname"
                        readonly
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Lastname</label>
                      <input
                        id="lastname"
                        type="text"
                        name="lastname"
                        class="form-control"
                        readonly
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Middlename</label>
                      <input
                        id="middlename"
                        type="text"
                        class="form-control"
                        name="middlename"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Gender</label>
                      <select
                        id="gender"
                        name="gender"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Marital Status</label>
                      <select
                        id="maritalStatus"
                        name="maritalStatus"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="single">Single</option>
                        <option value="married">Married</option>
                        <option value="divorced">Divorced</option>
                        <option value="widowed">Widowed</option>
                      </select>
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Date Of Birth</label>
                      <input
                        id="DOB"
                        type="date"
                        class="form-control"
                        name="DOB"
                        min="1900-01-01"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Select State Of Origin</label>

                      <input
                        id="stateOfOrigin"
                        type="text"
                        class="form-control"
                        name="stateOfOrigin"
                        readonly
                        onchange="updateLocalGovernmentsOfOrigin()"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Select Local Government Of Origin</label
                      >
                      <!-- class="form-select" -->
                      <select
                        id="lgaOfOrigin"
                        class="nice-select form-control wide mh-auto"
                      >
                        <option value="">Select Local Government</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Nationality</label>
                      <input
                        id="nationality"
                        type="text"
                        class="form-control"
                        name="nationality"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Community</label>
                      <input
                        id="community"
                        type="text"
                        class="form-control"
                        name="community"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Religion</label>
                      <select
                        id="religion"
                        name="religion"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="">--Select--</option>
                        <option value="christain">Christain</option>
                        <option value="muslim">Muslim</option>
                        <option value="others">Others</option>
                      </select>
                    </div>

                    <div class="col-sm-4 m-b30">
                      <label class="form-label"
                        >Recent Passport Photograph</label
                      >
                      <div
                        class="camera-upload-box text-center border rounded p-3"
                      >
                        <video
                          id="camera-stream"
                          width="100%"
                          height="200"
                          autoplay
                          playsinline
                          style="display: none; border-radius: 8px"
                        ></video>
                        <canvas
                          id="snapshot"
                          width="300"
                          height="200"
                          style="display: none"
                        ></canvas>
                        <img
                          id="photo-preview"
                          src=""
                          alt="Passport Preview"
                          class="img-thumbnail mb-2"
                          style="display: none; max-width: 100%; height: auto"
                        />

                        <div class="btn-group mb-2">
                          <button
                            type="button"
                            class="btn btn-outline-primary"
                            id="start-camera"
                          >
                            Open Camera
                          </button>
                          <button
                            type="button"
                            class="btn btn-outline-success"
                            id="capture-photo"
                            style="display: none"
                          >
                            Capture
                          </button>
                          <button
                            type="button"
                            class="btn btn-outline-danger"
                            id="close-camera"
                            style="display: none"
                          >
                            Close Camera
                          </button>
                        </div>

                        <input
                          type="file"
                          id="passportPhoto"
                          name="passportPhoto"
                          class="form-control"
                          accept="image/*"
                          style="display: none"
                        />
                        <small class="text-muted d-block"
                          >Or
                          <button
                            type="button"
                            class="btn btn-link p-0"
                            id="upload-photo-btn"
                          >
                            Upload Photo
                          </button>
                          instead.</small
                        >

                        <input
                          type="hidden"
                          name="passportPhotoData"
                          id="passportPhotoData"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="Residential-Address-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Residential Address -->

          <div
            class="row form-section"
            id="Residential-Address-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Residential Address</h4>
                </div>

                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">House Number</label>
                      <input
                        type="text"
                        class="form-control"
                        id="house_number"
                        name="house_number"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Street Name</label>
                      <input
                        id="street_name"
                        type="text"
                        name="street_name"
                        class="form-control"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Nearest Bus-Stop/Landmark</label
                      >
                      <input
                        id="nearest_bus_stop_landmark"
                        type="text"
                        name="nearest_bus_stop_landmark"
                        class="form-control"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Select State Of Residence</label
                      >

                      <select
                        id="stateOfResidence"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                        onchange="updateLocalGovernmentsOfResidence()"
                      >
                        <option value="">Select State</option>
                        <option value="adamawa">Adamawa</option>
                        <option value="akwa_ibom">Akwa Ibom</option>
                        <option value="anambra">Anambra</option>
                        <option value="abia">Abia</option>
                        <option value="bauchi">Bauchi</option>
                        <option value="benue">Benue</option>
                        <option value="borno">Borno</option>
                        <option value="bayelsa">Bayelsa</option>
                        <option value="delta">Delta</option>
                        <option value="ebonyi">Ebonyi</option>
                        <option value="edo">Edo</option>
                        <option value="enugu">Enugu</option>
                        <option value="abuja">abuja</option>
                        <option value="gombe">Gombe</option>
                        <option value="jigawa">Jigawa</option>
                        <option value="ekiti">Ekiti</option>
                        <option value="lagos">Lagos</option>
                        <option value="oyo">Oyo</option>
                        <option value="imo">Imo</option>
                        <option value="kaduna">Kaduna</option>
                        <option value="kebbi">Kebbi</option>
                        <option value="kano">Kano</option>
                        <option value="kogi">Kogi</option>
                        <option value="osun">Osun</option>
                        <option value="sokoto">Sokoto</option>
                        <option value="plateau">Plateau</option>
                        <option value="taraba">Taraba</option>
                        <option value="yobe">Yobe</option>
                        <option value="zamfara">zamfara</option>
                        <option value="katsina">Katsina</option>
                        <option value="kwara">Kwara</option>
                        <option value="nasarawa">Nasarawa</option>
                        <option value="niger">Niger</option>
                        <option value="rivers">Rivers</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Select Local Government Of Residence</label
                      >
                      <!-- class="form-select" -->
                      <select
                        id="lgaOfResidence"
                        class="nice-select form-control wide mh-auto"
                      >
                        <option value="">Select Local Government</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label for="countryOfResidence"
                        >Select Country Of Residence:</label
                      >
                      <select
                        id="countryOfResidence"
                        name="countryOfResidence"
                        class="nice-select form-control wide mh-auto"
                      >
                        <option value="">--Select--</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="profile-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="Identity-information-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Identification -->

          <div
            class="row form-section"
            id="Identity-information-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Identification</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Identification</label>
                      <select
                        id="identification"
                        name="identification"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                        onchange="toggleOtherInput(this)"
                      >
                        <option value="national Id">National ID</option>
                        <option value="driver licence">Driver Licence</option>
                        <option value="international passport">
                          INT'L Passport
                        </option>
                        <option value="voter's card">Voter's Card</option>
                        <option value="others">Others</option>
                      </select>
                      <!-- Container for 'Others' input -->
                      <div
                        id="other-identification-container"
                        style="display: none; margin-top: 10px"
                      >
                        <label for="other-identification" class="form-label"
                          >Specify Other Identification</label
                        >
                        <input
                          type="text"
                          id="other-identification"
                          name="other-identification"
                          class="form-control"
                          placeholder="Please specify"
                        />
                      </div>
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">ID Number</label>
                      <input
                        id="id_number"
                        type="text"
                        class="form-control"
                        name="id_number"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Issue Date</label>
                      <input
                        id="issue_date"
                        type="text"
                        class="form-control"
                        name="issue_date"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Expiry Date</label>
                      <input
                        id="expiry_date"
                        type="text"
                        class="form-control"
                        name="expiry_date"
                      />
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="Residential-Address-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="family-information-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- NOK Information -->
          <div
            class="row form-section"
            id="family-information-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Next Of Kin Details</h4>
                </div>
                <!-- NOK section fields -->
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Surname</label>
                      <input
                        type="text"
                        class="form-control"
                        id="nok_surname"
                        name="nok_surname"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">First Name</label>
                      <input
                        id="nok_firstname"
                        type="text"
                        name="nok_firstname"
                        class="form-control"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Middle Name</label>
                      <input
                        id="nok_middlename"
                        type="text"
                        name="nok_middlename"
                        class="form-control"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Relationship</label>
                      <input
                        id="nok_relationship"
                        type="text"
                        class="form-control"
                        name="nok_relationship"
                      />
                    </div>
                    <!-- <h4>Next of Kin Address:</h4> -->
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Country Of Residence</label>
                      <input
                        id="nok_countryOfResidence"
                        type="text"
                        class="form-control"
                        name="nok_countryOfResidence?"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">State Of Residence</label>
                      <input
                        id="nok_stateOfResidence"
                        type="text"
                        class="form-control"
                        name="nok_stateOfResidence"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">LGA Of Residence</label>
                      <input
                        id="nok_lgaOfResidence"
                        type="text"
                        class="form-control"
                        name="nok_lgaOfResidence"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">City/Town Of Residence</label>
                      <input
                        id="nok_cityOfResidence"
                        type="text"
                        class="form-control"
                        name="nok_cityOfResidence"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Address</label>
                      <input
                        id="nok_address"
                        type="text"
                        class="form-control"
                        name="nok_address"
                      />
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="profile-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="contact-details-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div
            class="row form-section"
            id="contact-details-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Contact Details</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Neighbors' Contact Details -->
                    <div class="col-12">
                      <h5 class="section-title">Neighbors' Contact Details</h5>
                    </div>
                    <!-- Container for dynamic fields -->
                    <div class="col-12" id="neighbors-container">
                      <!-- Initial set of fields -->
                      <div class="neighbor-fields m-b30">
                        <label class="form-label">Neighbor 1</label>
                        <input
                          type="text"
                          class="form-control m-b10"
                          name="neighbor_name[]"
                          placeholder="Full Name"
                        />
                        <input
                          type="text"
                          class="form-control m-b10"
                          name="neighbor_address[]"
                          placeholder="Residential Address"
                        />
                        <input
                          type="tel"
                          class="form-control"
                          name="neighbor_phone[]"
                          placeholder="Phone Number"
                        />
                      </div>
                    </div>
                    <!-- Button to add more neighbors -->
                    <div class="col-12">
                      <button
                        type="button"
                        class="btn btn-primary"
                        id="add-neighbor"
                      >
                        Add Another Neighbor
                      </button>
                      <p
                        id="max-neighbors-message"
                        style="display: none; color: red; margin-top: 10px"
                      >
                        Maximum of 5 neighbors reached.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="family-information-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="family-details-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Family Members' Contact Details -->
          <div
            class="row form-section"
            id="family-details-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Contact Details</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-12">
                      <h5 class="section-title">Family' Contact Details</h5>
                    </div>
                    <!-- Container for dynamic fields -->
                    <div class="col-12" id="family-container">
                      <!-- Initial set of fields -->
                      <div class="family-fields m-b30">
                        <label class="form-label">Family 1</label>
                        <input
                          type="text"
                          class="form-control m-b10"
                          name="family_name[]"
                          placeholder="Full Name"
                        />
                        <input
                          type="text"
                          class="form-control m-b10"
                          name="family_relationship[]"
                          placeholder="Relationship"
                        />
                        <input
                          type="text"
                          class="form-control m-b10"
                          name="family_address[]"
                          placeholder="Residential Address"
                        />
                        <input
                          type="tel"
                          class="form-control"
                          name="family_phone[]"
                          placeholder="Phone Number"
                        />
                      </div>
                    </div>
                    <!-- Button to add more neighbors -->
                    <div class="col-12">
                      <button
                        type="button"
                        class="btn btn-primary"
                        id="add-family"
                      >
                        Add Another Family
                      </button>
                      <p
                        id="max-family-message"
                        style="display: none; color: red; margin-top: 10px"
                      >
                        Maximum of 5 family reached.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="contact-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="business-details-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Bussiness Details -->
          <div
            class="row form-section"
            id="business-details-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Business Details</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Form fields for Profile Details -->
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Business Name</label>
                      <input
                        type="text"
                        class="form-control"
                        name="biz_name"
                        id="biz_name"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Business Type </label>
                      <select
                        id="biz_type"
                        name="biz_type"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="sole Proprietorship">
                          Sole Proprietorship
                        </option>
                        <option value="partnership ">Partnership</option>
                        <option value="limited liability company">
                          Limited Liability Company
                        </option>
                        <option value="corporation ">Corporation</option>
                        <option value="cooperative  ">Cooperative</option>
                        <option value="others ">Others</option>
                      </select>
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Business Registration Number (if applicable):</label
                      >
                      <input
                        id="registration_number"
                        type="text"
                        class="form-control"
                        name="registration_number"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Business Address</label>
                      <input
                        id="biz_address"
                        type="text"
                        class="form-control"
                        name="biz_address"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Nature Of Business</label>
                      <select
                        id="nature_of_bussiness"
                        name="nature_of_bussiness"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="retail">Retail</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="ICT">ICT</option>
                        <option value="Agriculture">Agriculture</option>
                        <option value="Others">Others</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Years in Operation</label>
                      <input
                        type="text"
                        id="numberOfYears"
                        class="form-control"
                        name="numberOfYears"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Number of Employees (if applicable)</label
                      >
                      <input
                        id="numberOfEmployees"
                        type="text"
                        class="form-control"
                        name="numberOfEmployees"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Annual Revenue (Optional)</label
                      >
                      <input
                        id="annualRevenue"
                        type="text"
                        class="form-control"
                        name="annualRevenue"
                      />
                    </div>

                    <div class="col-sm-6 m-b30">
                      <label class="form-label"
                        >Tax Identification Number (TIN) (if applicable)</label
                      >
                      <input
                        id="TIN"
                        type="text"
                        class="form-control"
                        name="TIN"
                        maxlength="11"
                        minlength="11"
                      />
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Mobile Number</label>
                      <input
                        class="form-control"
                        type="tel"
                        id="biz_phone"
                        name="biz_phone"
                        maxlength="11"
                        pattern="^0[7-9][0-1]\d{8}$"
                        placeholder="Enter a valid Nigerian phone number"
                      />
                      <span class="error-message">
                        Please enter a valid Nigerian phone number.
                      </span>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Email</label>
                      <input
                        id="biz_email"
                        type="text"
                        class="form-control"
                        name="biz_email"
                      />
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="family-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="employment-details-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Employment/Occupation Details -->
          <div
            class="row form-section"
            id="employment-details-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Employment History Details</h4>
                </div>
                <div class="card-body">
                  <div id="employment-history-container">
                    <!-- Initial Employment History Fields -->
                    <div class="employment-fields m-b30">
                      <!-- Company Name -->
                      <div class="form-group">
                        <label for="companyName">Company Name</label>
                        <input
                          type="text"
                          class="form-control"
                          name="companyName[]"
                          placeholder="Enter company name"
                        />
                      </div>

                      <!-- Address -->
                      <div class="form-group">
                        <label for="address">Address</label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[]"
                          placeholder="Enter company address"
                        />
                      </div>

                      <!-- Designation -->
                      <div class="form-group">
                        <label for="designation">Designation</label>
                        <input
                          type="text"
                          class="form-control"
                          name="designation[]"
                          placeholder="Enter your designation"
                        />
                      </div>

                      <!-- Employment Period -->
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="startYear">Start Year</label>
                          <input
                            type="number"
                            class="form-control"
                            name="startYear[]"
                            placeholder="Enter start year"
                          />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="endYear">End Year</label>
                          <input
                            type="number"
                            class="form-control"
                            name="endYear[]"
                            placeholder="Enter end year"
                          />
                          <small class="form-text text-muted"
                            >Leave blank if this is your current
                            employment.</small
                          >
                        </div>
                      </div>
                      <!-- Current Employment Checkbox -->
                      <div class="form-group form-check">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          name="isCurrentEmployment[]"
                        />
                        <label
                          class="form-check-label"
                          for="isCurrentEmployment"
                          >This is my current employment</label
                        >
                      </div>

                      <!-- Company Description -->
                      <div class="form-group">
                        <label for="description">Description of Company</label>
                        <textarea
                          class="form-control"
                          name="description[]"
                          rows="3"
                          placeholder="Describe the company"
                        ></textarea>
                      </div>
                    </div>
                  </div>

                  <!-- Button to add more employment -->
                  <div class="col-12">
                    <button
                      type="button"
                      class="btn btn-primary"
                      id="add-employment"
                    >
                      Add Another Employment
                    </button>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="business-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="education-details-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Education Details -->
          <div
            class="row form-section"
            id="education-details-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Education Details</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Primary School Section -->
                    <div class="col-md-12">
                      <h5>Primary School</h5>
                      <div class="form-group">
                        <label for="primarySchoolName"
                          >Name of Primary School</label
                        >
                        <input
                          type="text"
                          id="primarySchool_name"
                          class="form-control"
                          id="primarySchoolName"
                          name="primarySchool.name"
                        />
                      </div>
                      <div class="form-group">
                        <label for="primarySchoolAddress"
                          >Address of Primary School</label
                        >
                        <input
                          type="text"
                          id="primarySchool_address"
                          class="form-control"
                          id="primarySchoolAddress"
                          name="primarySchool.address"
                        />
                      </div>
                      <div class="form-group">
                        <label for="primarySchoolYear"
                          >Year of Attendance</label
                        >
                        <input
                          type="text"
                          id="primarySchool_yearOfAttendance"
                          class="form-control"
                          id="primarySchoolYear"
                          name="primarySchool.yearOfAttendance"
                        />
                      </div>
                    </div>

                    <!-- Secondary School Section -->
                    <div class="col-md-12">
                      <h5>Secondary School</h5>
                      <div class="form-group">
                        <label for="secondarySchoolName"
                          >Name of Secondary School</label
                        >
                        <input
                          type="text"
                          id="secondarySchool_name"
                          class="form-control"
                          id="secondarySchoolName"
                          name="secondarySchool.name"
                        />
                      </div>
                      <div class="form-group">
                        <label for="secondarySchoolAddress"
                          >Address of Secondary School</label
                        >
                        <input
                          type="text"
                          id="secondarySchool_address"
                          class="form-control"
                          id="secondarySchoolAddress"
                          name="secondarySchool.address"
                        />
                      </div>
                      <div class="form-group">
                        <label for="secondarySchoolYear"
                          >Year of Attendance</label
                        >
                        <input
                          type="text"
                          id="secondarySchool_yearOfAttendance"
                          class="form-control"
                          id="secondarySchoolYear"
                          name="secondarySchool.yearOfAttendance"
                        />
                      </div>
                    </div>

                    <!-- Tertiary Institution Section -->
                    <div
                      class="col-md-12 tertiary-institution-section"
                      id="tertiary-institution-container"
                    >
                      <div class="institution-fields m-b30">
                        <label class="form-label">Tertiary Institution 1</label>
                        <input
                          type="text"
                          class="form-control"
                          name="educationalHistory.tertiaryInstitutions[0].name"
                          placeholder="Name of Tertiary Institution"
                        />
                        <input
                          type="text"
                          class="form-control"
                          name="educationalHistory.tertiaryInstitutions[0].address"
                          placeholder="Address of Tertiary Institution"
                        />
                        <input
                          type="text"
                          class="form-control"
                          name="educationalHistory.tertiaryInstitutions[0].certificateObtained"
                          placeholder="Certificate Obtained"
                        />
                        <input
                          type="text"
                          class="form-control"
                          name="educationalHistory.tertiaryInstitutions[0].matricNo"
                          placeholder="Matriculation Number"
                        />
                        <input
                          type="text"
                          class="form-control"
                          name="educationalHistory.tertiaryInstitutions[0].yearOfAttendance"
                          placeholder="Year of Attendance"
                        />
                      </div>
                    </div>

                    <!-- Button to add more institutions -->
                    <div class="col-12">
                      <button
                        type="button"
                        id="add-institution"
                        class="btn btn-primary"
                      >
                        Add another Institution
                      </button>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="employment-details-section"
                  >
                    Previous
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary next-btn"
                    data-next="health-info-section"
                  >
                    Next
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Health Information -->
          <div
            class="row form-section"
            id="health-info-section"
            style="display: none"
          >
            <div class="col-xl-12 col-lg-12">
              <div class="card card-bx m-b30">
                <div class="card-header">
                  <h4 class="card-title">Health and Physical Information</h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Health section fields -->
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Blood Group</label>
                      <select
                        id="bloodGroup"
                        name="bloodGroup"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label class="form-label">Genotype</label>
                      <select
                        id="genotype"
                        name="genotype"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="AA">AA</option>
                        <option value="AS">AS</option>
                        <option value="SS">SS</option>
                        <option value="AC">AC</option>
                        <option value="SC">SC</option>
                      </select>
                    </div>
                    <div class="col-sm-6 m-b30">
                      <label for="disabilityStatus">Disability Status:</label>
                      <select
                        id="disabilityStatus"
                        name="disabilityStatus"
                        class="selectpicker nice-select default-select form-control wide mh-auto"
                      >
                        <option value="None">None</option>
                        <option value="Physical">Physical</option>
                        <option value="Visual">Visual</option>
                        <option value="Hearing">Hearing</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <button
                    type="button"
                    class="btn btn-secondary prev-btn"
                    data-prev="education-details-section"
                  >
                    Previous
                  </button>
                  <button type="submit" class="btn btn-success">Submit</button>
                </div>
              </div>
            </div>
          </div>
          <div id="autoSaveStatus"></div>
        </form>
      </div>
      <script>
        $(document).ready(function () {
          // Hold state for counts and the auto-save timer.
          const state = {
            autoSaveTimer: null,
            institutionCount: 0,
            neighborCount: 0,
            familyCount: 0,
            employmentCount: 0,
          };

          // Utility function to set input values
          const setInputValue = (id, value) => {
            const element = document.getElementById(id);
            if (element) element.value = value || "";
          };

          /* ===================================================
           * Field Addition Functions
           * =================================================== */

          // Add a new tertiary institution section.
          const addInstitution = (institutionData = {}) => {
            const container = $("#tertiary-institution-container");
            // Calculate the index from the number of current institutions.
            const index = container.find(".institution-fields").length;

            const newInstitutionFields = `
    <div class="institution-fields m-b30">
      <label class="form-label">Tertiary Institution ${index + 1}</label>
      <input
        type="text"
        class="form-control"
        name="educationalHistory.tertiaryInstitutions[${index}].name"
        placeholder="Name of Tertiary Institution"
        value="${institutionData.name || ""}"
        
      />
      <input
        type="text"
        class="form-control"
        name="educationalHistory.tertiaryInstitutions[${index}].address"
        placeholder="Address of Tertiary Institution"
        value="${institutionData.address || ""}"
        
      />
      <input
        type="text"
        class="form-control"
        name="educationalHistory.tertiaryInstitutions[${index}].certificateObtained"
        placeholder="Certificate Obtained"
        value="${institutionData.certificateObtained || ""}"
        
      />
      <input
        type="text"
        class="form-control"
        name="educationalHistory.tertiaryInstitutions[${index}].matricNo"
        placeholder="Matriculation Number"
        value="${institutionData.matricNo || ""}"
        
      />
      <input
        type="text"
        class="form-control"
        name="educationalHistory.tertiaryInstitutions[${index}].yearOfAttendance"
        placeholder="Year of Attendance"
        value="${institutionData.yearOfAttendance || ""}"
        
      />
    </div>`;
            container.append(newInstitutionFields);
            state.institutionCount++;

            // Validate the newly added fields before auto-saving
            validateAndAutoSaveIntitution(container, index);
          };

          // Function to validate the newly added institution fields and trigger auto-save if valid
          const validateAndAutoSaveIntitution = (container, index) => {
            const fields = container
              .find(`.institution-fields:nth-child(${index + 1})`)
              .find("input");
            let isValid = true;

            fields.each(function () {
              if (!$(this).val().trim()) {
                isValid = false;
                return false; // Exit the loop early if any field is empty
              }
            });

            if (isValid) {
              autoSave();
            } else {
              console.log("Please fill out all required fields before saving.");
            }
          };

          // Add a new family section.
          const addFamily = (familyData = {}) => {
            const container = $("#family-container");
            // Calculate the index from the number of current institutions.
            const index = container.find(".family-fields").length;

            const newFamilyFields = `
    <div class="family-fields m-b30">
      <label class="form-label">Family ${index + 1}</label>
      <input 
        type="text" 
        class="form-control m-b10 family-name" 
        name="family_name[]" 
        placeholder="Full Name" 
        value="${familyData.name || ""}"
         />

      <input
        type="text" 
        class="form-control m-b10 family-relationship" 
        name="family_relationship[]" 
        placeholder="Relationship" 
        value="${familyData.relationship || ""}"
         />

      <input 
        type="tel" 
        class="form-control family-phone" 
        name="family_phone[]" 
        placeholder="Phone Number" 
        value="${familyData.phone || ""}"
         />

      <input 
        type="text" 
        class="form-control family-address" 
        name="family_address[]" 
        placeholder="Residential Address" 
        value="${familyData.address || ""}"
         />
    </div>`;

            container.append(newFamilyFields);
            state.familyCount++;

            if (state.familyCount === 5) {
              $("#add-family")
                .prop("disabled", true)
                .text("Maximum family reached")
                .removeClass("btn-primary")
                .addClass("btn-secondary");
            }

            // Trigger auto-save after adding new fields
            autoSaveFamily();
          };

          // Existing auto-save function (modified to validate family data)
          const autoSaveFamily = () => {
            console.log("coool");
            // Validate family data before saving
            if (validateFamilyData()) {
              console.log(
                "All family fields are valid. Proceeding with auto-save..."
              );
              autoSave();
            } else {
              console.log(
                "Some family fields are incomplete. Auto-save skipped."
              );
            }
          };

          // Helper function to validate family data
          // const validateFamilyData = () => {
          //   const familyContainer = $("#family-container");
          //   const familyFields = familyContainer.find(".family-fields");
          //   let allFieldsValid = true;

          //   familyFields.each((index, field) => {
          //     const name = $(field).find(".family-name").val().trim();
          //     const relationship = $(field)
          //       .find(".family-relationship")
          //       .val()
          //       .trim();
          //     const phone = $(field).find(".family-phone").val().trim();
          //     const address = $(field).find(".family-address").val().trim();

          //     if (!name || !relationship || !phone || !address) {
          //       allFieldsValid = false;
          //       return false; // Exit the loop early if any field is invalid
          //     }
          //   });

          //   return allFieldsValid;
          // };

          const validateFamilyData = () => {
            const familyContainer = $("#family-container");
            const familyFields = familyContainer.find(".family-fields");

            // Return true if at least one family member has some data
            let hasValidFamily = false;

            familyFields.each((index, field) => {
              const name = $(field).find(".family-name").val()?.trim();
              const relationship = $(field)
                .find(".family-relationship")
                .val()
                ?.trim();
              const phone = $(field).find(".family-phone").val()?.trim();
              const address = $(field).find(".family-address").val()?.trim();

              if (name || relationship || phone || address) {
                hasValidFamily = true;
              }
            });

            return hasValidFamily;
          };

          // // Add a new neighbor section.
          const addNeighbor = (neighborData = {}) => {
            const container = $("#neighbors-container");
            const index = container.find(".neighbor-fields").length;

            const newNeighborFields = `
      <div class="neighbor-fields m-b30">
        <label class="form-label">Neighbor ${index + 1}</label>
        <input 
          type="text" 
          class="form-control m-b10 neighbor-name" 
          name="neighbor_name[]" 
          placeholder="Full Name" 
          value="${neighborData.name || ""}"
           />
  
        <input 
          type="text" 
          class="form-control m-b10 neighbor-address" 
          name="neighbor_address[]" 
          placeholder="Residential Address" 
          value="${neighborData.address || ""}"
           />
  
        <input 
          type="tel" 
          class="form-control neighbor-phone" 
          name="neighbor_phone[]" 
          placeholder="Phone Number" 
          value="${neighborData.phone || ""}"
           />
      </div>`;

            container.append(newNeighborFields);
            state.neighborCount++;

            if (state.neighborCount === 5) {
              $("#add-neighbor")
                .prop("disabled", true)
                .text("Maximum neighbors reached")
                .removeClass("btn-primary")
                .addClass("btn-secondary");
            }

            // Attach event listeners to the new fields for auto-save validation
            const newFields = container.find(".neighbor-fields").last();
            newFields.find("input").on("input", function () {
              validateAndAutoSave(newFields);
            });
          };

          // Function to validate and auto-save only if all fields are filled
          const validateAndAutoSave = (neighborFields) => {
            const name = neighborFields.find(".neighbor-name").val().trim();
            const address = neighborFields
              .find(".neighbor-address")
              .val()
              .trim();
            const phone = neighborFields.find(".neighbor-phone").val().trim();

            if (name && address && phone) {
              autoSave(); // Trigger auto-save only if all fields are complete
            }
          };

          // Add a new employment section.
          const addEmployment = (employmentData = {}) => {
            const container = $("#employment-history-container");
            // Calculate the index from the number of current employment.
            const index = container.find(".employment-fields").length;
            const newEmploymentFields = `
      <div class="employment-fields m-b30">
        <label class="form-label">Employment ${index + 1}</label> 
        <input
          type="text"
          class="form-control"
          name="companyName[]"
          placeholder="Company Name"
          value="${employmentData.companyName || ""}"
          
        />
        <input
          type="text"
          class="form-control"
          name="address[]"
          placeholder="Company Address"
          value="${employmentData.address || ""}"
          
        />
        <input
          type="text"
          class="form-control"  
          name="designation[]"
          placeholder="Designation"
          value="${employmentData.designation || ""}"
          
          />
          <input
          type="number"
          class="form-control"
          name="startYear[]"
          placeholder="Start Year"
          value="${employmentData.startYear || ""}"
          
          />
          <div>
          <input
          type="number"
          class="form-control"
          name="endYear[]"
          placeholder="End Year"
          value="${employmentData.endYear || ""}"
          
          />
           <small class="form-text text-muted">Leave blank if this is your current employment.</small>
          </div>
          
          <div class="form-check">
          <input
          type="checkbox"
          class="form-check-input"
          name="isCurrentEmployment[]"
          value="${employmentData.isCurrentEmployment || ""}"
          />
             <label class="form-check-label"for="isCurrentEmployment">This is my current employment</label>
          </div>
           <div>
            <label for="description">Description of Company</label>
          <textarea
          class="form-control"
          name="description[]"
          placeholder="Job Description"
          value="${employmentData.description || ""}"
          
          >
          </textarea>
         </div>
      </div>`;
            container.append(newEmploymentFields);
            state.employmentCount++;

            // Validate and auto-save only if all required fields are filled
            validateAndAutoSaveEmployment();
          };

          const validateAndAutoSaveEmployment = () => {
            const container = $("#employment-history-container");
            const employmentFields = container.find(".employment-fields");

            let isComplete = true;

            employmentFields.each(function () {
              const fields = $(this).find(
                "input[required], textarea[required]"
              );
              fields.each(function () {
                if (!$(this).val()) {
                  isComplete = false;
                  return false; // Exit the loop early if any field is empty
                }
              });

              if (!isComplete) {
                return false; // Exit the outer loop early if any field is empty
              }
            });

            if (isComplete) {
              autoSave();
            }
          };

          /* ===================================================
           * Data Population Logic (Updated)
           * =================================================== */

          const populateTertiaryInstitutions = (institutions) => {
            const container = $("#tertiary-institution-container");
            container.empty(); // Clear existing fields

            if (institutions && institutions.length > 0) {
              institutions.forEach((institution) =>
                addInstitution(institution)
              );
            } else {
              // Add at least one empty institution field
              addInstitution();
            }
          };

          const populateFamily = (family) => {
            const container = $("#family-container");
            container.empty(); // Clear existing fields

            if (family && family.length > 0) {
              family.forEach((fam) => addFamily(fam));
            } else {
              // Add at least one empty family field
              addFamily();
            }
          };

          const populateNeighbors = (neighbors) => {
            const container = $("#neighbors-container");
            container.empty(); // Clear existing fields

            if (neighbors && neighbors.length > 0) {
              neighbors.forEach((neighbor) => addNeighbor(neighbor));
            } else {
              // Add at least one empty family field
              addNeighbor();
            }
          };

          const populateEmploymentHistory = (employments) => {
            const container = $("#employment-history-container");
            container.empty(); // Clear existing fields

            if (employments && employments.length > 0) {
              employments.forEach((employment) => addEmployment(employment));
            } else {
              // Add at least one empty employment field
              addEmployment();
            }
          };

          // Modified AJAX success handler
          const handleProfileDataSuccess = (data) => {
            // ... existing population code for other fields ...

            // Handle educational history
            if (data.educationalHistory) {
              // Primary and secondary school population (keep existing code)

              // Tertiary institutions - use our new method
              populateTertiaryInstitutions(
                data.educationalHistory.tertiaryInstitutions
              );
            }

            // Update institution count state
            state.institutionCount = $(
              "#tertiary-institution-container .institution-fields"
            ).length;

            if (data.family) {
              populateFamily(data.family);
              // ... rest of existing population code ...
            }
            state.familyCount = $(
              "#neighbors-container .neighbor-fields"
            ).length;

            if (data.neighbor) {
              populateNeighbors(data.neighbor);
              // ... rest of existing population code ...
            }
            state.neighborCount = $(
              "#neighbors-container .neighbor-fields"
            ).length;

            if (data.employmentHistory) {
              populateEmploymentHistory(data.employmentHistory);
              // ... rest of existing population code ...
            }
            state.employmentCount = $(
              "#employment-history-container .employment-fields"
            ).length;
          };

          // Modified AJAX call
          $.ajax({
            url: `${BACKEND_URL}/users/${user.id}`,
            method: "GET",
            headers: { Authorization: `Bearer ${token}` },
            success: handleProfileDataSuccess,
            error: function (error) {
              // ... existing error handling ...
            },
          });

          /* ===================================================
           * Data Collection
           * =================================================== */

          const collectFormData = () => {
            // Initialize FormData (this will also capture file uploads)
            const formData = new FormData();

            // List of simple fields by their IDs.
            const fields = [
              "middlename",
              "lastname",
              "nationality",
              "community",
              "religion",
              "gender",
              "stateOfOrigin",
              "DOB",
              "countryOfResidence",
              "lgaOfOrigin",
              "maritalStatus",
              "house_number",
              "street_name",
              "nearest_bus_stop_landmark",
              "city_town",
              "stateOfResidence",
              "lgaOfResidence",
              "id_number",
              "issue_date",
              "expiry_date",
            ];
            fields.forEach((field) => {
              const value = $(`#${field}`).val() || "";
              formData.append(field, value);
            });

            // Build the next-of-kin object.
            const nextOfKin = {
              nok_surname: $("#nok_surname").val().trim(),
              nok_firstname: $("#nok_firstname").val().trim(),
              nok_middlename: $("#nok_middlename").val().trim(),
              nok_relationship: $("#nok_relationship").val().trim(),
              nok_countryOfResidence: $("#nok_countryOfResidence").val().trim(),
              nok_stateOfResidence: $("#nok_stateOfResidence").val().trim(),
              nok_lgaOfResidence: $("#nok_lgaOfResidence").val().trim(),
              nok_cityOfResidence: $("#nok_cityOfResidence").val().trim(),
              nok_address: $("#nok_address").val().trim(),
            };

            // Build the health info object.
            const healthInfo = {
              bloodGroup: $("#bloodGroup").val().trim(),
              genotype: $("#genotype").val().trim(),
              disabilityStatus: $("#disabilityStatus").val().trim(),
            };

            // Build the business object.
            const business = {
              biz_name: $("#biz_name").val().trim(),
              biz_type: $("#biz_type").val(),
              registration_number: $("#registration_number").val().trim(),
              biz_address: $("#biz_address").val().trim(),
              nature_of_bussiness: $("#nature_of_bussiness").val().trim(),
              numberOfYears: $("#numberOfYears").val().trim(),
              numberOfEmployees: $("#numberOfEmployees").val().trim(),
              annualRevenue: $("#annualRevenue").val().trim(),
              TIN: $("#TIN").val().trim(),
              biz_phone: $("#biz_phone").val().trim(),
              biz_email: $("#biz_email").val().trim(),
            };

            // Collect neighbor entries.
            const neighbor = [];
            $(".neighbor-fields").each(function () {
              neighbor.push({
                name: $(this).find('input[name="neighbor_name[]"]').val(),
                address: $(this).find('input[name="neighbor_address[]"]').val(),
                phone: $(this).find('input[name="neighbor_phone[]"]').val(),
              });
            });

            // Collect family entries.
            const family = [];
            $(".family-fields").each(function () {
              family.push({
                name: $(this).find('input[name="family_name[]"]').val(),
                relationship: $(this)
                  .find('input[name="family_relationship[]"]')
                  .val(),
                phone: $(this).find('input[name="family_phone[]"]').val(),
                address: $(this).find('input[name="family_address[]"]').val(),
              });
            });

            // Build educational history.
            const educationalHistory = {
              primarySchool: {
                name: $('input[name="primarySchool.name"]').val(),
                address: $('input[name="primarySchool.address"]').val(),
                yearOfAttendance: $(
                  'input[name="primarySchool.yearOfAttendance"]'
                ).val(),
              },
              secondarySchool: {
                name: $('input[name="secondarySchool.name"]').val(),
                address: $('input[name="secondarySchool.address"]').val(),
                yearOfAttendance: $(
                  'input[name="secondarySchool.yearOfAttendance"]'
                ).val(),
              },
              tertiaryInstitutions: [],
            };

            $(".institution-fields").each(function (index) {
              const institution = {
                name: $(this)
                  .find(
                    `input[name="educationalHistory.tertiaryInstitutions[${index}].name"]`
                  )
                  .val(),
                address: $(this)
                  .find(
                    `input[name="educationalHistory.tertiaryInstitutions[${index}].address"]`
                  )
                  .val(),
                certificateObtained: $(this)
                  .find(
                    `input[name="educationalHistory.tertiaryInstitutions[${index}].certificateObtained"]`
                  )
                  .val(),
                matricNo: $(this)
                  .find(
                    `input[name="educationalHistory.tertiaryInstitutions[${index}].matricNo"]`
                  )
                  .val(),
                yearOfAttendance: $(this)
                  .find(
                    `input[name="educationalHistory.tertiaryInstitutions[${index}].yearOfAttendance"]`
                  )
                  .val(),
              };
              educationalHistory.tertiaryInstitutions.push(institution);
            });

            // Employment History
            const employmentHistory = [];
            $(".employment-fields").each(function () {
              employmentHistory.push({
                companyName: $(this).find('input[name="companyName[]"]').val(),
                address: $(this).find('input[name="address[]"]').val(),
                designation: $(this).find('input[name="designation[]"]').val(),
                startYear: $(this).find('input[name="startYear[]"]').val(),
                endYear: $(this).find('input[name="endYear[]"]').val(),
                isCurrentEmployment: $(this)
                  .find('input[name="isCurrentEmployment[]"]')
                  .is(":checked"),
                description: $(this)
                  .find('textarea[name="description[]"]')
                  .val(),
              });
            });

            // Return both the FormData (with file uploads) and our JSONâready objects.
            return {
              formData,
              nextOfKin,
              healthInfo,
              business,
              educationalHistory,
              employmentHistory,
              neighbor,
              family,
            };
          };

          /* ===================================================
           * Auto-Save / Update Handling
           * =================================================== */
          let cameraStream = null;
          let photoCaptured = false;

          // Utility: Convert dataURL to File
          function dataURLtoFile(dataurl, filename) {
            const arr = dataurl.split(",");
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
              u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, { type: mime });
          }
          const autoSave = async () => {
            try {
              // Collect all the form data.
              let {
                formData,
                nextOfKin,
                healthInfo,
                business,
                educationalHistory,
                employmentHistory,
                neighbor,
                family,
              } = collectFormData();

              // Append the JSONâstructured data.
              formData.append("nextOfKin", JSON.stringify(nextOfKin));
              formData.append("healthInfo", JSON.stringify(healthInfo));
              formData.append("business", JSON.stringify(business));
              formData.append(
                "educationalHistory",
                JSON.stringify(educationalHistory)
              );
              formData.append(
                "employmentHistory",
                JSON.stringify(employmentHistory)
              );
              formData.append("neighbor", JSON.stringify(neighbor));
              formData.append("family", JSON.stringify(family));

              // Handle identification â use the alternative input if "others" is selected.
              const selectedValue = $("#identification").val();
              const otherValue = $("#other-identification").val();
              const finalIdentification =
                selectedValue === "others" ? otherValue : selectedValue;
              formData.append("identification", finalIdentification);

              const canvas = $("#snapshot").get(0);
              const dataURL = canvas.toDataURL("image/jpeg", 0.9);
              const passportPhotoFile = $("#passportPhoto")[0]?.files[0];

              // console.log("photoCaptured:", photoCaptured);
              // console.log("passportPhotoFile:", passportPhotoFile);
              // console.log("dataURL from canvas:", dataURL);

              if (photoCaptured && dataURL) {
                formData.append(
                  "passportPhoto",
                  dataURLtoFile(dataURL, "captured-passport.jpg")
                );
              } else if (passportPhotoFile) {
                formData.append("passportPhoto", passportPhotoFile);
              }

              // Send the PUT request to update the user.
              const response = await fetch(`${BACKEND_URL}/users/${user.id}`, {
                method: "PUT",
                headers: {
                  Authorization: `Bearer ${token}`,
                },
                body: formData,
              });

              if (response.ok) {
                console.log("Auto-save successful");
                $("#autoSaveStatus").text("Saved").css("color", "green");
              } else {
                console.error("Auto-save failed", response.statusText);
                $("#autoSaveStatus").text("Failed to save").css("color", "red");
              }
            } catch (error) {
              console.log("Auto-save error:", error.message);
              console.error("Auto-save error:", error);
              $("#autoSaveStatus").text("Failed to save").css("color", "red");
            }
          };
          // â Camera Start
          $("#start-camera").click(function () {
            navigator.mediaDevices
              .getUserMedia({ video: true })
              .then(function (stream) {
                cameraStream = stream;
                $("#camera-stream").get(0).srcObject = stream;
                $("#camera-stream").show();
                $("#capture-photo, #close-camera").show();
                $("#start-camera").hide();
                $("#photo-preview").hide();
              })
              .catch(function (err) {
                alert("Unable to access camera: " + err);
              });
          });
          // â Capture Photo & Trigger AutoSave
          $("#capture-photo").click(function () {
            const video = $("#camera-stream").get(0);
            const canvas = $("#snapshot").get(0);
            const context = canvas.getContext("2d");

            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const dataUrl = canvas.toDataURL("image/jpeg", 0.9);
            $("#photo-preview").attr("src", dataUrl).show();
            $("#passportPhotoData").val(dataUrl);

            if (cameraStream) {
              cameraStream.getTracks().forEach((track) => track.stop());
              cameraStream = null;
            }

            $("#camera-stream, #capture-photo, #close-camera").hide();
            $("#start-camera").show();
            photoCaptured = true;

            $("#autoSaveStatus")
              .text("Photo captured! Saving...")
              .css("color", "orange");
            console.log("Calling autoSave() after camera capture...");
            autoSave();
          });

          // â Close Camera Manually
          $("#close-camera").click(function () {
            if (cameraStream) {
              cameraStream.getTracks().forEach((track) => track.stop());
              cameraStream = null;
            }
            $("#camera-stream, #capture-photo, #close-camera").hide();
            $("#start-camera").show();
          });

          // â Upload Photo from File
          $("#upload-photo-btn").click(function () {
            $("#passportPhoto").click();
          });

          $("#passportPhoto").change(function (e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (event) {
                $("#photo-preview").attr("src", event.target.result).show();
                $("#passportPhotoData").val(event.target.result);

                if (cameraStream) {
                  cameraStream.getTracks().forEach((track) => track.stop());
                  cameraStream = null;
                  $("#camera-stream, #capture-photo, #close-camera").hide();
                  $("#start-camera").show();
                }
                photoCaptured = false; // File upload is NOT photoCaptured
                $("#autoSaveStatus")
                  .text("Photo uploaded! Saving...")
                  .css("color", "orange");
                console.log("Calling autoSave() after photo upload...");
                autoSave();
              };
              reader.readAsDataURL(file);
            }
          });

          /* ===================================================
           * Event Bindings
           * =================================================== */

          const bindEvents = () => {
            // Bind the click events to add new sections.
            $("#add-institution").on("click", addInstitution);
            $("#add-neighbor").on("click", addNeighbor);
            $("#add-family").on("click", addFamily);
            $("#add-employment").on("click", addEmployment);

            $(document).on(
              "input change",
              "input, select, textarea",
              function () {
                clearTimeout(state.autoSaveTimer);
                $("#autoSaveStatus").text("Saving...").css("color", "blue");
                state.autoSaveTimer = setTimeout(autoSave, 1000); // 1-second debounce
              }
            );

            // For final submission â prevent default and trigger auto-save.
            $("#unifiedForm").on("submit", function (e) {
              e.preventDefault();
              // autoSave();
              autoSave().then(() => {
                Swal.fire({
                  title: "Success!",
                  text: "Your form has been submitted successfully.",
                  confirmButtonText: "OK",
                });
              });
            });
          };

          // Initialize all event bindings.
          bindEvents();
        });
      </script>

      <script>
        document.querySelectorAll(".next-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const nextSection = document.getElementById(btn.dataset.next);
            btn.closest(".form-section").style.display = "none";
            nextSection.style.display = "block";
          });
        });

        document.querySelectorAll(".prev-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const prevSection = document.getElementById(btn.dataset.prev);
            btn.closest(".form-section").style.display = "none";
            prevSection.style.display = "block";
          });
        });
      </script>

      <script>
        document.querySelectorAll(".next-btn").forEach((button) => {
          button.addEventListener("click", () => {
            const currentSection = button.closest(".form-section");
            const nextSectionId = button.getAttribute("data-next");
            const nextSection = document.getElementById(nextSectionId);

            // Validate the current form section
            if (validateForm(currentSection)) {
              currentSection.classList.remove("active");
              nextSection.classList.add("active");
            }
          });
        });

        function validateForm(section) {
          let isValid = true;
          section.querySelectorAll("input, select").forEach((field) => {
            const errorMessage = field.nextElementSibling;
            if (field.hasAttribute("required") && !field.value.trim()) {
              field.classList.add("error");
              if (errorMessage) errorMessage.style.display = "block";
              isValid = false;
            } else {
              field.classList.remove("error");
              if (errorMessage) errorMessage.style.display = "none";
            }
          });
          return isValid;
        }
      </script>

      <script
        src="../../code.tidio.co_443/bpnp4xkz2axqrebqxcezgdca9yot1iyn.js"
        async
      ></script>
      <script>
        function logout() {
          localStorage.removeItem("token");
        }
      </script>
    </div>
    <!--**********************************
            Content body end
        ***********************************-->

    <!--**********************************
            Footer start
        ***********************************-->
    <div class="footer">
      <div class="copyright">
        <p>Copyright Â©BDIC Ltd 2025. All rights reserved.</p>
      </div>
    </div>
    <!--**********************************
            Footer end
        ***********************************-->

    <script
      src="../../code.tidio.co_443/bpnp4xkz2axqrebqxcezgdca9yot1iyn.js"
      async
    ></script>

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="vendor/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="js/plugins-init/sweetalert.init.js"></script>
    <script src="vendor/global/global.min.js"></script>
    <script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/moment.js"></script>
    <script src="vendor/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

    <script src="js/dashboard/dashboard-1.js"></script>

    <script src="js/custom.min.js"></script>
    <script src="js/deznav-init.js"></script>
    <script src="js/demo.js"></script>
    <script type="text/javascript" src="../../../js/index.js"></script>
  </body>
</html>
