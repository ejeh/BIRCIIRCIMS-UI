<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BICRIRMS Admin Dashboard</title>
    <link
      rel="icon"
      type="image/png"
      href="/assets/images/benue-state-logo.png"
      sizes="16x16"
    />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
    />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      :root {
        --sidebar-width: 260px;
        --sidebar-bg: #1a1d29;
        --sidebar-text: #a0a9c9;
        --sidebar-active: #4c5fd5;
        --header-height: 60px;
        --header-bg: #ffffff;
        --main-bg: #f5f6fa;
        --card-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
      }

      [data-theme="dark"] {
        --sidebar-bg: #0f0f14;
        --sidebar-text: #8892b0;
        --sidebar-active: #6366f1;
        --header-bg: #1a1d29;
        --main-bg: #111318;
        --card-bg: #1a1d29;
        --text-color: #e6e6e6;
        --border-color: #2a2d3a;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--main-bg);
        color: var(--text-color);
        transition: all 0.3s ease;
      }

      /* Sidebar Styles */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-width);
        background-color: var(--sidebar-bg);
        z-index: 1000;
        transition: all 0.3s ease;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .sidebar-menu .nav-link {
        color: var(--sidebar-text);
        padding: 12px 20px;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
        border-radius: 0;
      }

      .sidebar-menu .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.05);
        color: #fff;
      }

      .sidebar-menu .nav-link.active {
        background-color: var(--sidebar-active);
        color: #fff;
      }

      .sidebar-menu .nav-link i {
        margin-right: 10px;
        font-size: 18px;
      }

      .sidebar-menu .nav-link .badge {
        margin-left: auto;
      }

      /* Header Styles */
      .header {
        position: fixed;
        top: 0;
        left: var(--sidebar-width);
        right: 0;
        height: var(--header-height);
        background-color: var(--header-bg);
        z-index: 999;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        padding: 0 20px;
        transition: all 0.3s ease;
      }

      .header .search-bar {
        flex: 1;
        max-width: 400px;
      }

      .header .header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      /* Main Content */
      .main-content {
        margin-left: var(--sidebar-width);
        margin-top: var(--header-height);
        padding: 20px;
        min-height: calc(100vh - var(--header-height));
        transition: all 0.3s ease;
      }

      /* Card Styles */
      .card {
        border: none;
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        margin-bottom: 20px;
        background-color: var(--card-bg);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        background-color: transparent;
        border-bottom: 1px solid var(--border-color);
        padding: 15px 20px;
        font-weight: 600;
      }

      .card-body {
        padding: 20px;
      }

      /* KPI Cards */
      .kpi-card {
        border-radius: 10px;
        padding: 20px;
        position: relative;
        overflow: hidden;
        color: #fff;
      }

      .kpi-card::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(30px, -30px);
      }

      .kpi-card.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .kpi-card.success {
        background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      }

      .kpi-card.warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .kpi-card.info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .kpi-card .kpi-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .kpi-card .kpi-label {
        font-size: 14px;
        opacity: 0.8;
      }

      .kpi-card .kpi-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 40px;
        opacity: 0.3;
      }

      /* Dark Mode Toggle */
      .theme-toggle {
        position: relative;
        width: 50px;
        height: 26px;
        background-color: #ccc;
        border-radius: 34px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .theme-toggle.active {
        background-color: #6366f1;
      }

      .theme-toggle-slider {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background-color: white;
        border-radius: 50%;
        transition: transform 0.3s;
      }

      .theme-toggle.active .theme-toggle-slider {
        transform: translateX(24px);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .header {
          left: 0;
        }

        .main-content {
          margin-left: 0;
        }
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Table Styles */
      .dataTables_wrapper .dataTables_filter input {
        border: 1px solid var(--border-color);
        border-radius: 5px;
        padding: 5px 10px;
      }

      .dataTables_wrapper .dataTables_length select {
        border: 1px solid var(--border-color);
        border-radius: 5px;
        padding: 5px;
      }

      /* Chart Container */
      .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 20px;
      }

      /* Activity Timeline */
      .activity-timeline {
        position: relative;
        padding-left: 30px;
      }

      .activity-timeline::before {
        content: "";
        position: absolute;
        left: 10px;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: var(--border-color);
      }

      .activity-item {
        position: relative;
        margin-bottom: 20px;
      }

      .activity-item::before {
        content: "";
        position: absolute;
        left: -24px;
        top: 5px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--sidebar-active);
      }

      .activity-item .activity-time {
        font-size: 12px;
        color: var(--sidebar-text);
        margin-bottom: 5px;
      }

      .activity-item .activity-content {
        font-size: 14px;
      }

      /* Loading Spinner */
      .spinner-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
      }

      .spinner-border {
        width: 3rem;
        height: 3rem;
      }

      /* Export Buttons */
      .export-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .export-buttons button {
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid var(--border-color);
        background-color: transparent;
        color: var(--text-color);
      }

      .export-buttons button:hover {
        background-color: var(--sidebar-active);
        color: white;
      }
      .bg-custom-purple {
        background-color: #8b5cf6 !important;
      }

      .password-validation .valid {
        color: #198754;
      }

      .password-validation .invalid {
        color: #6c757d;
      }
      /* Loading Indicator Styles */
      #loadingIndicator {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(
          255,
          255,
          255,
          0.8
        ); /* Semi-transparent white background */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Ensure it's on top of other elements */
      }
      .loader {
        border: 8px solid #f3f3f3; /* Light grey */
        border-top: 8px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite; /* Spin animation */
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <!-- <h4 class="text-white mb-0">
                <i class="bi bi-shield-check me-2"></i>GovID Admin
            </h4>
            <small class="text-muted">Identity Management System</small> -->

        <div class="d-flex align-items-center">
          <img
            src="/assets/images/benue-state-logo.png"
            alt="Benue State Logo"
            class="me-3"
            width="40"
          />
          <div>
            <h4 class="mb-0 fw-bold text-white">BICRIRMS</h4>
            <small class="text-white" style="font-size: 0.8rem">
              Certificate of Origin &
              <br />
              Identity Card Management
            </small>
          </div>
        </div>
      </div>
      <nav class="sidebar-menu">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-page="dashboard">
              <i class="bi bi-speedometer2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="users">
              <i class="bi bi-people"></i>
              User Management
              <span class="badge bg-primary usercount">2,451</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="idcards">
              <i class="bi bi-card-text"></i>
              Identity Card Requests
              <span class="badge bg-warning totalRequests">142</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="certificates">
              <i class="bi bi-file-earmark-text"></i>
              Certificate of Origin
              <span class="badge bg-info totalCertRequests">89</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="transactions">
              <i class="bi bi-currency-dollar"></i>
              Transactions
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="analytics">
              <i class="bi bi-graph-up"></i>
              Analytics & Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="roles">
              <i class="bi bi-person-badge"></i>
              Role Management
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="#"
              data-page="settings"
              id="settings-link"
            >
              <i class="bi bi-gear"></i>
              Settings
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Header -->
    <header class="header">
      <button class="btn btn-light d-md-none me-3" id="sidebarToggle">
        <i class="bi bi-list"></i>
      </button>

      <div class="search-bar">
        <div class="input-group">
          <span class="input-group-text bg-transparent border-end-0">
            <i class="bi bi-search"></i>
          </span>
          <input
            type="text"
            class="form-control border-start-0"
            placeholder="Search users, requests, transactions..."
          />
        </div>
      </div>

      <div class="header-actions">
        <div class="dropdown">
          <button
            class="btn btn-light position-relative"
            type="button"
            data-bs-toggle="dropdown"
          >
            <i class="bi bi-bell"></i>
            <span
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            >
              5
            </span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <h6 class="dropdown-header">Notifications</h6>
            </li>
            <li>
              <a class="dropdown-item" href="#"
                >New identity card request from John Doe</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                >Certificate approved for Sarah Johnson</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                >System maintenance scheduled for tonight</a
              >
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            <li>
              <a class="dropdown-item" href="#">View all notifications</a>
            </li>
          </ul>
        </div>

        <div class="dropdown">
          <button
            class="btn btn-light d-flex align-items-center"
            type="button"
            data-bs-toggle="dropdown"
          >
            <img
              id="userProfilePic"
              src="https://picsum.photos/seed/admin/40/40.jpg"
              class="rounded-circle me-2 img-fluid profile-avatar"
              alt="Admin"
              style="width: 40px; height: 40px; object-fit: cover"
            />
            <span id="currentUser">Admin User</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <a class="dropdown-item" href="#"
                ><i class="bi bi-person me-2"></i>Profile</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                ><i class="bi bi-gear me-2"></i>Settings</a
              >
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            <li>
              <a class="dropdown-item" href="./auth/login.html"
                ><i class="bi bi-box-arrow-right me-2"></i>
                <span onclick="logout(this)">Logout</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="theme-toggle" id="themeToggle">
          <div class="theme-toggle-slider"></div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Page -->
      <div id="dashboard-page" class="page-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Dashboard Overview</h2>
          <div>
            <button id="exportDashboardBtn" class="btn btn-primary me-2">
              <i class="bi bi-download me-2"></i>Export Report
            </button>
            <button
              id="dateRangeBtn"
              class="btn btn-outline-primary"
              data-bs-toggle="modal"
              data-bs-target="#dateRangeModal"
            >
              <i class="bi bi-calendar3 me-2"></i>Date Range
            </button>
          </div>
        </div>

        <!-- KPI Cards -->
        <div class="row mb-4">
          <div class="col-xl-3 col-md-6 mb-3">
            <div class="kpi-card primary">
              <div class="kpi-value usercount">2,451</div>
              <div class="kpi-label">Total Registered Users</div>
              <div class="kpi-icon"><i class="bi bi-people-fill"></i></div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-3">
            <div class="kpi-card success">
              <div class="kpi-value isActive">1,892</div>
              <div class="kpi-label">Active Users</div>
              <div class="kpi-icon">
                <i class="bi bi-person-check-fill"></i>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-3">
            <div class="kpi-card warning">
              <div class="kpi-value" id="pending">231</div>
              <div class="kpi-label">Pending Requests</div>
              <div class="kpi-icon"><i class="bi bi-clock-history"></i></div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-3">
            <div class="kpi-card info">
              <div class="kpi-value">₦2.4M</div>
              <div class="kpi-label">Total Revenue</div>
              <div class="kpi-icon"><i class="bi bi-currency-dollar"></i></div>
            </div>
          </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
          <div class="col-lg-8 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">User Registration Trend</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="registrationTrendChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Request Status</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="requestStatusChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Recent Activity</h5>
              </div>
              <div class="card-body">
                <div class="activity-timeline">
                  <div class="activity-item">
                    <div class="activity-time">2 hours ago</div>
                    <div class="activity-content">
                      <strong>John Doe</strong> submitted an identity card
                      request
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-time">4 hours ago</div>
                    <div class="activity-content">
                      <strong>Sarah Johnson</strong>'s certificate of origin was
                      approved
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-time">6 hours ago</div>
                    <div class="activity-content">
                      <strong>Michael Brown</strong> was assigned Support Admin
                      role
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-time">8 hours ago</div>
                    <div class="activity-content">
                      <strong>Emily Davis</strong> completed payment for
                      certificate request
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-time">12 hours ago</div>
                    <div class="activity-content">
                      System maintenance completed successfully
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Top LGAs by Requests</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="topLGAChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Page -->
      <div id="users-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">User Management</h2>
          <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#addUserModal"
          >
            <i class="bi bi-plus-circle me-2"></i>Add New User
          </button>
        </div>

        <!-- User Stats Cards -->
        <div class="row mb-4">
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-primary usercount">2,451</h3>
                <p class="mb-0">Total Users</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-success isActive">1,892</h3>
                <p class="mb-0">Active Users</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-warning" id="inActive">559</h3>
                <p class="mb-0">Inactive Users</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-info" id="new-this-month">142</h3>
                <p class="mb-0">New This Month</p>
              </div>
            </div>
          </div>
        </div>

        <!-- User Demographics Charts -->
        <div class="row mb-4">
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Age Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="ageDistributionChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Gender Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="genderDistributionChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">State Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="stateDistributionChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Table -->
        <div class="card">
          <div
            class="card-header d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">All Users</h5>
            <div class="export-buttons btn-group">
              <button onclick="exportTable('csv')">
                <i class="bi bi-file-earmark-csv me-1"></i>CSV
              </button>
              <button onclick="exportTable('pdf')">
                <i class="bi bi-file-earmark-pdf me-1"></i>PDF
              </button>
              <button onclick="window.print()">
                <i class="bi bi-printer me-1"></i>Print
              </button>
            </div>
          </div>
          <div class="card-body">
            <table id="usersTable" class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>IsActive</th>
                  <th>State</th>
                  <th>LGA</th>
                  <th>Registered</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Table data will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Identity Cards Page -->
      <div id="idcards-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Identity Card Requests</h2>
          <button class="btn btn-primary">
            <i class="bi bi-download me-2"></i>Export Report
          </button>
        </div>

        <!-- ID Card Stats -->
        <div class="row mb-4">
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-primary totalRequests">892</h3>
                <p class="mb-0">Total Requests</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-success" id="approvedRequests">654</h3>
                <p class="mb-0">Approved</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-warning" id="pendingRequests">142</h3>
                <p class="mb-0">Pending</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-danger" id="rejectedRequests">96</h3>
                <p class="mb-0">Rejected</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ID Card Charts -->
        <div class="row mb-4">
          <div class="col-lg-8 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Request Trends</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="idcardTrendChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Requests by State</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="idcardStateChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ID Card Requests Table -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">All Requests</h5>
          </div>
          <div class="card-body">
            <table id="idcardsTable" class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>User</th>
                  <th>State</th>
                  <th>LGA</th>
                  <th>Status</th>
                  <th>Request Date</th>
                  <th>IsProfileCompleted</th>
                  <th>ApprovedBy</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Table data will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Certificates Page -->
      <div id="certificates-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Certificate of Origin Requests</h2>
          <button class="btn btn-primary">
            <i class="bi bi-download me-2"></i>Export Report
          </button>
        </div>

        <!-- Certificate Stats -->
        <div class="row mb-4">
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-primary totalCertRequests">523</h3>
                <p class="mb-0">Total Requests</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-success" id="approvedCertRequests">412</h3>
                <p class="mb-0">Approved</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-warning" id="pendingCertRequests">89</h3>
                <p class="mb-0">Pending</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-danger" id="rejectedCertRequests">22</h3>
                <p class="mb-0">Rejected</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Certificate Charts -->
        <div class="row mb-4">
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Daily Breakdown</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="certificateDailyChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Top LGAs</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="certificateLGAChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Certificate Requests Table -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">All Requests</h5>
          </div>
          <div class="card-body">
            <table
              id="certificatesTable"
              class="table table-striped table-hover"
            >
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>User</th>
                  <th>State</th>
                  <th>LGA</th>
                  <th>Status</th>
                  <th>Request Time</th>
                  <th>IsProfileCompleted</th>
                  <th>ApprovedBy</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Table data will be populated by JavaScript -->
              </tbody>
            </table>
            <div
              id="pdf-loader"
              style="
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                z-index: 9999;
                transform: translate(-50%, -50%);
              "
            >
              <div
                class="spinner-border text-primary"
                role="status"
                style="width: 3rem; height: 3rem"
              >
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Transactions Page -->
      <div id="transactions-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Transactions & Logs</h2>
          <button id="exportTransactionsBtn" class="btn btn-primary">
            <i class="bi bi-download me-2"></i>Export Report
          </button>
        </div>

        <!-- Transaction Stats -->
        <div class="row mb-4">
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-primary total-transactions">1,842</h3>
                <p class="mb-0">Total Transactions</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-success total-revenue">₦2.4M</h3>
                <p class="mb-0">Total Revenue</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-info average-amount">₦1,302</h3>
                <p class="mb-0">Average Transaction</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card">
              <div class="card-body text-center">
                <h3 class="text-warning success-rate">98.2%</h3>
                <p class="mb-0">Success Rate</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Transaction Charts -->
        <div class="row mb-4">
          <div class="col-lg-8 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Transactions Over Time</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="transactionTrendChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Revenue by LGA</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="revenueStateChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Transactions Table -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">All Transactions</h5>
          </div>
          <div class="card-body">
            <table
              id="transactionsTable"
              class="table table-striped table-hover"
            >
              <thead>
                <tr>
                  <th>Transaction ID</th>
                  <th>User</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Date & Time</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Table data will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Analytics Page -->
      <div id="analytics-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Analytics & Reports</h2>
          <div>
            <button class="btn btn-outline-primary me-2">
              <i class="bi bi-calendar3 me-2"></i>Date Range
            </button>
            <button class="btn btn-primary">
              <i class="bi bi-download me-2"></i>Generate Report
            </button>
          </div>
        </div>

        <!-- Analytics Charts -->
        <div class="row mb-4">
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">User Growth vs Request Volume</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="growthComparisonChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Request Processing Time</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="processingTimeChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Map View -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Geographic Distribution</h5>
              </div>
              <div class="card-body">
                <div
                  id="mapView"
                  style="height: 400px; border-radius: 10px"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row">
          <div class="col-lg-4 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">System Performance</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>Server Response Time</span>
                    <span>120ms</span>
                  </div>
                  <div class="progress" style="height: 8px">
                    <div
                      class="progress-bar bg-success"
                      style="width: 85%"
                    ></div>
                  </div>
                </div>
                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>Database Query Time</span>
                    <span>45ms</span>
                  </div>
                  <div class="progress" style="height: 8px">
                    <div
                      class="progress-bar bg-success"
                      style="width: 90%"
                    ></div>
                  </div>
                </div>
                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>API Response Time</span>
                    <span>180ms</span>
                  </div>
                  <div class="progress" style="height: 8px">
                    <div
                      class="progress-bar bg-warning"
                      style="width: 70%"
                    ></div>
                  </div>
                </div>
                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>System Uptime</span>
                    <span>99.8%</span>
                  </div>
                  <div class="progress" style="height: 8px">
                    <div
                      class="progress-bar bg-success"
                      style="width: 99.8%"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-8 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Request Type Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="requestTypeChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Roles Page -->
      <div id="roles-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Role Management</h2>
          <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#addRoleModal"
          >
            <i class="bi bi-plus-circle me-2"></i>Add New Role
          </button>
        </div>

        <!-- Role Distribution -->
        <div class="row mb-4">
          <div class="col-lg-6 mb-3">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Role Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="roleDistributionChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6 mb-3">
            <div class="card shadow-sm">
              <div
                class="card-header d-flex justify-content-between align-items-center"
              >
                <h5 class="mb-0">Role Permissions</h5>
                <button
                  id="refreshRoleStats"
                  class="btn btn-sm btn-outline-primary"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
              <div class="card-body">
                <table class="table table-hover align-middle text-center">
                  <thead class="table-light">
                    <tr>
                      <th>Role</th>
                      <th>Users</th>
                      <th>Permissions</th>
                    </tr>
                  </thead>
                  <tbody id="roleStatsTableBody">
                    <tr>
                      <td colspan="3" class="text-muted">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Role Assignment -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Role Assignment</h5>
          </div>
          <div class="card-body">
            <table id="rolesTable" class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Email</th>
                  <th>Current Role</th>
                  <th>Assigned By</th>
                  <th>Assigned Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Table data will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div
          id="settingsToast"
          class="toast"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="toast-header">
            <strong class="me-auto">Settings</strong>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="toast"
              aria-label="Close"
            ></button>
          </div>
          <div class="toast-body" id="toastMessage">
            Settings saved successfully!
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings-page" class="page-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Settings</h2>
          <button id="saveSettingsBtn" class="btn btn-primary">
            <i class="bi bi-check-circle me-2"></i>Save Changes
          </button>
        </div>

        <div class="row">
          <div class="col-lg-4 mb-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">System Settings</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">System Name</label>
                  <input type="text" id="systemName" class="form-control" />
                </div>
                <div class="mb-3">
                  <label class="form-label">System Email</label>
                  <input type="email" id="systemEmail" class="form-control" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Default Currency</label>
                  <select id="currency" class="form-select">
                    <option value="NGN">Nigerian Naira (₦)</option>
                    <option value="USD">US Dollar ($)</option>
                    <option value="EUR">Euro (€)</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Date Format</label>
                  <select id="dateFormat" class="form-select">
                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Time Zone</label>
                  <select id="timezone" class="form-select">
                    <option value="West Africa Time (WAT)">
                      West Africa Time (WAT)
                    </option>
                    <option value="Greenwich Mean Time (GMT)">
                      Greenwich Mean Time (GMT)
                    </option>
                    <option value="Central European Time (CET)">
                      Central European Time (CET)
                    </option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4 mb-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Notification Settings</h5>
              </div>
              <div class="card-body">
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="emailNotifications"
                  />
                  <label class="form-check-label" for="emailNotifications">
                    Email Notifications
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="smsNotifications"
                  />
                  <label class="form-check-label" for="smsNotifications">
                    SMS Notifications
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="pushNotifications"
                  />
                  <label class="form-check-label" for="pushNotifications">
                    Push Notifications
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="newUserAlerts"
                  />
                  <label class="form-check-label" for="newUserAlerts">
                    New User Alerts
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="requestAlerts"
                  />
                  <label class="form-check-label" for="requestAlerts">
                    Request Alerts
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="systemAlerts"
                  />
                  <label class="form-check-label" for="systemAlerts">
                    System Alerts
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4 mb-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Security Settings</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">Session Timeout (minutes)</label>
                  <input
                    type="number"
                    id="sessionTimeout"
                    class="form-control"
                  />
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="twoFactorAuth"
                  />
                  <label class="form-check-label" for="twoFactorAuth">
                    Two-Factor Authentication
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="passwordComplexity"
                  />
                  <label class="form-check-label" for="passwordComplexity">
                    Enforce Password Complexity
                  </label>
                </div>
                <div class="mb-3 form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="limitLoginAttempts"
                  />
                  <label class="form-check-label" for="limitLoginAttempts">
                    Limit Login Attempts
                  </label>
                </div>
                <div class="mb-3">
                  <label class="form-label">Max Login Attempts</label>
                  <input
                    type="number"
                    id="maxLoginAttempts"
                    class="form-control"
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Lockout Duration (minutes)</label>
                  <input
                    type="number"
                    id="lockoutDuration"
                    class="form-control"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">API Configuration</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Base API URL</label>
                    <input type="text" id="apiBaseUrl" class="form-control" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">API Key</label>
                    <div class="input-group">
                      <input type="password" id="apiKey" class="form-control" />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        id="toggleApiKey"
                      >
                        <i class="bi bi-eye"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Webhook URL</label>
                    <input type="text" id="webhookUrl" class="form-control" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Webhook Secret</label>
                    <input
                      type="password"
                      id="webhookSecret"
                      class="form-control"
                    />
                  </div>
                </div>
                <div class="mt-3">
                  <button id="testApiBtn" class="btn btn-primary me-2">
                    Test API Connection
                  </button>
                  <button
                    id="regenerateApiKeyBtn"
                    class="btn btn-outline-primary"
                  >
                    Regenerate API Key
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Add User Modal -->
    <div
      class="modal fade"
      id="addUserModal"
      tabindex="-1"
      aria-labelledby="addUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addUserForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstName"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="lastName"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="userEmail"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Phone</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="userPhone"
                    inputmode="tel"
                    maxlength="11"
                    minlength="11"
                    placeholder="e.g., 08012345678"
                    autocomplete="on"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">NIN</label>
                  <input
                    type="text"
                    class="form-control"
                    id="userNIN"
                    maxlength="11"
                    minlength="11"
                    autocomplete="on"
                    inputmode="numeric"
                    pattern="\d{11}"
                    required
                  />
                  <div id="ninStatus" class="mt-1 text-sm text-info"></div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Kindred</label>
                  <input
                    type="text"
                    class="form-control"
                    id="userKindred"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Password</label>
                  <div class="input-group">
                    <input
                      type="password"
                      class="form-control"
                      id="userPassword"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary password-toggle"
                      type="button"
                      data-target="#userPassword"
                    >
                      <i class="fa fa-eye-slash"></i>
                    </button>
                  </div>
                  <small id="passwordHelp" class="form-text text-muted">
                    Enter a strong password
                  </small>
                </div>
                <div class="col-md-6">
                  <label class="form-label">confirm Password</label>
                  <div class="input-group">
                    <input
                      type="password"
                      class="form-control"
                      id="confirmPassword"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary password-toggle"
                      type="button"
                      data-target="#confirmPassword"
                    >
                      <i class="fa fa-eye-slash"></i>
                    </button>
                  </div>
                </div>
                <small id="rePasswordHelp" class="form-text text-muted">
                  Re-type your password
                </small>
                <!-- Password validation -->
                <div class="password-validation d-flex flex-wrap gap-2 mt-2">
                  <div class="d-flex align-items-center small">
                    <i
                      class="fas fa-check-circle me-1 invalid"
                      id="lengthCheck"
                    ></i>
                    <span class="invalid" id="lengthText">8 Characters</span>
                  </div>
                  <div class="d-flex align-items-center small">
                    <i
                      class="fas fa-check-circle me-1 invalid"
                      id="symbolCheck"
                    ></i>
                    <span class="invalid" id="symbolText">One symbol</span>
                  </div>
                  <div class="d-flex align-items-center small">
                    <i
                      class="fas fa-check-circle me-1 invalid"
                      id="capitalCheck"
                    ></i>
                    <span class="invalid" id="capitalText"
                      >One capital letter</span
                    >
                  </div>
                  <div class="d-flex align-items-center small">
                    <i
                      class="fas fa-check-circle me-1 invalid"
                      id="numberCheck"
                    ></i>
                    <span class="invalid" id="numberText">One number</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">State of Origin</label>
                  <select
                    id="userState"
                    name="stateOfOrigin"
                    class="form-select"
                    required
                    aria-describedby="stateHelp"
                  >
                    <option value="">Select State</option>
                    <option value="abia">Abia</option>
                    <option value="adamawa">Adamawa</option>
                    <option value="akwa_ibom">Akwa Ibom</option>
                    <option value="anambra">Anambra</option>
                    <option value="bauchi">Bauchi</option>
                    <option value="bayelsa">Bayelsa</option>
                    <option value="benue">Benue</option>
                    <option value="borno">Borno</option>
                    <option value="cross_river">Cross River</option>
                    <option value="delta">Delta</option>
                    <option value="ebonyi">Ebonyi</option>
                    <option value="edo">Edo</option>
                    <option value="ekiti">Ekiti</option>
                    <option value="enugu">Enugu</option>
                    <option value="gombe">Gombe</option>
                    <option value="imo">Imo</option>
                    <option value="jigawa">Jigawa</option>
                    <option value="kaduna">Kaduna</option>
                    <option value="kano">Kano</option>
                    <option value="katsina">Katsina</option>
                    <option value="kebbi">Kebbi</option>
                    <option value="kogi">Kogi</option>
                    <option value="kwara">Kwara</option>
                    <option value="lagos">Lagos</option>
                    <option value="nasarawa">Nasarawa</option>
                    <option value="niger">Niger</option>
                    <option value="ogun">Ogun</option>
                    <option value="ondo">Ondo</option>
                    <option value="osun">Osun</option>
                    <option value="oyo">Oyo</option>
                    <option value="plateau">Plateau</option>
                    <option value="rivers">Rivers</option>
                    <option value="sokoto">Sokoto</option>
                    <option value="taraba">Taraba</option>
                    <option value="yobe">Yobe</option>
                    <option value="zamfara">Zamfara</option>
                    <option value="abuja">Abuja (FCT)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">LGA of Origin</label>
                  <!-- <input type="text" class="form-control" id="userLGA" required> -->
                  <select
                    id="userLGA"
                    name="lgaOfOrigin"
                    class="form-select"
                    required
                  >
                    <option value="">Select Local Government</option>
                  </select>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" id="addUserBtn" class="btn btn-primary">
              Add User
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Role Modal -->
    <div
      class="modal fade"
      id="addRoleModal"
      tabindex="-1"
      aria-labelledby="addRoleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addRoleModalLabel">Add New Role</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="roleName" class="form-label">Role Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="roleName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="roleDescription" class="form-label"
                  >Description</label
                >
                <textarea
                  class="form-control"
                  id="roleDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Permissions</label>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="permDashboard"
                  />
                  <label class="form-check-label" for="permDashboard">
                    View Dashboard
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="permUsers"
                  />
                  <label class="form-check-label" for="permUsers">
                    Manage Users
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="permRequests"
                  />
                  <label class="form-check-label" for="permRequests">
                    Manage Requests
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="permReports"
                  />
                  <label class="form-check-label" for="permReports">
                    View Reports
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="permSettings"
                  />
                  <label class="form-check-label" for="permSettings">
                    Access Settings
                  </label>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary">Add Role</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Change Role Modal -->
    <div
      class="modal fade"
      id="changeRoleModal"
      tabindex="-1"
      aria-labelledby="changeRoleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="changeRoleModalLabel">
              Change User Role
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="changeRoleForm">
              <input type="hidden" id="changeRoleUserId" />
              <div class="mb-3">
                <label for="changeRoleUser" class="form-label">User</label>
                <input
                  type="text"
                  class="form-control"
                  id="changeRoleUser"
                  readonly
                />
              </div>
              <div class="mb-3">
                <label for="changeRoleNew" class="form-label">New Role</label>
                <select class="form-select" id="changeRoleNew" required>
                  <!-- <option value="super_admin">Super Admin</option> -->
                  <option value="support_admin">Support Admin</option>
                  <option value="kindred_head">Kindred Head</option>
                  <!-- <option value="admin">Admin</option> -->
                  <option value="user">User</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="changeRoleReason" class="form-label"
                  >Reason for Change</label
                >
                <textarea
                  class="form-control"
                  id="changeRoleReason"
                  rows="3"
                ></textarea>
              </div>

              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  Update Role
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- 📝 Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1">
      <div class="modal-dialog">
        <form id="editUserForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit User</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editUserId" />
            <div class="mb-3">
              <label>First Name</label>
              <input
                type="text"
                class="form-control"
                id="editFirstname"
                required
              />
            </div>
            <div class="mb-3">
              <label>Last Name</label>
              <input
                type="text"
                class="form-control"
                id="editLastname"
                required
              />
            </div>
            <div class="mb-3">
              <label>Email</label>
              <input
                type="email"
                class="form-control"
                id="editEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label>Phone</label>
              <input type="text" class="form-control" id="editPhone" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View Request Modal -->
    <div
      class="modal fade"
      id="viewRequestModal"
      tabindex="-1"
      aria-labelledby="viewRequestModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="viewRequestModalLabel">
              ID Card Request Details
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="viewRequestContent" class="p-3">
              <div class="text-center">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2">Loading request details...</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View Cert Requet Modal -->
    <div
      class="modal fade"
      id="viewCertRequestModal"
      tabindex="-1"
      aria-labelledby="viewCertRequestModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="viewCertRequestModalLabel">
              User Certificate Request Details
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="viewCertRequestContent" class="p-3">
              <div class="text-center">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2">Loading request details...</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View Modal -->
    <div
      id="viewModal"
      class="modal fade"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">User Details</h5>
            <button
              type="button"
              data-bs-dismiss="modal"
              class="close"
              aria-label="Close"
              onclick="closeModal('details-modal')"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- User details will be loaded here -->
          </div>
          <div class="modal-footer">
            <button
              data-bs-dismiss="modal"
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('details-modal')"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Request Action Modal -->
    <div
      class="modal fade"
      id="requestActionModal"
      tabindex="-1"
      aria-labelledby="requestActionModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="requestActionModalLabel">
              Request Action
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="requestActionForm">
              <div class="mb-3">
                <label for="requestActionType" class="form-label">Action</label>
                <select class="form-select" id="requestActionType" required>
                  <option value="approve">Approve</option>
                  <option value="reject">Reject</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="requestActionReason" class="form-label"
                  >Reason</label
                >
                <textarea
                  class="form-control"
                  id="requestActionReason"
                  rows="3"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="submitRequestActionBtn"
            >
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--  Date Range Modal -->
    <div
      class="modal fade"
      id="dateRangeModal"
      tabindex="-1"
      aria-labelledby="dateRangeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="dateRangeModalLabel">
              Select Date Range
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="dateRangeForm">
              <div class="mb-3">
                <label for="startDate" class="form-label">Start Date</label>
                <input type="date" class="form-control" id="startDate" />
              </div>
              <div class="mb-3">
                <label for="endDate" class="form-label">End Date</label>
                <input type="date" class="form-control" id="endDate" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              id="applyDateRangeBtn"
              class="btn btn-primary"
            >
              Apply
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white text-center text-lg-start mt-auto shadow-sm">
      <div class="text-center p-3">© 2025 BDIC. All rights reserved.</div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      // Initialize DataTables
      let usersTable,
        idcardsTable,
        certificatesTable,
        transactionsTable,
        rolesTable;

      // Initialize Charts
      let registrationTrendChart, requestStatusChart, topLGAChart;
      let ageDistributionChart, genderDistributionChart, stateDistributionChart;
      let idcardTrendChart, idcardStateChart;
      let certificateDailyChart, certificateLGAChart;
      let transactionTrendChart, revenueStateChart;
      let growthComparisonChart, processingTimeChart, requestTypeChart;
      let roleDistributionChart;

      // Add this to your script to store the current date range
      let currentDashboardFilters = {
        startDate: null,
        endDate: null,
      };

      // Page Navigation
      $(document).ready(function () {
        loadUserData();
        $(".password-toggle").click(function () {
          const targetSelector = $(this).data("target");
          const input = $(targetSelector);
          const type = input.attr("type") === "password" ? "text" : "password";
          input.attr("type", type);
          $(this).find("i").toggleClass("fa-eye fa-eye-slash");
        });

        // Password validation
        $("#userPassword").on("input", function () {
          const password = $(this).val();

          // Validation checks
          const lengthValid = password.length >= 8;
          const symbolValid = /[!@#$%^&*(),.?":{}|<>]/.test(password);
          const capitalValid = /[A-Z]/.test(password);
          const numberValid = /\d/.test(password);

          // Update UI
          updateValidationIcon("#lengthCheck", "#lengthText", lengthValid);
          updateValidationIcon("#symbolCheck", "#symbolText", symbolValid);
          updateValidationIcon("#capitalCheck", "#capitalText", capitalValid);
          updateValidationIcon("#numberCheck", "#numberText", numberValid);
        });
        function updateValidationIcon(iconId, textId, isValid) {
          if (isValid) {
            $(iconId).removeClass("invalid").addClass("valid");
            $(textId).removeClass("invalid").addClass("valid");
          } else {
            $(iconId).removeClass("valid").addClass("invalid");
            $(textId).removeClass("valid").addClass("invalid");
          }
        }

        // Initialize dashboard
        initializeDashboard();

        // Sidebar navigation
        $(".sidebar-menu .nav-link").on("click", function (e) {
          e.preventDefault();
          const page = $(this).data("page");
          showPage(page);

          // Update active state
          $(".sidebar-menu .nav-link").removeClass("active");
          $(this).addClass("active");
        });

        // Toggle sidebar on small screens
        $("#sidebarToggle").on("click", function (e) {
          e.stopPropagation(); // Prevent the click from bubbling to document
          $("#sidebar").toggleClass("show");
        });

        // Prevent clicks inside the sidebar from closing it
        $(".sidebar").on("click", function (e) {
          e.stopPropagation();
        });

        // Hide sidebar when clicking outside
        $(document).on("click", function () {
          $(".sidebar").removeClass("show");
        });

        // Theme toggle
        $("#themeToggle").on("click", function () {
          $(this).toggleClass("active");
          $("body").attr(
            "data-theme",
            $(this).hasClass("active") ? "dark" : "light"
          );
          localStorage.setItem(
            "theme",
            $(this).hasClass("active") ? "dark" : "light"
          );
        });

        // Load saved theme
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          $("#themeToggle").addClass("active");
          $("body").attr("data-theme", "dark");
        }

        // Request action form submission
        $("#submitRequestActionBtn").on("click", function () {
          submitRequestAction();
        });
        // API Key visibility toggle
        $("#toggleApiKey").on("click", function () {
          const apiKeyInput = $("#apiKey");
          const currentType = apiKeyInput.attr("type");
          apiKeyInput.attr(
            "type",
            currentType === "password" ? "text" : "password"
          );
          $(this).find("i").toggleClass("bi-eye bi-eye-slash");
        });

        // Change role modal
        $(".change-role-btn").on("click", function () {
          const userName = $(this).data("user");
          const userId = $(this).data("id");
          $("#changeRoleUser").val(userName);
          $("#changeRoleModal").data("userId", userId);
        });

        // Export Transactions Button
        $("#exportTransactionsBtn").on("click", function () {
          exportTransactionsToPDF();
        });

        // Date Range Button: Opens the modal and pre-fills dates
        $("#dateRangeBtn").on("click", function () {
          $("#startDate").val(currentDashboardFilters.startDate || "");
          $("#endDate").val(currentDashboardFilters.endDate || "");
        });

        // Apply Date Range Button
        $("#applyDateRangeBtn").on("click", function () {
          currentDashboardFilters.startDate = $("#startDate").val();
          currentDashboardFilters.endDate = $("#endDate").val();
          $("#dateRangeModal").modal("hide");
          // Re-initialize the dashboard with the new filters
          initializeDashboard();
        });

        // Export Dashboard Button
        $("#exportDashboardBtn").on("click", function () {
          exportDashboardToPDF();
        });
      });

      function showPage(pageName) {
        // Hide all pages
        $(".page-content").addClass("d-none");

        // Show selected page
        $(`#${pageName}-page`).removeClass("d-none");

        // Initialize page-specific components
        switch (pageName) {
          case "dashboard":
            initializeDashboard();
            break;
          case "users":
            initializeUsersPage();
            break;
          case "idcards":
            initializeIdCardsPage();
            break;
          case "certificates":
            initializeCertificatesPage();
            break;
          case "transactions":
            initializeTransactionsPage();
            break;
          case "analytics":
            initializeAnalyticsPage();
            break;
          case "roles":
            initializeRolesPage();
            break;
          case "settings":
            // Settings page doesn't need special initialization
            break;
        }
      }

      async function loadUserData() {
        try {
          const response = await $.ajax({
            url: `${BACKEND_URL}/users/me`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          const user = response; // expected user object from backend
          // Update user display
          $("#currentUser").text(user.firstname + " " + user.lastname);
          // ✅ Update user profile picture dynamically
          const profilePicUrl = user.passportPhoto
            ? user.passportPhoto
            : "https://picsum.photos/seed/admin/40/40.jpg";

          $("#userProfilePic")
            .attr("src", profilePicUrl)
            .addClass("img-fluid rounded-circle profile-avatar");
        } catch (error) {
          console.error("Failed to fetch current user:", error);
          showNotification(
            "Unable to load user profile. Please refresh or log in again.",
            "danger"
          );
        }
      }

      async function initializeDashboard() {
        // Construct the query string from filters
        const queryParams = new URLSearchParams();
        if (currentDashboardFilters.startDate)
          queryParams.append("startDate", currentDashboardFilters.startDate);
        if (currentDashboardFilters.endDate)
          queryParams.append("endDate", currentDashboardFilters.endDate);
      
        $.ajax({
          url: `${BACKEND_URL}/users/dashboard-stats?${queryParams.toString()}`,
          method: "GET",
          headers: { Authorization: `Bearer ${token}` },
          success: function (data) {
            // --- Destroy old charts if they exist ---
            if (registrationTrendChart) registrationTrendChart.destroy();
            if (requestStatusChart) requestStatusChart.destroy();
            if (topLGAChart) topLGAChart.destroy();
            // --- Registration Trend ---
            const ctx1 = document
              .getElementById("registrationTrendChart")
              .getContext("2d");
            registrationTrendChart = new Chart(ctx1, {
              type: "line",
              data: {
                labels: [
                  "Jan",
                  "Feb",
                  "Mar",
                  "Apr",
                  "May",
                  "Jun",
                  "Jul",
                  "Aug",
                  "Sep",
                  "Oct",
                  "Nov",
                  "Dec",
                ],
                datasets: [
                  {
                    label: "New Registrations",
                    data: data.registrationTrend,
                    borderColor: "#6366f1",
                    backgroundColor: "rgba(99, 102, 241, 0.1)",
                    tension: 0.4,
                    fill: true,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
              },
            });

            // --- Request Status ---
            const ctx2 = document
              .getElementById("requestStatusChart")
              .getContext("2d");
            requestStatusChart = new Chart(ctx2, {
              type: "doughnut",
              data: {
                labels: ["Approved", "Pending", "Rejected"],
                datasets: [
                  {
                    data: [
                      data.requestStatus.Approved,
                      data.requestStatus.Pending,
                      data.requestStatus.Rejected,
                    ],
                    backgroundColor: ["#10b981", "#f59e0b", "#ef4444"],
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: "bottom" } },
              },
            });

            function renderRecentActivity(activityList) {
              const container = $(".activity-timeline");
              container.empty();

              if (!activityList || activityList.length === 0) {
                container.append(
                  '<div class="text-muted text-center">No recent activity</div>'
                );
                return;
              }

              activityList.forEach((item) => {
                const timeAgo = timeSince(new Date(item.createdAt));
                let actionText = "";
                switch (item.type) {
                  case "certificate":
                    actionText = `<strong>${
                      item.name
                    }</strong>'s certificate of origin was <span class="text-primary">${item.status.toLowerCase()}</span>`;
                    break;
                  case "idcard":
                    actionText = `<strong>${item.name}</strong> submitted an identity card request`;
                    break;

                  case "transaction":
                    const amountInNaira = item.amount
                      ? (item.amount / 100).toLocaleString()
                      : "0";
                    const badgeClass =
                      item.status === "success"
                        ? "text-success"
                        : item.status === "failed"
                        ? "text-danger"
                        : "text-warning";

                    actionText = `<strong>Payment</strong> of ₦${amountInNaira} for ${item.paymentType} <span class="${badgeClass}">(${item.status})</span>`;
                    break;
                  case "user":
                    if (
                      item.role === "global_admin" ||
                      item.role === "support_admin" ||
                      item.role === "kindred_head" ||
                      item.role === "user"
                    ) {
                      actionText = `<strong>${
                        item.name
                      }</strong> was assigned <span class="text-info">${item.role.replace(
                        "_",
                        " "
                      )}</span> role`;
                    } else {
                      actionText = `<strong>${item.name}</strong> registered as a new user`;
                    }
                    break;
                  default:
                    actionText = `${item.name} performed an action`;
                }

                const activityItem = `
                        <div class="activity-item">
                            <div class="activity-time">${timeAgo}</div>
                            <div class="activity-content">${actionText}</div>
                        </div>
                        `;
                container.append(activityItem);
              });
            }

            // Helper to convert date → “2 hours ago”
            function timeSince(date) {
              const seconds = Math.floor((new Date() - date) / 1000);
              const intervals = [
                { label: "year", seconds: 31536000 },
                { label: "month", seconds: 2592000 },
                { label: "day", seconds: 86400 },
                { label: "hour", seconds: 3600 },
                { label: "minute", seconds: 60 },
              ];

              for (const i of intervals) {
                const count = Math.floor(seconds / i.seconds);
                if (count >= 1)
                  return `${count} ${i.label}${count > 1 ? "s" : ""} ago`;
              }
              return "just now";
            }
            renderRecentActivity(data.recentActivities);

            // --- Top LGAs ---
            const ctx3 = document
              .getElementById("topLGAChart")
              .getContext("2d");
            topLGAChart = new Chart(ctx3, {
              type: "bar",
              data: {
                labels: data.topLGAs.map((lga) => lga.name),
                datasets: [
                  {
                    label: "Requests",
                    data: data.topLGAs.map((lga) => lga.count),
                    backgroundColor: "#6366f1",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
              },
            });
          },
          error: function (xhr) {
            console.error("Failed to load dashboard stats:", xhr.responseText);
          },
        });
      }

      /**
       * Calls the backend to generate and download a PDF report of the dashboard.
       */
      async function exportDashboardToPDF() {
        showNotification("Generating dashboard report, please wait...", "info");

        // Construct the URL with the current filters
        const queryParams = new URLSearchParams();
        if (currentDashboardFilters.startDate)
          queryParams.append("startDate", currentDashboardFilters.startDate);
        if (currentDashboardFilters.endDate)
          queryParams.append("endDate", currentDashboardFilters.endDate);
        const url = `${BACKEND_URL}/users/dashboard/export/pdf?${queryParams.toString()}`;

        try {
          // Use fetch to make an authenticated request
          const response = await fetch(url, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            // If the server responds with an error, throw it to be caught by the catch block
            const errorData = await response.json();
            throw new Error(
              errorData.message || `HTTP error! status: ${response.status}`
            );
          }

          // Get the response body as a Blob
          const pdfBlob = await response.blob();

          // Create a temporary link element to trigger the download
          const link = document.createElement("a");
          const blobUrl = URL.createObjectURL(pdfBlob);

          // Set the download file name with the current date
          const fileName = `dashboard_report_${new Date()
            .toISOString()
            .slice(0, 10)}.pdf`;

          link.setAttribute("href", blobUrl);
          link.setAttribute("download", fileName);
          link.style.visibility = "hidden";

          // Append to the document, click it, and clean up
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          // Clean up the object URL to free memory
          URL.revokeObjectURL(blobUrl);

          showNotification(
            "Dashboard report exported successfully!",
            "success"
          );
        } catch (error) {
          console.error("Error exporting dashboard report:", error);
          showNotification(
            `Failed to export report: ${error.message}`,
            "error"
          );
        }
      }
      async function initializeUsersPage() {
        function calculateAge(dob) {
          if (!dob) return "";
          const birthDate = new Date(dob);
          const today = new Date();
          let age = today.getFullYear() - birthDate.getFullYear();
          const monthDiff = today.getMonth() - birthDate.getMonth();

          if (
            monthDiff < 0 ||
            (monthDiff === 0 && today.getDate() < birthDate.getDate())
          ) {
            age--;
          }
          return age;
        }

        try {
          $.ajax({
            url: `${BACKEND_URL}/users`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (response) {
              // The actual array is in response.data
              const usersArray = response.data || [];

              // Initialize or re-draw DataTable
              if ($.fn.DataTable.isDataTable("#usersTable")) {
                $("#usersTable")
                  .DataTable()
                  .clear()
                  .rows.add(usersArray)
                  .draw();
              } else {
                $("#usersTable").DataTable({
                  data: usersArray,
                  columns: [
                    {
                      data: null,
                      render: function (row) {
                        return `${row.firstname || ""} ${row.lastname || ""}`;
                      },
                    },
                    { data: "email" },
                    {
                      data: "role",
                      render: function (data) {
                        let badgeClass = "bg-primary";
                        if (data === "super_admin") badgeClass = "bg-danger";
                        else if (data === "support_admin")
                          badgeClass = "bg-warning";
                        else if (data === "kindred_head")
                          badgeClass = "bg-info";

                        return `<span class="badge ${badgeClass}">${data
                          .replace("_", " ")
                          .toUpperCase()}</span>`;
                      },
                    },

                    {
                      data: "isActive",
                      render: function (data) {
                        return data
                          ? `<span class="badge bg-success">Active</span>`
                          : `<span class="badge bg-secondary">Inactive</span>`;
                      },
                    },
                    {
                      data: "stateOfOrigin",
                      render: function (data) {
                        if (!data) return "N/A";
                        return data;
                      },
                    },
                    {
                      data: "lgaOfOrigin",
                      render: function (data) {
                        if (!data) return "N/A";
                        return data;
                      },
                    },

                    {
                      data: "created_at",
                      render: function (data) {
                        return new Date(data).toLocaleDateString();
                      },
                    },
                    {
                      data: null,
                      render: function (row) {
                        return `
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-primary edit-user-btn" data-id="${row._id}">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning change-role-btn" 
                                            data-id="${row._id}" data-user="${row.firstname}" 
                                            data-bs-toggle="modal" data-bs-target="#changeRoleModal">
                                        <i class="bi bi-person-badge"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger deactivate-user-btn" data-id="${row._id}">
                                        <i class="bi bi-person-x"></i>
                                    </button>
                                </div>
                            `;
                      },
                    },
                  ],
                  responsive: true,
                  pageLength: 10,
                });
              }
            },
            error: function (xhr) {
              console.error("Failed to fetch users:", xhr.responseText);
            },
          });

          // 2. Fetch User Stats (for charts)
          $.ajax({
            url: `${BACKEND_URL}/users/stats`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (statsData) {
              // 🧹 Ensure old charts are fully destroyed
              destroyChart(ageDistributionChart, "ageDistributionChart");
              destroyChart(genderDistributionChart, "genderDistributionChart");
              destroyChart(stateDistributionChart, "stateDistributionChart");

              // Age distribution chart
              const ctx1 = document
                .getElementById("ageDistributionChart")
                .getContext("2d");
              new Chart(ctx1, {
                type: "bar",
                data: {
                  labels: Object.keys(statsData.ageDistribution),
                  datasets: [
                    {
                      label: "Users",
                      data: Object.values(statsData.ageDistribution),
                      backgroundColor: "#6366f1",
                    },
                  ],
                },
                options: { responsive: true, maintainAspectRatio: false },
              });

              // Gender distribution chart
              const ctx2 = document
                .getElementById("genderDistributionChart")
                .getContext("2d");
              new Chart(ctx2, {
                type: "pie",
                data: {
                  labels: Object.keys(statsData.genderDistribution),
                  datasets: [
                    {
                      data: Object.values(statsData.genderDistribution),
                      backgroundColor: ["#6366f1", "#ec4899"],
                    },
                  ],
                },
                options: { responsive: true, maintainAspectRatio: false },
              });

              // State distribution chart
              const ctx3 = document
                .getElementById("stateDistributionChart")
                .getContext("2d");
              new Chart(ctx3, {
                type: "doughnut",
                data: {
                  labels: Object.keys(statsData.stateDistribution),
                  datasets: [
                    {
                      data: Object.values(statsData.stateDistribution),
                      backgroundColor: [
                        "#6366f1",
                        "#8b5cf6",
                        "#ec4899",
                        "#f59e0b",
                        "#10b981",
                        "#64748b",
                      ],
                    },
                  ],
                },
                options: { responsive: true, maintainAspectRatio: false },
              });
            },
            error: function (xhr) {
              console.error("Failed to fetch stats:", xhr.responseText);
            },
          });
        } catch (err) {
          console.error("Unexpected error:", err);
        }
      }

      // ✅ SAFETY WRAPPER — Ensures Chart.js fully releases canvas
      function destroyChart(chartInstance, canvasId) {
        if (chartInstance) {
          chartInstance.destroy();
        }
        // Chart.js maintains internal registry. Manually unregister if needed:
        const chartStatus = Chart.getChart(canvasId);
        if (chartStatus) {
          chartStatus.destroy();
        }

        // Clear canvas to ensure it’s truly free
        const canvas = document.getElementById(canvasId);
        if (canvas) {
          const ctx = canvas.getContext("2d");
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }

      // 🔹 Edit User (show form, submit update)
      $(document).on("click", ".edit-user-btn", function () {
        const userId = $(this).data("id");

        // Fetch user details (optional if already in table)
        $.ajax({
          url: `${BACKEND_URL}/users/${userId}`,
          method: "GET",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          success: function (user) {
            // Fill modal form fields
            $("#editUserId").val(user._id);
            $("#editFirstname").val(user.firstname);
            $("#editLastname").val(user.lastname);
            $("#editEmail").val(user.email);
            $("#editPhone").val(user.phone || "");

            // Show modal
            $("#editUserModal").modal("show");
          },
          error: function (xhr) {
            console.error("Failed to fetch user details:", xhr.responseText);
          },
        });
      });

      // 🔹 Handle Edit User form submission
      $("#editUserForm").on("submit", function (e) {
        e.preventDefault();
        const userId = $("#editUserId").val();
        const payload = {
          firstname: $("#editFirstname").val(),
          lastname: $("#editLastname").val(),
          email: $("#editEmail").val(),
          phoneNumber: $("#editPhone").val(),
        };

        $.ajax({
          url: `${BACKEND_URL}/users/${userId}/user-details`,
          method: "PUT",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          data: JSON.stringify(payload),
          success: function () {
            $("#editUserModal").modal("hide");
            initializeUsersPage(); // refresh list
            showNotification(
              "Updated!",
              "User details updated successfully.",
              "success"
            );
          },
          error: function (xhr) {
            showNotification(
              "Error",
              xhr.responseText || "Failed to update user",
              "danger"
            );
          },
        });
      });

      // 🔹 Open Change Role Modal
      $(document).on("click", ".change-role-btn", function () {
        const userId = $(this).data("id");
        const userName = $(this).data("user");
        $("#changeRoleUserId").val(userId);
        $("#changeRoleUser").val(userName);
      });

      // 🔹 Handle Role Change Submission
      $("#changeRoleForm").on("submit", function (e) {
        e.preventDefault();
        const userId = $("#changeRoleUserId").val();
        const newRole = $("#changeRoleNew").val();
        $.ajax({
          url: `${BACKEND_URL}/users/${userId}/role`,
          method: "PATCH",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          data: JSON.stringify({ role: newRole }),
          success: function () {
            $("#changeRoleModal").modal("hide");
            initializeUsersPage();
            showNotification(
              "Success",
              "User role updated successfully",
              "success"
            );
          },
          error: function (xhr) {
            showNotification(
              "Error",
              xhr.responseText || "Failed to change role",
              "danger"
            );
          },
        });
      });

      $(document).on("click", ".deactivate-user-btn", function () {
        const userId = $(this).data("id");

        Swal.fire({
          title: "Are you sure?",
          text: "This will toggle the user's active status.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Yes, proceed",
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: `${BACKEND_URL}/users/${userId}/toggle-status`,
              method: "PATCH",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function () {
                initializeUsersPage();
                showNotification("Done!", "User status updated.", "success");
              },
              error: function (xhr) {
                showNotification(
                  "Error",
                  xhr.responseText || "Failed to update user status",
                  "danger"
                );
              },
            });
          }
        });
      });

      // Call on page load
      $(document).ready(function () {
        initializeUsersPage();
        initializeIdCardsPage();
      });

      async function initializeIdCardsPage() {
        try {
          $.ajax({
            url: `${BACKEND_URL}/idcard/get-all-request`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (response) {
              if (!Array.isArray(response)) {
                console.error("Invalid response format:", response);
                return;
              }

              // 🔹 Prepare data for the DataTable
              const idcardsData = response.map((req, index) => ({
                _id: req._id, // Keep original ID for actions
                id: index + 1,
                user: req.userId?.firstname
                  ? `${req.userId.firstname} ${req.userId.lastname}`
                  : "Unknown",
                state: req.userId?.stateOfOrigin || "N/A",
                lga: req.userId?.lgaOfOrigin || "N/A",
                status: req.status
                  ? req.status.charAt(0).toUpperCase() + req.status.slice(1)
                  : "Pending",
                requestDate: req.created_at
                  ? new Date(req.created_at).toLocaleDateString()
                  : "N/A",
                approvedBy: req.approvedBy
                  ? `${req.approvedBy.firstname} ${req.approvedBy.lastname}`
                  : req.status === "Rejected"
                  ? "Rejected by Admin"
                  : "Not yet approved",

                // approvedBy: req.approvedBy ? `${req.approvedBy.firstname} ${req.approvedBy.lastname}` : "N/A",
                isProfileCompleted: req.userId?.isProfileCompleted
                  ? `<span class="badge bg-success">Yes</span>`
                  : `<span class="badge bg-danger">No</span>`,
              }));

              // 🔹 Initialize or refresh the DataTable
              if ($.fn.DataTable.isDataTable("#idcardsTable")) {
                $("#idcardsTable")
                  .DataTable()
                  .clear()
                  .rows.add(idcardsData)
                  .draw();
              } else {
                $("#idcardsTable").DataTable({
                  data: idcardsData,
                  columns: [
                    { data: "id" },
                    { data: "user" },
                    { data: "state" },
                    { data: "lga" },
                    {
                      data: "status",
                      render: function (data) {
                        let badgeClass = "bg-primary";
                        if (data === "Approved") badgeClass = "bg-success";
                        else if (data === "Pending") badgeClass = "bg-warning";
                        else if (data === "Rejected") badgeClass = "bg-danger";
                        return `<span class="badge ${badgeClass}">${data}</span>`;
                      },
                    },
                    { data: "requestDate" },
                    { data: "isProfileCompleted" },
                    { data: "approvedBy" },
                    {
                      // Actions column
                      orderable: false,
                      searchable: false,
                      width: "120px",
                      // data: null,
                      // render: function (data, type, row) {
                      //   return `
                      //       <div class="btn-group">
                      //       <button class="btn btn-sm btn-outline-primary view-request-btn" data-id="${data._id}">
                      //           <i class="bi bi-eye"></i>
                      //       </button>
                      //       <button class="btn btn-sm btn-outline-success approve-request-btn" data-id="${data._id}">
                      //           <i class="bi bi-check-circle"></i>
                      //       </button>
                      //       <button class="btn btn-sm btn-outline-danger reject-request-btn" data-id="${data._id}">
                      //           <i class="bi bi-x-circle"></i>
                      //       </button>
                      //       </div>
                      //   `;
                      // },

                      data: null,
                      render: function (data, type, row) {
                        let actionButtons = "";
                        let downloadButton = "";

                        // Show action buttons only for pending requests
                        if (row.status === "Pending") {
                          actionButtons = `
        <button class="btn btn-sm btn-outline-success approve-request-btn" data-id="${row._id}" data-type="idcard" data-bs-toggle="modal" data-bs-target="#requestActionModal">
          <i class="bi bi-check-circle"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger reject-request-btn" data-id="${row._id}" data-type="idcard" data-bs-toggle="modal" data-bs-target="#requestActionModal">
          <i class="bi bi-x-circle"></i>
        </button>
      `;
                        }

                        // Show download button only for approved requests
                        if (row.status === "Approved") {
                          downloadButton = `
        <button class="btn btn-sm btn-outline-danger btn-card-download" data-id="${row._id}">
          <i class="bi bi-download"></i>
        </button>
      `;
                        }

                        return `
        <div class="btn-group">
          <button class="btn btn-sm btn-outline-primary btn-view" data-id="${row._id}">
            <i class="bi bi-eye"></i>
          </button>
          ${actionButtons}
          ${downloadButton}
        </div>
      `;
                      },
                    },
                  ],
                  responsive: true,
                  pageLength: 10,
                });
              }

              // 🔹 Compute statistics for charts
              const monthlyTrend = {};
              const stateDistribution = {};

              response.forEach((req) => {
                // Monthly trend (by createdAt)
                if (req.created_at) {
                  const month = new Date(req.created_at).toLocaleString(
                    "default",
                    {
                      month: "short",
                      year: "numeric",
                    }
                  );
                  monthlyTrend[month] = (monthlyTrend[month] || 0) + 1;
                }

                // State distribution
                const state =
                  req.userId?.stateOfOrigin.toUpperCase() || "Unknown";
                stateDistribution[state] = (stateDistribution[state] || 0) + 1;
              });

              // 🔹 Render Charts
              renderIdCardCharts(monthlyTrend, stateDistribution);
            },
            error: function (xhr) {
              console.error(
                "Failed to fetch ID card requests:",
                xhr.responseText
              );
            },
          });
        } catch (err) {
          console.error("Unexpected error:", err);
        }
      }

      $(document).on(
        "click",
        ".approve-request-btn, .reject-request-btn",
        function () {
          const requestId = $(this).data("id");
          const requestType = $(this).data("type");
          const action = $(this).hasClass("approve-request-btn")
            ? "approve"
            : "reject";

          $("#requestActionType").val(action);
          $("#requestActionModal").data("requestId", requestId);
          $("#requestActionModal").data("requestType", requestType);
        }
      );

      function submitRequestAction() {
        const requestId = $("#requestActionModal").data("requestId");
        const requestType = $("#requestActionModal").data("requestType");
        const action = $("#requestActionType").val(); // "approve" or "reject"
        const reason = $("#requestActionReason").val();

        if (!requestId || !action) {
          showNotification("Invalid request. Please try again.", "danger");
          return;
        }

        // Determine endpoint based on request type
        let endpoint = "";
        if (requestType === "idcard") {
          endpoint = `${BACKEND_URL}/idcard/${requestId}/${action}`;
        } else if (requestType === "certificate") {
          endpoint = `${BACKEND_URL}/indigene/certificate/${requestId}/${action}`;
        } else {
          showNotification("Unknown request type.", "danger");
          return;
        }

        // Disable submit button to prevent multiple clicks
        $("#submitActionBtn").prop("disabled", true).text("Processing...");

        // ✅ Real API call
        $.ajax({
          url: endpoint,
          method: "PATCH",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          data: JSON.stringify({
            rejectionReason: reason,
            approvedBy: user.id,
          }),
          success: function (response) {
            // Close modal and reset
            $("#requestActionModal").modal("hide");
            $("#requestActionForm")[0].reset();

            // Refresh dashboard
            initializeDashboard();

            // Refresh the table to reflect the change
            initializeIdCardsPage();

            initializeCertificatesPage();

            initializeIdCardsPage();

            // Show success message
            showNotification(`Request ${action}d successfully`, "success");
          },
          error: function (xhr) {
            console.error("Error:", xhr.responseText);
            showNotification(
              xhr.responseJSON?.message || `Failed to ${action} request.`,
              "danger"
            );
          },
          complete: function () {
            $("#submitActionBtn").prop("disabled", false).text("Submit");
          },
        });
      }

      function renderIdCardCharts(monthlyTrend, stateDistribution) {
        // Safely destroy old charts if they exist and are Chart.js instances
        if (window.idcardTrendChart instanceof Chart) {
          window.idcardTrendChart.destroy();
        }
        if (window.idcardStateChart instanceof Chart) {
          window.idcardStateChart.destroy();
        }

        // 📈 Monthly trend chart
        const ctx1 = document.getElementById("idcardTrendChart");
        if (!ctx1) {
          console.error("❌ Missing #idcardTrendChart canvas element");
          return;
        }

        window.idcardTrendChart = new Chart(ctx1.getContext("2d"), {
          type: "line",
          data: {
            labels: Object.keys(monthlyTrend),
            datasets: [
              {
                label: "Requests",
                data: Object.values(monthlyTrend),
                borderColor: "#6366f1",
                backgroundColor: "rgba(99, 102, 241, 0.1)",
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } },
          },
        });

        // 🥧 State distribution chart
        const ctx2 = document.getElementById("idcardStateChart");
        if (!ctx2) {
          console.error("❌ Missing #idcardStateChart canvas element");
          return;
        }

        window.idcardStateChart = new Chart(ctx2.getContext("2d"), {
          type: "pie",
          data: {
            labels: Object.keys(stateDistribution),
            datasets: [
              {
                data: Object.values(stateDistribution),
                backgroundColor: [
                  "#6366f1",
                  "#8b5cf6",
                  "#ec4899",
                  "#f59e0b",
                  "#10b981",
                  "#64748b",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: "bottom" } },
          },
        });
      }

      $(document).ready(function () {
        initializeIdCardsPage();
      });

      async function initializeCertificatesPage() {
        if ($.fn.DataTable.isDataTable("#certificatesTable")) {
          $("#certificatesTable").DataTable().destroy();
        }

        const headers = {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        };

        try {
          const response = await $.ajax({
            url: `${BACKEND_URL}/indigene/certificate/get-all-request`,
            method: "GET",
            headers: headers,
          });
          // ✅ Prepare table data
          const tableData = response.map((item, index) => ({
            _id: item._id, // Keep original ID for actions
            id: index + 1,
            user: item.userId?.firstname
              ? `${item.userId.firstname} ${item.userId.lastname}`
              : "Unknown",
            state: item.userId?.stateOfOrigin || "N/A",
            lga: item.userId?.lgaOfOrigin || "N/A",
            status: item?.status || "Pending",
            requestTime: item.created_at
              ? new Date(item.created_at).toLocaleString()
              : "N/A",
            isProfileCompleted: item.userId?.isProfileCompleted
              ? `<span class="badge bg-success">Yes</span>`
              : `<span class="badge bg-danger">No</span>`,
            approvedBy: item.approvedBy
              ? `${item.approvedBy.firstname} ${item.approvedBy.lastname}`
              : item.status === "Rejected"
              ? "Rejected by Admin"
              : "Not yet approved",
          }));

          // ✅ Initialize DataTable
          const certificatesTable = $("#certificatesTable").DataTable({
            data: tableData,
            columns: [
              { data: "id" },
              { data: "user" },
              { data: "state" },
              { data: "lga" },
              {
                data: "status",
                render: function (data) {
                  let badgeClass = "bg-primary";
                  if (data.toLowerCase() === "approved")
                    badgeClass = "bg-success";
                  else if (data.toLowerCase() === "pending")
                    badgeClass = "bg-warning";
                  else if (data.toLowerCase() === "rejected")
                    badgeClass = "bg-danger";
                  return `<span class="badge ${badgeClass}">${data}</span>`;
                },
              },
              { data: "requestTime" },
              { data: "isProfileCompleted" },
              { data: "approvedBy" },
              {
                // Actions column
                orderable: false,
                searchable: false,
                width: "120px",

                // data: null,
                // render: function (data, type, row) {
                //   return `
                //         <div class="btn-group">
                //             <button class="btn btn-sm btn-outline-primary view-cert-request-btn" data-id="${data._id}">
                //             <i class="bi bi-eye"></i>
                //             </button>
                //             <button class="btn btn-sm btn-outline-success approve-cert-request-btn" data-id="${data._id}">
                //             <i class="bi bi-check-circle"></i>
                //             </button>
                //             <button class="btn btn-sm btn-outline-danger reject-cert-request-btn" data-id="${data._id}">
                //             <i class="bi bi-x-circle"></i>
                //             </button>
                //         </div>
                //         `;
                // },
                data: null,
                render: function (data, type, row) {
                  let actionButtons = "";
                  let downloadButton = "";

                  // Show action buttons only for pending requests
                  if (row.status === "Pending") {
                    actionButtons = `
        <button class="btn btn-sm btn-outline-success approve-request-btn" data-id="${row._id}" data-type="certificate" data-bs-toggle="modal" data-bs-target="#requestActionModal">
          <i class="bi bi-check-circle"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger reject-request-btn" data-id="${row._id}" data-type="certificate" data-bs-toggle="modal" data-bs-target="#requestActionModal">
          <i class="bi bi-x-circle"></i>
        </button>
      `;
                  }

                  // Show download button only for approved requests
                  if (row.status === "Approved") {
                    downloadButton = `
        <button class="btn btn-sm btn-outline-danger btn-cert-download" data-id="${row._id}">
          <i class="bi bi-download"></i>
        </button>
      `;
                  }

                  return `
        <div class="btn-group">
          <button class="btn btn-sm btn-outline-primary btn-cert-view" data-id="${row._id}">
            <i class="bi bi-eye"></i>
          </button>
          ${actionButtons}
          ${downloadButton}
        </div>
      `;
                },
              },
            ],
            responsive: true,
            pageLength: 10,
          });

          // ✅ Chart data grouping by date
          const dailyBreakdown = {};
          const lgaCounts = {};

          response.forEach((item) => {
            const day = new Date(item.created_at).toLocaleDateString();
            dailyBreakdown[day] = (dailyBreakdown[day] || 0) + 1;
            const lga = item.userId?.lgaOfOrigin || "Unknown";
            lgaCounts[lga] = (lgaCounts[lga] || 0) + 1;
          });

          destroyChart(certificateDailyChart, "certificateDailyChart");
          destroyChart(certificateLGAChart, "certificateLGAChart");

          // ✅ Daily Requests Chart
          const ctx1 = document
            .getElementById("certificateDailyChart")
            .getContext("2d");
          new Chart(ctx1, {
            type: "bar",
            data: {
              labels: Object.keys(dailyBreakdown),
              datasets: [
                {
                  label: "Requests",
                  data: Object.values(dailyBreakdown),
                  backgroundColor: "#6366f1",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: { y: { beginAtZero: true } },
            },
          });

          // ✅ Top LGA Chart
          const ctx2 = document
            .getElementById("certificateLGAChart")
            .getContext("2d");
          new Chart(ctx2, {
            type: "bar",
            data: {
              labels: Object.keys(lgaCounts),
              datasets: [
                {
                  label: "Requests",
                  data: Object.values(lgaCounts),
                  backgroundColor: "#6366f1",
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: { x: { beginAtZero: true } },
            },
          });
        } catch (error) {
          console.error("Error loading certificate data:", error);
        }
      }

      $(document).ready(function () {
        initializeCertificatesPage();

        // ✅ Approve certificate request
        $(document).on("click", ".approve-cert-request-btn", function () {
          const requestId = $(this).data("id");

          if (
            !confirm(
              "Are you sure you want to approve this certificate request?"
            )
          )
            return;

          $.ajax({
            url: `${BACKEND_URL}/indigene/certificate/${requestId}/approve`,
            method: "PATCH",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            data: JSON.stringify({ approvedBy: user.id }), // Optionally send who approved
            success: function (response) {
              showNotification(
                "✅ Certificate request approved successfully!",
                "success"
              );
              // Refresh the table to reflect the change
              initializeCertificatesPage();
            },
            error: function (xhr) {
              console.error("Failed to approve request:", xhr.responseText);
              showNotification("❌ Failed to approve request.", "danger");
            },
          });
        });

        // ❌ Reject certificate request
        $(document).on("click", ".reject-cert-request-btn", function () {
          const requestId = $(this).data("id");

          if (
            !confirm(
              "Are you sure you want to reject this certificate request?"
            )
          )
            return;

          $.ajax({
            url: `${BACKEND_URL}/indigene/certificate/${requestId}/reject`,
            method: "PATCH",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (response) {
              showNotification(
                "🚫 Certificate request rejected successfully!",
                "success"
              );
              // Refresh the table to reflect the change
              initializeCertificatesPage();
            },
            error: function (xhr) {
              console.error("Failed to reject request:", xhr.responseText);
              showNotification("❌ Failed to reject request.", "danger");
            },
          });
        });
        $(document).on("click", ".view-cert-request-btn", function () {
          const requestId = $(this).data("id");

          // Show modal immediately with loading state
          $("#viewCertRequestModal").modal("show");
          $("#viewCertRequestContent").html(`
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2">Loading request details...</p>
                </div>
            `);

          // Fetch details from backend
          $.ajax({
            url: `${BACKEND_URL}/indigene/certificate/${requestId}/request`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (data) {
              console.log("Certificate Request details:", data);
              if (!data) {
                $("#viewCertRequestContent").html(
                  "<p class='text-danger'>No details found for this request.</p>"
                );
                return;
              }

              const user = data.userId || {};
              const approvedBy = data.approvedBy
                ? `${data.approvedBy.firstname} ${data.approvedBy.lastname}`
                : "Not yet approved";
              const createdAt = data.created_at
                ? new Date(data.created_at).toLocaleString()
                : "N/A";

              // Build the HTML for the modal content
              const detailsHtml = `
                        <div class="row">
                            <div class="col-md-6">
                                <h6><strong>User:</strong> ${
                                  user.firstname || ""
                                } ${user.lastname || ""}</h6>
                                <p><strong>Email:</strong> ${
                                  user.email || "N/A"
                                }</p>
                                <p><strong>Phone:</strong> ${
                                  user.phone || "N/A"
                                }</p>
                                <p><strong>State of Origin:</strong> ${
                                  user.stateOfOrigin || "N/A"
                                }</p>
                                <p><strong>LGA:</strong> ${
                                  user.lgaOfOrigin || "N/A"
                                }</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Status:</strong> 
                                    <span class="badge ${
                                      data.status === "Approved"
                                        ? "bg-success"
                                        : data.status === "Rejected"
                                        ? "bg-danger"
                                        : "bg-warning"
                                    }">
                                        ${data.status}
                                    </span>
                                </p>
                                <p><strong>Approved By:</strong> ${approvedBy}</p>
                                <p><strong>Request Date:</strong> ${createdAt}</p>
                                <p><strong>Profile Completed:</strong> ${
                                  user.isProfileCompleted
                                    ? '<span class="badge bg-success">Yes</span>'
                                    : '<span class="badge bg-danger">No</span>'
                                }</p>
                            </div>
                        </div>
                    `;
              $("#viewCertRequestContent").html(detailsHtml);
            },
            error: function (xhr) {
              console.error(
                "Failed to fetch request details:",
                xhr.responseText
              );
              $("#viewCertRequestContent").html(
                "<p class='text-danger'>Failed to load request details.</p>"
              );
            },
          });
        });
      });

      function initializeTransactionsPage() {
        const headers = {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        };

        // 1️⃣ Fetch Transactions for Table
        $.ajax({
          url: `${BACKEND_URL}/transaction/all`,
          method: "GET",
          headers,
          success: function (transactions) {
            if (!Array.isArray(transactions)) {
              console.error("Invalid transactions data:", transactions);
              return;
            }

            if (!transactionsTable) {
              transactionsTable = $("#transactionsTable").DataTable({
                data: transactions.map((t) => ({
                  id: t._id,
                  user: t.userId?.firstname
                    ? `${t.userId.firstname} ${t.userId.lastname}`
                    : "N/A",
                  type: t.paymentType || "N/A",
                  amount: (t.amount || 0) / 100,
                  status: t.status || "Pending",
                  datetime: new Date(t.createdAt).toLocaleString(),
                })),
                columns: [
                  { data: "id" },
                  { data: "user" },
                  { data: "type" },

                  {
                    data: "amount",
                    render: (data) =>
                      `₦${Number(data).toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                      })}`,
                  },
                  {
                    data: "status",
                    render: function (data) {
                      let badgeClass = "bg-primary";
                      if (data === "Completed") badgeClass = "bg-success";
                      else if (data === "Pending") badgeClass = "bg-warning";
                      else if (data === "Failed") badgeClass = "bg-danger";
                      return `<span class="badge ${badgeClass}">${data}</span>`;
                    },
                  },
                  { data: "datetime" },
                  {
                    data: null,
                    render: function (data, type, row) {
                      return `
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary view-transaction-btn" data-id="${row.id}">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success refund-transaction-btn" data-id="${row.id}">
                                            <i class="bi bi-arrow-counterclockwise"></i>
                                        </button>
                                    </div>
                                `;
                    },
                  },
                ],
                responsive: true,
                pageLength: 10,
              });
            } else {
              transactionsTable
                .clear()
                .rows.add(
                  transactions.map((t) => ({
                    id: t._id,
                    user: t.userId?.firstname
                      ? `${t.userId.firstname} ${t.userId.lastname}`
                      : "N/A",
                    type: t.paymentType || "N/A",
                    amount: (t.amount || 0) / 100,
                    status: t.status || "Pending",
                    datetime: new Date(t.createdAt).toLocaleString(),
                  }))
                )
                .draw();
            }
          },
          error: function (err) {
            console.error("Error loading transactions:", err);
          },
        });

        // 2️⃣ Fetch Transaction Stats (for charts)
        $.ajax({
          url: `${BACKEND_URL}/transaction/stats`,
          method: "GET",
          headers,
          success: function (stats) {
            // Transaction Trend Chart
            if (!transactionTrendChart) {
              const ctx1 = document
                .getElementById("transactionTrendChart")
                .getContext("2d");
              transactionTrendChart = new Chart(ctx1, {
                type: "line",
                data: {
                  labels: Object.keys(stats.monthlyTrend || {}),
                  datasets: [
                    {
                      label: "Revenue (₦)",
                      data: Object.values(stats.monthlyTrend || {}),
                      borderColor: "#10b981",
                      backgroundColor: "rgba(16, 185, 129, 0.1)",
                      tension: 0.4,
                      fill: true,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { display: false } },
                  scales: {
                    y: {
                      beginAtZero: true,
                      ticks: {
                        callback: (value) => "₦" + value.toLocaleString(),
                      },
                    },
                  },
                },
              });
            }

            // Revenue by State Chart
            if (!revenueStateChart) {
              const ctx2 = document
                .getElementById("revenueStateChart")
                .getContext("2d");
              revenueStateChart = new Chart(ctx2, {
                type: "pie",
                data: {
                  labels: Object.keys(stats.revenueByLGA || {}),
                  datasets: [
                    {
                      data: Object.values(stats.revenueByLGA || {}),
                      backgroundColor: [
                        "#6366f1",
                        "#8b5cf6",
                        "#ec4899",
                        "#f59e0b",
                        "#10b981",
                        "#64748b",
                      ],
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { position: "bottom" } },
                },
              });
            }
          },
          error: function (err) {
            console.error("Error loading stats:", err);
          },
        });
      }

      function initializeAnalyticsPage() {
        $.ajax({
          url: `${BACKEND_URL}/users/analytics-stats`,
          method: "GET",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          success: function (stats) {
            initializeMapView();

            // ✅ GROWTH COMPARISON CHART
            const userLabels = Object.keys(stats.monthlyUserGrowth || {});
            const userGrowth = Object.values(stats.monthlyUserGrowth || {});
            const requestVolume = Object.values(
              stats.monthlyRequestVolume || {}
            );

            if (!growthComparisonChart) {
              const ctx1 = document
                .getElementById("growthComparisonChart")
                .getContext("2d");
              growthComparisonChart = new Chart(ctx1, {
                type: "line",
                data: {
                  labels: userLabels,
                  datasets: [
                    {
                      label: "User Growth",
                      data: userGrowth,
                      borderColor: "#6366f1",
                      backgroundColor: "rgba(99, 102, 241, 0.1)",
                      tension: 0.4,
                      fill: true,
                    },
                    {
                      label: "Request Volume",
                      data: requestVolume,
                      borderColor: "#10b981",
                      backgroundColor: "rgba(16, 185, 129, 0.1)",
                      tension: 0.4,
                      fill: true,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              });
            }

            // ✅ AVERAGE PROCESSING TIME CHART
            const processLabels = Object.keys(
              stats.averageProcessingTime || {}
            );
            const processValues = Object.values(
              stats.averageProcessingTime || {}
            );

            if (!processingTimeChart) {
              const ctx2 = document
                .getElementById("processingTimeChart")
                .getContext("2d");
              processingTimeChart = new Chart(ctx2, {
                type: "bar",
                data: {
                  labels: processLabels,
                  datasets: [
                    {
                      label: "Average Processing Time (hours)",
                      data: processValues,
                      backgroundColor: "#6366f1",
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { display: false } },
                  scales: { y: { beginAtZero: true } },
                },
              });
            }

            // ✅ REQUEST TYPE DISTRIBUTION CHART
            const requestLabels = Object.keys(
              stats.requestTypeDistribution || {}
            );
            const requestValues = Object.values(
              stats.requestTypeDistribution || {}
            );

            if (!requestTypeChart) {
              const ctx3 = document
                .getElementById("requestTypeChart")
                .getContext("2d");
              requestTypeChart = new Chart(ctx3, {
                type: "doughnut",
                data: {
                  labels: requestLabels,
                  datasets: [
                    {
                      data: requestValues,
                      backgroundColor: [
                        "#6366f1",
                        "#8b5cf6",
                        "#ec4899",
                        "#f59e0b",
                      ],
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { position: "bottom" } },
                },
              });
            }
          },
          error: function (err) {
            console.error("Error loading analytics:", err);
          },
        });
      }

      function initializeMapView() {
        // Initialize the map and center it on Nigeria (approx)
        const map = L.map("mapView").setView([7.5, 8.8], 7); // Benue State focus

        // Add OpenStreetMap tiles
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 18,
          attribution: "© OpenStreetMap contributors",
        }).addTo(map);

        // Fetch location-based stats from API
        $.ajax({
          url: `${BACKEND_URL}/idcard/location-stats`,
          method: "GET",
          headers: { Authorization: `Bearer ${token}` },
          success: function (response) {
            if (!response || !Array.isArray(response)) return;

            response.forEach((location) => {
              const { name, lat, lng, totalRequests } = location;

              // Add a circle marker for each location
              L.circleMarker([lat, lng], {
                radius: Math.sqrt(totalRequests) * 1.5, // size proportional to requests
                color: "#6366f1",
                fillColor: "#6366f1",
                fillOpacity: 0.5,
              })
                .addTo(map)
                .bindPopup(
                  `<strong>${name}</strong><br>Total Requests: ${totalRequests}`
                );
            });
          },
          error: function (err) {
            console.error("Error loading location stats:", err);
          },
        });
      }

      async function initializeRolesPage() {
        try {
          // 🔹 Fetch all users from backend
          const response = await $.ajax({
            url: `${BACKEND_URL}/users`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          const users = Array.isArray(response.data) ? response.data : [];

          // 🔹 Prepare role counts for chart
          const roleCounts = {
            global_admin: 0,
            support_admin: 0,
            kindred_head: 0,
            user: 0,
          };

          users.forEach((u) => {
            const role = (u.role || "user").toLowerCase();
            if (roleCounts[role] !== undefined) roleCounts[role]++;
            else roleCounts.user++; // fallback
          });

          // 🔹 Initialize DataTable
          if (!rolesTable) {
            rolesTable = $("#rolesTable").DataTable({
              data: users.map((u) => ({
                id: u._id,
                name:
                  `${u.firstname || ""} ${u.lastname || ""}`.trim() || "N/A",
                email: u.email || "N/A",
                role: u.role || "user",
                assignedBy: u.assignedBy || "N/A",
                registeredAt: new Date(u.created_at).toLocaleString(),
              })),
              columns: [
                { data: "name" },
                { data: "email" },
                {
                  data: "role",
                  render: function (data) {
                    let badgeClass = "bg-primary";
                    if (data === "super_admin") badgeClass = "bg-danger";
                    else if (data === "support_admin")
                      badgeClass = "bg-warning";
                    else if (data === "kindred_head") badgeClass = "bg-info";
                    else badgeClass = "bg-success";

                    return `<span class="badge ${badgeClass}">${data
                      .replace("_", " ")
                      .toUpperCase()}</span>`;
                  },
                },
                { data: "assignedBy" },
                { data: "registeredAt" },
                {
                  data: null,
                  render: function (data, type, row) {
                    return `
                                    <button class="btn btn-sm btn-outline-primary change-role-btn"
                                        data-id="${row.id}"
                                        data-user="${row.name}"
                                        data-bs-toggle="modal"
                                        data-bs-target="#changeRoleModal">
                                        <i class="bi bi-person-badge"></i> Change Role
                                    </button>
                                `;
                  },
                },
              ],
              responsive: true,
              pageLength: 10,
            });
          } else {
            // rolesTable.clear().rows.add(users).draw();
            rolesTable
              .clear()
              .rows.add(
                users.map((u) => ({
                  id: u._id,
                  name:
                    `${u.firstname || ""} ${u.lastname || ""}`.trim() || "N/A",
                  email: u.email || "N/A",
                  role: u.role || "user",
                  assignedBy: u.assignedBy || "N/A",
                  registeredAt: new Date(u.created_at).toLocaleString(),
                }))
              )
              .draw();
          }

          // 🔹 Initialize role distribution chart
          if (!roleDistributionChart) {
            const ctx = document
              .getElementById("roleDistributionChart")
              .getContext("2d");
            roleDistributionChart = new Chart(ctx, {
              type: "pie",
              data: {
                labels: [
                  "Support Admin",
                  "Kindred Head",
                  "User",
                  "Global Admin",
                ],
                datasets: [
                  {
                    data: [
                      roleCounts.support_admin,
                      roleCounts.kindred_head,
                      roleCounts.user,
                      roleCounts.global_admin,
                    ],
                    backgroundColor: [
                      // "#ef4444",
                      "#f59e0b",
                      "#3b82f6",
                      "#10b981",
                      "#8b5cf6",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: { position: "bottom" },
                },
              },
            });
          } else {
            roleDistributionChart.data.datasets[0].data = [
              roleCounts.global_admin,
              roleCounts.support_admin,
              roleCounts.kindred_head,
              roleCounts.user,
            ];
            roleDistributionChart.update();
          }
        } catch (error) {
          console.error("Error loading roles:", error);
          alert("Failed to load roles. Please check your network or API.");
        }
      }
      // 🔹 Open Change Role Modal
      $(document).on("click", ".change-role-btn", function () {
        const userId = $(this).data("id");
        const userName = $(this).data("user");
        $("#changeRoleUserId").val(userId);
        $("#changeRoleUser").val(userName);
      });
      // 🔹 Handle Change Role Form Submission
      $("#changeRoleForm").on("submit", function (e) {
        e.preventDefault();
        const userId = $("#changeRoleUserId").val();
        const newRole = $("#changeRoleNew").val();
        if (!userId || !newRole) {
          alert("Please select a valid role.");
          return;
        }

        $.ajax({
          url: `${BACKEND_URL}/users/${userId}/role`,
          method: "PATCH",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          data: JSON.stringify({ role: newRole }),
          success: function (response) {
            $("#changeRoleModal").modal("hide");
            showNotification("✅ User role updated successfully!", "success");
            // Refresh roles page to reflect changes
            initializeRolesPage();
          },
          error: function (xhr) {
            console.error("Failed to change role:", xhr.responseText);
            showNotification("❌ Failed to update user role.", "danger");
          },
        });
      });

      function loadRoleStats() {
        $.ajax({
          url: `${BACKEND_URL}/users/role-stats`,
          method: "GET",
          headers: { Authorization: `Bearer ${token}` },
          success: function (data) {
            const tbody = $("#roleStatsTableBody");
            tbody.empty();

            const roles = [
              {
                key: "global_admin",
                label: "Global Admin",
                badge: "bg-custom-purple",
              },
              {
                key: "support_admin",
                label: "Support Admin",
                badge: "bg-warning",
              },
              { key: "kindred_head", label: "Kindred Head", badge: "bg-info" },
              { key: "user", label: "User", badge: "bg-primary" },
            ];

            roles.forEach((role) => {
              const roleData = data[role.key] || {
                count: 0,
                permissions: "N/A",
              };
              tbody.append(`
                    <tr>
                    <td><span class="badge ${role.badge}">${
                role.label
              }</span></td>
                    <td>${roleData.count.toLocaleString()}</td>
                    <td>${roleData.permissions}</td>
                    </tr>
                `);
            });
          },
          error: function (xhr) {
            $("#roleStatsTableBody").html(`
                <tr><td colspan="3" class="text-danger">Failed to load data</td></tr>
                `);
            console.error("Error fetching role stats:", xhr.responseText);
          },
        });
      }

      $(document).ready(function () {
        loadRoleStats();
        $("#refreshRoleStats").click(loadRoleStats);
      });

      function showNotification(message, type = "info") {
        const alertClass =
          type === "success"
            ? "alert-success"
            : type === "error"
            ? "alert-danger"
            : type === "warning"
            ? "alert-warning"
            : "alert-info";

        const notification = $(`
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" style="top: 80px; right: 20px; z-index: 9999; min-width: 300px;">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `);

        $("body").append(notification);

        setTimeout(() => {
          notification.alert("close");
        }, 5000);
      }

      function exportTable(format) {
        showNotification(
          `Exporting table as ${format.toUpperCase()}...`,
          "info"
        );

        // In a real implementation, this would call the appropriate export function
        // For now, we'll just show a notification

        const table = document.getElementById("usersTable");
        const rows = Array.from(table.querySelectorAll("tr"));

        if (rows.length === 0) {
          showNotification("No table data to export!", "warning");
          return;
        }

        showNotification(
          `Exporting table as ${format.toUpperCase()}...`,
          "info"
        );

        if (format === "csv") {
          exportToCSV(rows);
        } else if (format === "pdf") {
          exportToPDF(rows);
        } else {
          showNotification("Unsupported export format!", "danger");
        }
      }

      // 🟩 Export to CSV
      function exportToCSV(rows) {
        const csvContent = rows
          .map((row) => {
            const cols = Array.from(row.querySelectorAll("th, td")).map(
              (col) => `"${col.textContent.trim().replace(/"/g, '""')}"`
            );
            return cols.join(",");
          })
          .join("\n");

        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `users_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification("Table exported successfully as CSV", "success");
      }

      // 🟦 Export to PDF
      function exportToPDF(rows) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("l", "pt", "a4"); // landscape mode
        const head = [
          Array.from(rows[0].querySelectorAll("th")).map((th) =>
            th.textContent.trim()
          ),
        ];
        const body = rows
          .slice(1)
          .map((row) =>
            Array.from(row.querySelectorAll("td")).map((td) =>
              td.textContent.trim()
            )
          );

        doc.text("All Users", 40, 40);
        doc.autoTable({
          startY: 60,
          head: head,
          body: body,
          styles: { fontSize: 8 },
          headStyles: { fillColor: [41, 128, 185] },
        });

        doc.save(`users_${new Date().toISOString().slice(0, 10)}.pdf`);

        setTimeout(() => {
          showNotification(
            `Table exported successfully as ${format.toUpperCase()}`,
            "success"
          );
        }, 1500);
      }
    </script>

    <script>
      $(document).ready(function () {
        // Populate states dropdown
        const states = Object.keys(nigerData).map((state) =>
          state.replace("_", " ").toUpperCase()
        );
        states.forEach((state) => {
          $("#userState").append(new Option(state, state));
        });

        // Update LGAs when state changes
        $("#userState").on("change", function () {
          const selectedState = $(this).val().toLowerCase().replace(" ", "_");
          const lgas = nigerData[selectedState] || [];
          const lgaSelect = $("#userLGA");
          lgaSelect.empty().append(new Option("Select LGA", ""));
          lgas.forEach((lga) => {
            lgaSelect.append(new Option(lga, lga));
          });
        });
      });

      $("#userNIN").on("blur", async function () {
        const nin = $(this).val().trim();
        if (/^\d{11}$/.test(nin)) {
          try {
            $("#ninStatus").html(
              '<span class="text-info">Verifying NIN...</span>'
            );

            const response = await $.ajax({
              url: `${BACKEND_URL}/auth/verify`,
              type: "POST",
              contentType: "application/json",
              data: JSON.stringify({ nin }),
            });

            if (response.success && response.data) {
              const { fullName, phone, stateOfOrigin, lga } = response.data;

              const nameParts = fullName.trim().split(" ");
              const firstname = nameParts[0];
              const lastname = nameParts.slice(1).join(" ");

              $("#firstName").val(firstname).prop("readonly", true);
              $("#lastName").val(lastname).prop("readonly", true);
              $("#phone").val(phone).prop("readonly", true);

              // Populate state of origin
              if (stateOfOrigin) {
                // Convert stateOfOrigin to match your select options
                let formattedState = stateOfOrigin
                  .toLowerCase()
                  .replace(/\s+/g, "_");

                // Set the value and trigger change to update LGA dropdown
                $("#userState")
                  .val(formattedState)
                  .trigger("change")
                  .prop("disabled", true);

                // If you're using Bootstrap selectpicker
                if ($("#userState").hasClass("selectpicker")) {
                  $("#userState").selectpicker("refresh");
                }
                // Populate LGA after a small delay to ensure state change is processed
                setTimeout(() => {
                  if (lga) {
                    $("#userLGA")
                      .val(lga)
                      .trigger("change")
                      .prop("disabled", true);

                    if ($("#userLGA").hasClass("selectpicker")) {
                      $("#userLGA").selectpicker("refresh");
                    }
                  }
                }, 200);
              }

              $("#ninStatus").html(
                '<span class="text-success">NIN Verified ✅</span>'
              );
            } else {
              $("#ninStatus").html(
                '<span class="text-danger">NIN not found.</span>'
              );
            }
          } catch (error) {
            $("#ninStatus").html(
              `<span class="text-danger">${
                error.responseJSON?.message || "Verification failed."
              }</span>`
            );
          }
        }
      });

      $("#addUserBtn").on("click", function () {
        const signUpData = {
          firstname: $("#firstName").val().trim(),
          lastname: $("#lastName").val().trim(),
          phone: $("#userPhone").val().trim(),
          NIN: $("#userNIN").val().trim(),
          email: $("#userEmail").val().trim(),
          password: $("#userPassword").val().trim(),
          stateOfOrigin: $("#userState").val().trim(),
          lgaOfOrigin: $("#userLGA").val().trim(),
          kindred: $("#userKindred").val().trim(),
        };

        console.log("signUpData", signUpData);

        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(signUpData.email)) {
          showNotification("Please enter a valid email address", "warning");
          return;
        }

        const pattern = /^0[7-9][0-1]\d{8}$/;
        const phonePattern = new RegExp(pattern);
        if (!phonePattern.test(signUpData.phone)) {
          showNotification(
            "Please enter a valid Nigerian phone number",
            "warning"
          );
          return;
        }

        const password = $("#password").val();
        const confirmPassword = $("#confirmPassword").val();

        if (signUpData.password !== confirmPassword) {
          showNotification("Passwords do not match", "warning");
          return;
        }

        // Simple validation
        if (
          !signUpData.firstname ||
          !signUpData.lastname ||
          !signUpData.email ||
          !signUpData.kindred ||
          !signUpData.NIN ||
          !signUpData.lgaOfOrigin ||
          !signUpData.stateOfOrigin ||
          !signUpData.password
        ) {
          showNotification("Please fill in all required fields", "warning");
          return;
        }

        // AJAX call to NestJS admin-signup endpoint
        $.ajax({
          url: `${BACKEND_URL}/auth/admin-signup`,
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify(signUpData),
          beforeSend: function () {
            $("#addUserBtn").prop("disabled", true).text("Adding...");
          },
          success: function (response) {
            showNotification("User added successfully!", "success");
            $("#addUserModal").modal("hide");
            $("#addUserForm")[0].reset();
            // Optional: reload or refresh user table
            if (typeof fetchData === "function") fetchData(1);
          },
          error: function (xhr) {
            console.error(xhr);
            const errorMsg =
              xhr.responseJSON?.message ||
              "Failed to add user. Please try again.";
            showNotification(errorMsg, "danger");
          },
          complete: function () {
            $("#addUserBtn").prop("disabled", false).text("Add User");
          },
        });
      });
    </script>

    <script>
      // Fetch and display ID card request stats
      async function fetchIdCardStats() {
        try {
          $.ajax({
            url: `${BACKEND_URL}/idcard/get-all-request`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (data) {
              if (!Array.isArray(data)) {
                return;
              }
              // 🔹 Calculate counts
              const total = data.length;
              const approved = data.filter(
                (req) => req.status === "Approved"
              ).length;
              const pending = data.filter(
                (req) => req.status === "Pending"
              ).length;
              const rejected = data.filter(
                (req) => req.status === "Rejected"
              ).length;

              // 🔹 Update the card UI
              $(".totalRequests").text(total);
              $("#approvedRequests").text(approved);
              $("#pendingRequests").text(pending);
              $("#rejectedRequests").text(rejected);
            },
            error: function (xhr) {
              console.error(
                "Failed to fetch ID card requests:",
                xhr.responseText
              );
            },
          });
        } catch (err) {
          console.error("Unexpected error:", err);
        }
      }

      // Fetch and display ID certificate request stats
      async function fetchCertStats() {
        try {
          $.ajax({
            url: `${BACKEND_URL}/indigene/certificate/get-all-request`,
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (data) {
              if (!Array.isArray(data)) {
                return;
              }

              // 🔹 Calculate counts
              const total = data.length;
              const approved = data.filter(
                (req) => req.status === "Approved"
              ).length;
              const pending = data.filter(
                (req) => req.status === "Pending"
              ).length;
              const rejected = data.filter(
                (req) => req.status === "Rejected"
              ).length;

              // 🔹 Update the card UI
              $(".totalCertRequests").text(total);
              $("#approvedCertRequests").text(approved);
              $("#pendingCertRequests").text(pending);
              $("#rejectedCertRequests").text(rejected);
            },
            error: function (xhr) {
              console.error(
                "Failed to fetch ID card requests:",
                xhr.responseText
              );
            },
          });
        } catch (err) {
          console.error("Unexpected error:", err);
        }
      }

      // Fetch and display ID certificate request stats
      function initializeTransactionStats() {
        $.ajax({
          url: `${BACKEND_URL}/transaction/stats`,
          method: "GET",
          headers: { Authorization: `Bearer ${token}` },
          success: function (stats) {
            const {
              totalTransactions,
              totalRevenue,
              avgTransaction,
              successRate,
            } = stats;

            // Format numbers with commas and ₦ sign
            const formatCurrency = (amount) =>
              "₦" +
              amount.toLocaleString("en-NG", { maximumFractionDigits: 2 });

            // Update UI
            $(".total-transactions").text(totalTransactions.toLocaleString());
            $(".total-revenue").text(formatCurrency(totalRevenue));
            $(".average-amount").text(formatCurrency(avgTransaction));
            $(".success-rate").text(successRate.toFixed(1) + "%");
            $(".kpi-value").text(formatCurrency(totalRevenue));
          },
          error: function (xhr) {
            console.error(
              "Failed to fetch transaction stats:",
              xhr.responseText
            );
          },
        });
      }

      /**
       * Calls the backend to generate and download a PDF report.
       */
      function exportTransactionsToPDF() {
        showNotification("Generating report, please wait...", "info");

        // Construct the URL with any query parameters if needed
        const url = `${BACKEND_URL}/transaction/export/pdf`;

        // Create a temporary link element to trigger the download
        const link = document.createElement("a");
        link.href = url;
        link.target = "_blank"; // Recommended for downloads
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Note: For better error handling, you could use fetch() and create a Blob,
        // but a simple link is often sufficient for this use case.
      }

      // 🔹 Initialize the stats after page load
      $(document).ready(function () {
        fetchIdCardStats();
        fetchCertStats();
        initializeTransactionStats();
      });

      $(document).ready(function () {
        // Load settings when the settings page is shown
        $("#settings-link").on("click", function (e) {
          e.preventDefault();
          loadSettings();
        });

        // Save settings button click
        $("#saveSettingsBtn").on("click", function () {
          saveSettings();
        });

        // Toggle API key visibility
        $("#toggleApiKey").on("click", function () {
          const apiKeyInput = $("#apiKey");
          const icon = $(this).find("i");

          if (apiKeyInput.attr("type") === "password") {
            apiKeyInput.attr("type", "text");
            icon.removeClass("bi-eye").addClass("bi-eye-slash");
          } else {
            apiKeyInput.attr("type", "password");
            icon.removeClass("bi-eye-slash").addClass("bi-eye");
          }
        });

        // Test API connection button click
        $("#testApiBtn").on("click", function () {
          testApiConnection();
        });

        // Regenerate API key button click
        $("#regenerateApiKeyBtn").on("click", function () {
          regenerateApiKey();
        });

        // Function to load settings from the backend
        function loadSettings() {
          $.ajax({
            url: `${BACKEND_URL}/settings`,
            method: "GET",
            success: function (response) {
              // Populate system settings
              $("#systemName").val(response.systemName);
              $("#systemEmail").val(response.systemEmail);
              $("#currency").val(response.currency);
              $("#dateFormat").val(response.dateFormat);
              $("#timezone").val(response.timezone);

              // Populate notification settings
              $("#emailNotifications").prop(
                "checked",
                response.emailNotifications
              );
              $("#smsNotifications").prop("checked", response.smsNotifications);
              $("#pushNotifications").prop(
                "checked",
                response.pushNotifications
              );
              $("#newUserAlerts").prop("checked", response.newUserAlerts);
              $("#requestAlerts").prop("checked", response.requestAlerts);
              $("#systemAlerts").prop("checked", response.systemAlerts);

              // Populate security settings
              $("#sessionTimeout").val(response.sessionTimeout);
              $("#twoFactorAuth").prop("checked", response.twoFactorAuth);
              $("#passwordComplexity").prop(
                "checked",
                response.passwordComplexity
              );
              $("#limitLoginAttempts").prop(
                "checked",
                response.limitLoginAttempts
              );
              $("#maxLoginAttempts").val(response.maxLoginAttempts);
              $("#lockoutDuration").val(response.lockoutDuration);

              // Populate API configuration
              $("#apiBaseUrl").val(response.apiBaseUrl);
              $("#apiKey").val(response.apiKey);
              $("#webhookUrl").val(response.webhookUrl);
              $("#webhookSecret").val(response.webhookSecret);
            },
            error: function (error) {
              showToast(
                "Failed to load settings: " + error.responseJSON.message,
                "error"
              );
            },
          });
        }

        // Function to save settings to the backend
        function saveSettings() {
          const settings = {
            systemName: $("#systemName").val(),
            systemEmail: $("#systemEmail").val(),
            currency: $("#currency").val(),
            dateFormat: $("#dateFormat").val(),
            timezone: $("#timezone").val(),
            emailNotifications: $("#emailNotifications").is(":checked"),
            smsNotifications: $("#smsNotifications").is(":checked"),
            pushNotifications: $("#pushNotifications").is(":checked"),
            newUserAlerts: $("#newUserAlerts").is(":checked"),
            requestAlerts: $("#requestAlerts").is(":checked"),
            systemAlerts: $("#systemAlerts").is(":checked"),
            sessionTimeout: parseInt($("#sessionTimeout").val()),
            twoFactorAuth: $("#twoFactorAuth").is(":checked"),
            passwordComplexity: $("#passwordComplexity").is(":checked"),
            limitLoginAttempts: $("#limitLoginAttempts").is(":checked"),
            maxLoginAttempts: parseInt($("#maxLoginAttempts").val()),
            lockoutDuration: parseInt($("#lockoutDuration").val()),
            apiBaseUrl: $("#apiBaseUrl").val(),
            apiKey: $("#apiKey").val(),
            webhookUrl: $("#webhookUrl").val(),
            webhookSecret: $("#webhookSecret").val(),
          };

          $.ajax({
            url: `${BACKEND_URL}/settings`,
            method: "PATCH",
            data: JSON.stringify(settings),
            contentType: "application/json",
            success: function (response) {
              showToast("Settings saved successfully!", "success");
            },
            error: function (error) {
              showToast(
                "Failed to save settings: " + error.responseJSON.message,
                "error"
              );
            },
          });
        }

        // Function to test API connection
        function testApiConnection() {
          const apiBaseUrl = $("#apiBaseUrl").val();
          const apiKey = $("#apiKey").val();
          console.log("apiBaseUrl", apiBaseUrl, "apiKey", apiKey);

          $.ajax({
            url: `${BACKEND_URL}/settings/test-api`,
            method: "POST",
            data: {
              apiBaseUrl: apiBaseUrl,
              apiKey: apiKey,
            },
            success: function (response) {
              console.log("API Test Response:", response);
              if (response.success) {
                showToast("API connection successful!", "success");
              } else {
                showToast(
                  "API connection failed: " + response.message,
                  "error"
                );
              }
            },
            error: function (error) {
              showToast(
                "API connection test failed: " + error.responseJSON.message,
                "error"
              );
            },
          });
        }

        // Function to regenerate API key
        function regenerateApiKey() {
          // Generate a random API key
          const newApiKey =
            "sk_test_" +
            Math.random().toString(36).substring(2, 15) +
            Math.random().toString(36).substring(2, 15);
          $("#apiKey").val(newApiKey);
          showToast(
            "API key regenerated. Remember to save your changes.",
            "info"
          );
        }

        // Function to show toast notification
        function showToast(message, type = "info") {
          const toast = $("#settingsToast");
          const toastMessage = $("#toastMessage");

          // Update toast message
          toastMessage.text(message);

          // Update toast class based on type
          toast.removeClass(
            "bg-success bg-danger bg-info bg-warning text-white"
          );

          if (type === "success") {
            toast.addClass("bg-success text-white");
          } else if (type === "error") {
            toast.addClass("bg-danger text-white");
          } else if (type === "warning") {
            toast.addClass("bg-warning text-white");
          } else {
            toast.addClass("bg-info text-white");
          }

          // Show toast
          const bsToast = new bootstrap.Toast(toast[0]);
          bsToast.show();
        }
      });
    </script>

    <script>
      const nigerData = {
        adamawa: [
          "Demsa",
          "Fufure",
          "Ganye",
          "Gayuk",
          "Gombi",
          "Grie",
          "Hong",
          "Jada",
          "Larmurde",
          "Madagali",
          "Maiha",
          "Mayo Belwa",
          "Michika",
          "Mubi North",
          "Mubi South",
          "Numan",
          "Shelleng",
          "Song",
          "Toungo",
          "Yola North",
          "Yola South",
        ],
        akwa_ibom: [
          "Abak",
          "Eastern Obolo",
          "Eket",
          "Esit Eket",
          "Essien Udim",
          "Etim Ekpo",
          "Etinan",
          "Ibeno",
          "Ibesikpo Asutan",
          "Ibiono-Ibom",
          "Ikot Abasi",
          "Ika",
          "Ikono",
          "Ikot Ekpene",
          "Ini",
          "Mkpat-Enin",
          "Itu",
          "Mbo",
          "Nsit-Atai",
          "Nsit-Ibom",
          "Nsit-Ubium",
          "Obot Akara",
          "Okobo",
          "Onna",
          "Oron",
          "Udung-Uko",
          "Ukanafun",
          "Oruk Anam",
          "Uruan",
          "Urue-Offong/Oruko",
          "Uyo",
        ],
        anambra: [
          "Aguata",
          "Anambra East",
          "Anaocha",
          "Awka North",
          "Anambra West",
          "Awka South",
          "Ayamelum",
          "Dunukofia",
          "Ekwusigo",
          "Idemili North",
          "Idemili South",
          "Ihiala",
          "Njikoka",
          "Nnewi North",
          "Nnewi South",
          "Ogbaru",
          "Onitsha North",
          "Onitsha South",
          "Orumba North",
          "Orumba South",
          "Oyi",
        ],
        abia: [
          "Aba North",
          "Arochukwu",
          "Aba South",
          "Bende",
          "Isiala Ngwa North",
          "Ikwuano",
          "Isiala Ngwa South",
          "Isuikwuato",
          "Obi Ngwa",
          "Ohafia",
          "Osisioma",
          "Ugwunagbo",
          "Ukwa East",
          "Ukwa West",
          "Umuahia North",
          "Umuahia South",
          "Umu Nneochi",
        ],
        bauchi: [
          "Alkaleri",
          "Bauchi",
          "Bogoro",
          "Damban",
          "Darazo",
          "Dass",
          "Gamawa",
          "Ganjuwa",
          "Giade",
          "Itas/Gadau",
          "Jama'are",
          "Katagum",
          "Kirfi",
          "Misau",
          "Ningi",
          "Shira",
          "Tafawa Balewa",
          "Toro",
          "Warji",
          "Zaki",
        ],
        benue: [
          "Agatu",
          "Apa",
          "Ado",
          "Buruku",
          "Gboko",
          "Guma",
          "Gwer East",
          "Gwer West",
          "Katsina-Ala",
          "Konshisha",
          "Kwande",
          "Logo",
          "Makurdi",
          "Obi",
          "Ogbadibo",
          "Ohimini",
          "Oju",
          "Okpokwu",
          "Oturkpo",
          "Tarka",
          "Ukum",
          "Ushongo",
          "Vandeikya",
        ],
        borno: [
          "Abadam",
          "Askira/Uba",
          "Bama",
          "Bayo",
          "Biu",
          "Chibok",
          "Damboa",
          "Dikwa",
          "Guzamala",
          "Gubio",
          "Hawul",
          "Gwoza",
          "Jere",
          "Kaga",
          "Kala/Balge",
          "Konduga",
          "Kukawa",
          "Kwaya Kusar",
          "Mafa",
          "Magumeri",
          "Maiduguri",
          "Mobbar",
          "Marte",
          "Monguno",
          "Ngala",
          "Nganzai",
          "Shani",
        ],
        bayelsa: [
          "Brass",
          "Ekeremor",
          "Kolokuma/Opokuma",
          "Nembe",
          "Ogbia",
          "Sagbama",
          "Southern Ijaw",
          "Yenagoa",
        ],
        cross_river: [
          "Abi",
          "Akamkpa",
          "Akpabuyo",
          "Bakassi",
          "Bekwarra",
          "Biase",
          "Boki",
          "Calabar Municipal",
          "Calabar South",
          "Etung",
          "Ikom",
          "Obanliku",
          "Obubra",
          "Obudu",
          "Odukpani",
          "Ogoja",
          "Yakuur",
          "Yala",
        ],
        delta: [
          "Aniocha North",
          "Aniocha South",
          "Bomadi",
          "Burutu",
          "Ethiope West",
          "Ethiope East",
          "Ika North East",
          "Ika South",
          "Isoko North",
          "Isoko South",
          "Ndokwa East",
          "Ndokwa West",
          "Okpe",
          "Oshimili North",
          "Oshimili South",
          "Patani",
          "Sapele",
          "Udu",
          "Ughelli North",
          "Ukwuani",
          "Ughelli South",
          "Uvwie",
          "Warri North",
          "Warri South",
          "Warri South West",
        ],
        ebonyi: [
          "Abakaliki",
          "Afikpo North",
          "Ebonyi",
          "Afikpo South",
          "Ezza North",
          "Ikwo",
          "Ezza South",
          "Ivo",
          "Ishielu",
          "Izzi",
          "Ohaozara",
          "Ohaukwu",
          "Onicha",
        ],
        edo: [
          "Akoko-Edo",
          "Egor",
          "Esan Central",
          "Esan North-East",
          "Esan South-East",
          "Esan West",
          "Etsako Central",
          "Etsako East",
          "Etsako West",
          "Igueben",
          "Ikpoba Okha",
          "Orhionmwon",
          "Oredo",
          "Ovia North-East",
          "Ovia South-West",
          "Owan East",
          "Owan West",
          "Uhunmwonde",
        ],
        ekiti: [
          "Ado Ekiti",
          "Efon",
          "Ekiti East",
          "Ekiti South-West",
          "Ekiti West",
          "Emure",
          "Gbonyin",
          "Ido Osi",
          "Ijero",
          "Ikere",
          "Ilejemeje",
          "Irepodun/Ifelodun",
          "Ikole",
          "Ise/Orun",
          "Moba",
          "Oye",
        ],
        enugu: [
          "Awgu",
          "Aninri",
          "Enugu East",
          "Enugu North",
          "Ezeagu",
          "Enugu South",
          "Igbo Etiti",
          "Igbo Eze North",
          "Igbo Eze South",
          "Isi Uzo",
          "Nkanu East",
          "Nkanu West",
          "Nsukka",
          "Udenu",
          "Oji River",
          "Uzo Uwani",
          "Udi",
        ],
        abuja: [
          "Abaji",
          "Bwari",
          "Gwagwalada",
          "Kuje",
          "Kwali",
          "Municipal Area Council",
        ],
        gombe: [
          "Akko",
          "Balanga",
          "Billiri",
          "Dukku",
          "Funakaye",
          "Gombe",
          "Kaltungo",
          "Kwami",
          "Nafada",
          "Shongom",
          "Yamaltu/Deba",
        ],
        jigawa: [
          "Auyo",
          "Babura",
          "Buji",
          "Biriniwa",
          "Birnin Kudu",
          "Dutse",
          "Gagarawa",
          "Garki",
          "Gumel",
          "Guri",
          "Gwaram",
          "Gwiwa",
          "Hadejia",
          "Jahun",
          "Kafin Hausa",
          "Kazaure",
          "Kiri Kasama",
          "Kiyawa",
          "Kaugama",
          "Maigatari",
          "Malam Madori",
          "Miga",
          "Sule Tankarkar",
          "Roni",
          "Ringim",
          "Yankwashi",
          "Taura",
        ],
        lagos: [
          "Agege",
          "Ajeromi-Ifelodun",
          "Alimosho",
          "Amuwo-Odofin",
          "Badagry",
          "Apapa",
          "Epe",
          "Eti Osa",
          "Ibeju-Lekki",
          "Ifako-Ijaiye",
          "Ikeja",
          "Ikorodu",
          "Kosofe",
          "Lagos Island",
          "Mushin",
          "Lagos Mainland",
          "Ojo",
          "Oshodi-Isolo",
          "Shomolu",
          "Surulere Lagos State",
        ],
        oyo: [
          "Afijio",
          "Akinyele",
          "Atiba",
          "Atisbo",
          "Egbeda",
          "Ibadan North",
          "Ibadan North-East",
          "Ibadan North-West",
          "Ibadan South-East",
          "Ibarapa Central",
          "Ibadan South-West",
          "Ibarapa East",
          "Ido",
          "Ibarapa North",
          "Irepo",
          "Iseyin",
          "Itesiwaju",
          "Iwajowa",
          "Kajola",
          "Lagelu",
          "Ogbomosho North",
          "Ogbomosho South",
          "Ogo Oluwa",
          "Olorunsogo",
          "Oluyole",
          "Ona Ara",
          "Orelope",
          "Ori Ire",
          "Oyo",
          "Oyo East",
          "Saki East",
          "Saki West",
          "Surulere Oyo State",
        ],
        imo: [
          "Aboh Mbaise",
          "Ahiazu Mbaise",
          "Ehime Mbano",
          "Ezinihitte",
          "Ideato North",
          "Ideato South",
          "Ihitte/Uboma",
          "Ikeduru",
          "Isiala Mbano",
          "Mbaitoli",
          "Isu",
          "Ngor Okpala",
          "Njaba",
          "Nkwerre",
          "Nwangele",
          "Obowo",
          "Oguta",
          "Ohaji/Egbema",
          "Okigwe",
          "Orlu",
          "Orsu",
          "Oru East",
          "Oru West",
          "Owerri Municipal",
          "Owerri North",
          "Unuimo",
          "Owerri West",
        ],
        kaduna: [
          "Birnin Gwari",
          "Chikun",
          "Giwa",
          "Ikara",
          "Igabi",
          "Jaba",
          "Jema'a",
          "Kachia",
          "Kaduna North",
          "Kaduna South",
          "Kagarko",
          "Kajuru",
          "Kaura",
          "Kauru",
          "Kubau",
          "Kudan",
          "Lere",
          "Makarfi",
          "Sabon Gari",
          "Sanga",
          "Soba",
          "Zangon Kataf",
          "Zaria",
        ],
        kebbi: [
          "Aleiro",
          "Argungu",
          "Arewa Dandi",
          "Augie",
          "Bagudo",
          "Birnin Kebbi",
          "Bunza",
          "Dandi",
          "Fakai",
          "Gwandu",
          "Jega",
          "Kalgo",
          "Koko/Besse",
          "Maiyama",
          "Ngaski",
          "Shanga",
          "Suru",
          "Sakaba",
          "Wasagu/Danko",
          "Yauri",
          "Zuru",
        ],
        kano: [
          "Ajingi",
          "Albasu",
          "Bagwai",
          "Bebeji",
          "Bichi",
          "Bunkure",
          "Dala",
          "Dambatta",
          "Dawakin Kudu",
          "Dawakin Tofa",
          "Doguwa",
          "Fagge",
          "Gabasawa",
          "Garko",
          "Garun Mallam",
          "Gezawa",
          "Gaya",
          "Gwale",
          "Gwarzo",
          "Kabo",
          "Kano Municipal",
          "Karaye",
          "Kibiya",
          "Kiru",
          "Kumbotso",
          "Kunchi",
          "Kura",
          "Madobi",
          "Makoda",
          "Minjibir",
          "Nasarawa",
          "Rano",
          "Rimin Gado",
          "Rogo",
          "Shanono",
          "Takai",
          "Sumaila",
          "Tarauni",
          "Tofa",
          "Tsanyawa",
          "Tudun Wada",
          "Ungogo",
          "Warawa",
          "Wudil",
        ],
        kogi: [
          "Ajaokuta",
          "Adavi",
          "Ankpa",
          "Bassa",
          "Dekina",
          "Ibaji",
          "Idah",
          "Igalamela Odolu",
          "Ijumu",
          "Kogi",
          "Kabba/Bunu",
          "Lokoja",
          "Ofu",
          "Mopa Muro",
          "Ogori/Magongo",
          "Okehi",
          "Okene",
          "Olamaboro",
          "Omala",
          "Yagba East",
          "Yagba West",
        ],
        osun: [
          "Aiyedire",
          "Atakunmosa West",
          "Atakunmosa East",
          "Aiyedaade",
          "Boluwaduro",
          "Boripe",
          "Ife East",
          "Ede South",
          "Ife North",
          "Ede North",
          "Ife South",
          "Ejigbo",
          "Ife Central",
          "Ifedayo",
          "Egbedore",
          "Ila",
          "Ifelodun",
          "Ilesa East",
          "Ilesa West",
          "Irepodun",
          "Irewole",
          "Isokan",
          "Iwo",
          "Obokun",
          "Odo Otin",
          "Ola Oluwa",
          "Olorunda",
          "Oriade",
          "Orolu",
          "Osogbo",
        ],
        sokoto: [
          "Gudu",
          "Gwadabawa",
          "Illela",
          "Isa",
          "Kebbe",
          "Kware",
          "Rabah",
          "Sabon Birni",
          "Shagari",
          "Silame",
          "Sokoto North",
          "Sokoto South",
          "Tambuwal",
          "Tangaza",
          "Tureta",
          "Wamako",
          "Wurno",
          "Yabo",
          "Binji",
          "Bodinga",
          "Dange Shuni",
          "Goronyo",
          "Gada",
        ],
        plateau: [
          "Bokkos",
          "Barkin Ladi",
          "Bassa",
          "Jos East",
          "Jos North",
          "Jos South",
          "Kanam",
          "Kanke",
          "Langtang South",
          "Langtang North",
          "Mangu",
          "Mikang",
          "Pankshin",
          "Qua'an Pan",
          "Riyom",
          "Shendam",
          "Wase",
        ],
        taraba: [
          "Ardo Kola",
          "Bali",
          "Donga",
          "Gashaka",
          "Gassol",
          "Ibi",
          "Jalingo",
          "Karim Lamido",
          "Kumi",
          "Lau",
          "Sardauna",
          "Takum",
          "Ussa",
          "Wukari",
          "Yorro",
          "Zing",
        ],
        yobe: [
          "Bade",
          "Bursari",
          "Damaturu",
          "Fika",
          "Fune",
          "Geidam",
          "Gujba",
          "Gulani",
          "Jakusko",
          "Karasuwa",
          "Machina",
          "Nangere",
          "Nguru",
          "Potiskum",
          "Tarmuwa",
          "Yunusari",
          "Yusufari",
        ],
        zamfara: [
          "Anka",
          "Birnin Magaji/Kiyaw",
          "Bakura",
          "Bukkuyum",
          "Bungudu",
          "Gummi",
          "Gusau",
          "Kaura Namoda",
          "Maradun",
          "Shinkafi",
          "Maru",
          "Talata Mafara",
          "Tsafe",
          "Zurmi",
        ],
        katsina: [
          "Bakori",
          "Batagarawa",
          "Batsari",
          "Baure",
          "Bindawa",
          "Charanchi",
          "Danja",
          "Dandume",
          "Dan Musa",
          "Daura",
          "Dutsi",
          "Dutsin Ma",
          "Faskari",
          "Funtua",
          "Ingawa",
          "Jibia",
          "Kafur",
          "Kaita",
          "Kankara",
          "Kankia",
          "Katsina",
          "Kurfi",
          "Kusada",
          "Mai'Adua",
          "Malumfashi",
          "Mani",
          "Mashi",
          "Matazu",
          "Musawa",
          "Rimi",
          "Sabuwa",
          "Safana",
          "Sandamu",
          "Zango",
        ],
        kwara: [
          "Asa",
          "Baruten",
          "Edu",
          "Ilorin East",
          "Ifelodun",
          "Ilorin South",
          "Ekiti Kwara State",
          "Ilorin West",
          "Irepodun",
          "Isin",
          "Kaiama",
          "Moro",
          "Offa",
          "Oke Ero",
          "Oyun",
          "Pategi",
        ],
        nasarawa: [
          "Akwanga",
          "Awe",
          "Doma",
          "Karu",
          "Keana",
          "Keffi",
          "Lafia",
          "Kokona",
          "Nasarawa Egon",
          "Nasarawa",
          "Obi",
          "Toto",
          "Wamba",
        ],
        niger: [
          "Agaie",
          "Agwara",
          "Bida",
          "Borgu",
          "Bosso",
          "Chanchaga",
          "Edati",
          "Gbako",
          "Gurara",
          "Katcha",
          "Kontagora",
          "Lapai",
          "Lavun",
          "Mariga",
          "Magama",
          "Mokwa",
          "Mashegu",
          "Moya",
          "Paikoro",
          "Rafi",
          "Rijau",
          "Shiroro",
          "Suleja",
          "Tafa",
          "Wushishi",
        ],
        rivers: [
          "Abua/Odual",
          "Ahoada East",
          "Ahoada West",
          "Andoni",
          "Akuku-Toru",
          "Asari-Toru",
          "Bonny",
          "Degema",
          "Emuoha",
          "Eleme",
          "Ikwerre",
          "Etche",
          "Gokana",
          "Khana",
          "Obio/Akpor",
          "Ogba/Egbema/Ndoni",
          "Ogu/Bolo",
          "Okrika",
          "Omuma",
          "Opobo/Nkoro",
          "Oyigbo",
          "Port Harcourt",
          "Tai",
        ],
      };
    </script>

    <script>
      function logout() {
        localStorage.removeItem("token");
      }
    </script>
    <script type="text/javascript" src="../js/index.js"></script>
  </body>
</html>
